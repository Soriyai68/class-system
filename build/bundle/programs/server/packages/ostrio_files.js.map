{"version":3,"sources":["meteor://ðŸ’»app/packages/ostrio:files/server.js","meteor://ðŸ’»app/packages/ostrio:files/core.js","meteor://ðŸ’»app/packages/ostrio:files/cursor.js","meteor://ðŸ’»app/packages/ostrio:files/lib.js","meteor://ðŸ’»app/packages/ostrio:files/write-stream.js"],"names":["module","export","FilesCollection","helpers","Mongo","link","v","fetch","WebApp","Meteor","Random","Cookies","check","Match","WriteStream","default","FilesCollectionCore","fixJSONParse","fixJSONStringify","AbortController","fs","nodeQs","nodePath","pipelineCallback","pipeline","promisify","__reifyWaitForDeps__","bound","bindEnvironment","callback","noop","createIndex","_collection","keys","opts","collection","rawCollection","e","code","indexName","indexes","index","allMatch","indexKey","Object","key","name","dropIndex","_debug","concat","join","_name","details","constructor","config","storagePath","_preCollection","_preCollectionName","allowClientCode","allowedOrigins","allowQueryStringCookies","cacheControl","chunkSize","collectionName","continueUploadTTL","debug","disableDownload","disableUpload","downloadCallback","downloadRoute","getUser","integrityCheck","interceptDownload","interceptRequest","namingFunction","onAfterRemove","onAfterUpload","onBeforeRemove","onBeforeUpload","onInitiateUpload","parentDirPermissions","permissions","protected","public","responseHeaders","sanitize","schema","strict","self","isBoolean","Math","floor","isString","Collection","filesCollection","String","Error","replace","isFunction","isNumber","parseInt","isObject","_currentUploads","responseCode","fileRef","versionRef","headers","Pragma","size","Connection","type","sep","sp","apply","arguments","normalize","mkdirSync","mode","recursive","error","Boolean","Number","Function","OneOf","RegExp","_cookies","allowedCordovaOrigins","createdAt","expireAfterSeconds","background","_preCollectionCursor","find","fields","_id","isFinished","observe","changed","doc","removeAsync","removed","stop","end","countAsync","abort","_createStream","path","fileLength","_continueUpload","file","aborted","ended","contUpld","findOneAsync","_checkAccess","http","result","userAsync","userId","_getUser","params","call","assign","rc","text","response","headersSent","writeHead","length","finished","_methodNames","_Abort","_Write","_Start","_Remove","on","_handleUpload","_finishUpload","_handleUploadSync","wrapAsync","bind","connectHandlers","use","httpReq","httpResp","next","_parsedUrl","includes","test","origin","setHeader","method","handleError","_error","toString","JSON","stringify","body","handleData","user","request","fileId","eof","binData","Buffer","from","chunkId","_prepareUpload","meta","emit","parse","jsonErr","___s","clone","res","Date","maxLength","insertAsync","omit","returnMeta","uploadRoute","httpRespErr","setTimeout","data","uri","indexOf","substring","uris","split","query","version","download","_file","_methods","selector","userFuncs","users","cursor","FSName","Optional","_opts","handleUploadErr","unlink","methods","undefined","transport","ctx","fileName","_getFileName","extension","extensionWithDot","_getExt","ext","_dataToSchema","isUploadAllowed","cb","chmod","_getMimeType","_updateFileTypes","updateAsync","$set","prrUpdateError","colInsert","write","fileData","mime","_getUserId","xmtok","server","sessions","Map","has","get","_getUserDefault","mtok","cookie","buffer","_proceedAfterUpload","proceedAfterUpload","id","fsName","mustCreateFileFirst","stats","promises","stat","isFile","statError","paths","pop","mkdir","writeFile","stream","createWriteStream","flags","Promise","resolve","reject","streamErr","insertErr","load","url","timeout","pathParts","storeResult","writeFileSync","wStream","autoClose","emitClose","controller","timer","signal","clearTimeout","ok","statusText","newStats","versions","original","pipe","existsSync","addFile","statErr","message","_storagePath","files","forEachAsync","docs","fetchAsync","deny","rules","allow","denyClient","insert","update","remove","allowClient","vKey","_404","originalUrl","vRef","responseType","serve","_http$params","_http$params$query","_http$params2","_http$params2$query","readableStream","_responseType","force200","partiral","reqRange","dispositionType","start","take","dispositionName","encodeURI","encodeURIComponent","dispositionEncoding","range","array","isNaN","play","streamErrorHandler","respond","_isEnded","closeStreamCb","closeError","closeStream","destroyed","close","destroy","closeStreamError","err","createReadStream","__reify_async_result__","_reifyError","async","EventEmitter","formatFleURL","FilesCursor","FileCursor","console","info","log","toLowerCase","isVideo","isAudio","isImage","isText","isJSON","isPDF","ds","_downloadRoute","_collectionName","options","uriBase","__helpers","optional","blackbox","updatedAt","_fileRef","property","with","findOne","_selector","_current","hasNext","hasPrevious","previous","first","last","context","each","mapAsync","current","callbacks","observeChanges","str","max","replacement","isUndefined","obj","isArray","Array","prototype","isDate","date","getDate","isEmpty","slice","_obj","hasOwnProperty","i","clear","_len","_key","now","throttle","func","wait","that","args","later","leading","throttled","remaining","trailing","cancel","_helpers","_uriBase","__meteor_runtime_config__","ROOT_URL","_root","fdCache","trim","fd","writtenChunks","mkdirError","writeFileError","open","oError","num","chunk","written","ceil"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAAAA,MAAM,CAACC,MAAM,CAAC;MAACC,eAAe,EAACA,CAAA,KAAIA,eAAe;MAACC,OAAO,EAACA,CAAA,KAAIA;IAAO,CAAC,CAAC;IAAC,IAAIC,KAAK;IAACJ,MAAM,CAACK,IAAI,CAAC,cAAc,EAAC;MAACD,KAAKA,CAACE,CAAC,EAAC;QAACF,KAAK,GAACE,CAAC;MAAA;IAAC,CAAC,EAAC,CAAC,CAAC;IAAC,IAAIC,KAAK;IAACP,MAAM,CAACK,IAAI,CAAC,cAAc,EAAC;MAACE,KAAKA,CAACD,CAAC,EAAC;QAACC,KAAK,GAACD,CAAC;MAAA;IAAC,CAAC,EAAC,CAAC,CAAC;IAAC,IAAIE,MAAM;IAACR,MAAM,CAACK,IAAI,CAAC,eAAe,EAAC;MAACG,MAAMA,CAACF,CAAC,EAAC;QAACE,MAAM,GAACF,CAAC;MAAA;IAAC,CAAC,EAAC,CAAC,CAAC;IAAC,IAAIG,MAAM;IAACT,MAAM,CAACK,IAAI,CAAC,eAAe,EAAC;MAACI,MAAMA,CAACH,CAAC,EAAC;QAACG,MAAM,GAACH,CAAC;MAAA;IAAC,CAAC,EAAC,CAAC,CAAC;IAAC,IAAII,MAAM;IAACV,MAAM,CAACK,IAAI,CAAC,eAAe,EAAC;MAACK,MAAMA,CAACJ,CAAC,EAAC;QAACI,MAAM,GAACJ,CAAC;MAAA;IAAC,CAAC,EAAC,CAAC,CAAC;IAAC,IAAIK,OAAO;IAACX,MAAM,CAACK,IAAI,CAAC,uBAAuB,EAAC;MAACM,OAAOA,CAACL,CAAC,EAAC;QAACK,OAAO,GAACL,CAAC;MAAA;IAAC,CAAC,EAAC,CAAC,CAAC;IAAC,IAAIM,KAAK,EAACC,KAAK;IAACb,MAAM,CAACK,IAAI,CAAC,cAAc,EAAC;MAACO,KAAKA,CAACN,CAAC,EAAC;QAACM,KAAK,GAACN,CAAC;MAAA,CAAC;MAACO,KAAKA,CAACP,CAAC,EAAC;QAACO,KAAK,GAACP,CAAC;MAAA;IAAC,CAAC,EAAC,CAAC,CAAC;IAAC,IAAIQ,WAAW;IAACd,MAAM,CAACK,IAAI,CAAC,mBAAmB,EAAC;MAACU,OAAOA,CAACT,CAAC,EAAC;QAACQ,WAAW,GAACR,CAAC;MAAA;IAAC,CAAC,EAAC,CAAC,CAAC;IAAC,IAAIU,mBAAmB;IAAChB,MAAM,CAACK,IAAI,CAAC,WAAW,EAAC;MAACU,OAAOA,CAACT,CAAC,EAAC;QAACU,mBAAmB,GAACV,CAAC;MAAA;IAAC,CAAC,EAAC,CAAC,CAAC;IAAC,IAAIW,YAAY,EAACC,gBAAgB,EAACf,OAAO;IAACH,MAAM,CAACK,IAAI,CAAC,UAAU,EAAC;MAACY,YAAYA,CAACX,CAAC,EAAC;QAACW,YAAY,GAACX,CAAC;MAAA,CAAC;MAACY,gBAAgBA,CAACZ,CAAC,EAAC;QAACY,gBAAgB,GAACZ,CAAC;MAAA,CAAC;MAACH,OAAOA,CAACG,CAAC,EAAC;QAACH,OAAO,GAACG,CAAC;MAAA;IAAC,CAAC,EAAC,CAAC,CAAC;IAAC,IAAIa,eAAe;IAACnB,MAAM,CAACK,IAAI,CAAC,kBAAkB,EAAC;MAACU,OAAOA,CAACT,CAAC,EAAC;QAACa,eAAe,GAACb,CAAC;MAAA;IAAC,CAAC,EAAC,EAAE,CAAC;IAAC,IAAIc,EAAE;IAACpB,MAAM,CAACK,IAAI,CAAC,IAAI,EAAC;MAACU,OAAOA,CAACT,CAAC,EAAC;QAACc,EAAE,GAACd,CAAC;MAAA;IAAC,CAAC,EAAC,EAAE,CAAC;IAAC,IAAIe,MAAM;IAACrB,MAAM,CAACK,IAAI,CAAC,aAAa,EAAC;MAACU,OAAOA,CAACT,CAAC,EAAC;QAACe,MAAM,GAACf,CAAC;MAAA;IAAC,CAAC,EAAC,EAAE,CAAC;IAAC,IAAIgB,QAAQ;IAACtB,MAAM,CAACK,IAAI,CAAC,MAAM,EAAC;MAACU,OAAOA,CAACT,CAAC,EAAC;QAACgB,QAAQ,GAAChB,CAAC;MAAA;IAAC,CAAC,EAAC,EAAE,CAAC;IAAC,IAAIiB,gBAAgB;IAACvB,MAAM,CAACK,IAAI,CAAC,QAAQ,EAAC;MAACmB,QAAQA,CAAClB,CAAC,EAAC;QAACiB,gBAAgB,GAACjB,CAAC;MAAA;IAAC,CAAC,EAAC,EAAE,CAAC;IAAC,IAAImB,SAAS;IAACzB,MAAM,CAACK,IAAI,CAAC,MAAM,EAAC;MAACoB,SAASA,CAACnB,CAAC,EAAC;QAACmB,SAAS,GAACnB,CAAC;MAAA;IAAC,CAAC,EAAC,EAAE,CAAC;IAAC,IAAIoB,oBAAoB,CAAC,CAAC,EAAE,CAAC,MAAMA,oBAAoB,CAAC,CAAC,EAAE,CAAC;IAmB1zC;IACA;;IAEA,MAAMF,QAAQ,GAAGC,SAAS,CAACF,gBAAgB,CAAC;;IAE5C;AACA;AACA;AACA;IACA,MAAMI,KAAK,GAAGlB,MAAM,CAACmB,eAAe,CAACC,QAAQ,IAAIA,QAAQ,CAAC,CAAC,CAAC;IAC5D,MAAMC,IAAI,GAAG,SAASA,IAAIA,CAAA,EAAI,CAAC,CAAC;;IAGhC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACA,MAAMC,WAAW,GAAG,MAAAA,CAAOC,WAAW,EAAEC,IAAI,EAAEC,IAAI,KAAK;MACrD,MAAMC,UAAU,GAAGH,WAAW,CAACI,aAAa,CAAC,CAAC;MAE9C,IAAI;QACF,MAAMD,UAAU,CAACJ,WAAW,CAACE,IAAI,EAAEC,IAAI,CAAC;MAC1C,CAAC,CAAC,OAAOG,CAAC,EAAE;QACV,IAAIA,CAAC,CAACC,IAAI,KAAK,EAAE,EAAE;UACjB,IAAIC,SAAS;UACb,MAAMC,OAAO,GAAG,MAAML,UAAU,CAACK,OAAO,CAAC,CAAC;UAC1C,KAAK,MAAMC,KAAK,IAAID,OAAO,EAAE;YAC3B,IAAIE,QAAQ,GAAG,IAAI;YACnB,KAAK,MAAMC,QAAQ,IAAIC,MAAM,CAACX,IAAI,CAACA,IAAI,CAAC,EAAE;cACxC,IAAI,OAAOQ,KAAK,CAACI,GAAG,CAACF,QAAQ,CAAC,KAAK,WAAW,EAAE;gBAC9CD,QAAQ,GAAG,KAAK;gBAChB;cACF;YACF;YAEA,KAAK,MAAMC,QAAQ,IAAIC,MAAM,CAACX,IAAI,CAACQ,KAAK,CAACI,GAAG,CAAC,EAAE;cAC7C,IAAI,OAAOZ,IAAI,CAACU,QAAQ,CAAC,KAAK,WAAW,EAAE;gBACzCD,QAAQ,GAAG,KAAK;gBAChB;cACF;YACF;YAEA,IAAIA,QAAQ,EAAE;cACZH,SAAS,GAAGE,KAAK,CAACK,IAAI;cACtB;YACF;UACF;UAEA,IAAIP,SAAS,EAAE;YACb,MAAMJ,UAAU,CAACY,SAAS,CAACR,SAAS,CAAC;YACrC,MAAMJ,UAAU,CAACJ,WAAW,CAACE,IAAI,EAAEC,IAAI,CAAC;UAC1C;QACF,CAAC,MAAM;UACLzB,MAAM,CAACuC,MAAM,gBAAAC,MAAA,CAAgBL,MAAM,CAACX,IAAI,CAACA,IAAI,CAAC,CAACiB,IAAI,CAAC,KAAK,CAAC,kBAAAD,MAAA,CAAcjB,WAAW,CAACmB,KAAK,oBAAgB;YAAElB,IAAI;YAAEC,IAAI;YAAEkB,OAAO,EAAEf;UAAE,CAAC,CAAC;QACtI;MACF;IACF,CAAC;;IAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACA,MAAMnC,eAAe,SAASc,mBAAmB,CAAC;MAChDqC,WAAWA,CAACC,MAAM,EAAE;QAClB,KAAK,CAAC,CAAC;QACP,IAAIC,WAAW;QACf,IAAID,MAAM,EAAE;UACV,CAAC;YACCE,cAAc,EAAE,IAAI,CAACA,cAAc;YACnCC,kBAAkB,EAAE,IAAI,CAACA,kBAAkB;YAC3CC,eAAe,EAAE,IAAI,CAACA,eAAe;YACrCC,cAAc,EAAE,IAAI,CAACA,cAAc;YACnCC,uBAAuB,EAAE,IAAI,CAACA,uBAAuB;YACrDC,YAAY,EAAE,IAAI,CAACA,YAAY;YAC/BC,SAAS,EAAE,IAAI,CAACA,SAAS;YACzB3B,UAAU,EAAE,IAAI,CAACA,UAAU;YAC3B4B,cAAc,EAAE,IAAI,CAACA,cAAc;YACnCC,iBAAiB,EAAE,IAAI,CAACA,iBAAiB;YACzCC,KAAK,EAAE,IAAI,CAACA,KAAK;YACjBC,eAAe,EAAE,IAAI,CAACA,eAAe;YACrCC,aAAa,EAAE,IAAI,CAACA,aAAa;YACjCC,gBAAgB,EAAE,IAAI,CAACA,gBAAgB;YACvCC,aAAa,EAAE,IAAI,CAACA,aAAa;YACjCC,OAAO,EAAE,IAAI,CAACA,OAAO;YACrBC,cAAc,EAAE,IAAI,CAACA,cAAc;YACnCC,iBAAiB,EAAE,IAAI,CAACA,iBAAiB;YACzCC,gBAAgB,EAAE,IAAI,CAACA,gBAAgB;YACvCC,cAAc,EAAE,IAAI,CAACA,cAAc;YACnCC,aAAa,EAAE,IAAI,CAACA,aAAa;YACjCC,aAAa,EAAE,IAAI,CAACA,aAAa;YACjCC,cAAc,EAAE,IAAI,CAACA,cAAc;YACnCC,cAAc,EAAE,IAAI,CAACA,cAAc;YACnCC,gBAAgB,EAAE,IAAI,CAACA,gBAAgB;YACvCC,oBAAoB,EAAE,IAAI,CAACA,oBAAoB;YAC/CC,WAAW,EAAE,IAAI,CAACA,WAAW;YAC7BC,SAAS,EAAE,IAAI,CAACA,SAAS;YACzBC,MAAM,EAAE,IAAI,CAACA,MAAM;YACnBC,eAAe,EAAE,IAAI,CAACA,eAAe;YACrCC,QAAQ,EAAE,IAAI,CAACA,QAAQ;YACvBC,MAAM,EAAE,IAAI,CAACA,MAAM;YACnB/B,WAAW;YACXgC,MAAM,EAAE,IAAI,CAACA;UACf,CAAC,GAAGjC,MAAM;QACZ;QAEA,MAAMkC,IAAI,GAAG,IAAI;QAEjB,IAAI,CAACrF,OAAO,CAACsF,SAAS,CAAC,IAAI,CAACxB,KAAK,CAAC,EAAE;UAClC,IAAI,CAACA,KAAK,GAAG,KAAK;QACpB;QAEA,IAAI,CAAC9D,OAAO,CAACsF,SAAS,CAAC,IAAI,CAACN,MAAM,CAAC,EAAE;UACnC,IAAI,CAACA,MAAM,GAAG,KAAK;QACrB;QAEA,IAAI,CAAC,IAAI,CAACD,SAAS,EAAE;UACnB,IAAI,CAACA,SAAS,GAAG,KAAK;QACxB;QAEA,IAAI,CAAC,IAAI,CAACpB,SAAS,EAAE;UACnB,IAAI,CAACA,SAAS,GAAG,IAAI,GAAG,GAAG;QAC7B;QAEA,IAAI,CAACA,SAAS,GAAG4B,IAAI,CAACC,KAAK,CAAC,IAAI,CAAC7B,SAAS,GAAG,CAAC,CAAC,GAAG,CAAC;QAEnD,IAAI,CAAC3D,OAAO,CAACyF,QAAQ,CAAC,IAAI,CAAC7B,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC5B,UAAU,EAAE;UAC9D,IAAI,CAAC4B,cAAc,GAAG,mBAAmB;QAC3C;QAEA,IAAI,CAAC,IAAI,CAAC5B,UAAU,EAAE;UACpB,IAAI,CAACA,UAAU,GAAG,IAAI/B,KAAK,CAACyF,UAAU,CAAC,IAAI,CAAC9B,cAAc,CAAC;QAC7D,CAAC,MAAM;UACL,IAAI,CAACA,cAAc,GAAG,IAAI,CAAC5B,UAAU,CAACgB,KAAK;QAC7C;QAEA,IAAI,CAAChB,UAAU,CAAC2D,eAAe,GAAG,IAAI;QACtClF,KAAK,CAAC,IAAI,CAACmD,cAAc,EAAEgC,MAAM,CAAC;QAElC,IAAI,IAAI,CAACZ,MAAM,IAAI,CAAC,IAAI,CAACd,aAAa,EAAE;UACtC,MAAM,IAAI5D,MAAM,CAACuF,KAAK,CAAC,GAAG,sBAAA/C,MAAA,CAAsB,IAAI,CAACc,cAAc,4KAAmK,CAAC;QACzO;QAEA,IAAI,CAAC5D,OAAO,CAACyF,QAAQ,CAAC,IAAI,CAACvB,aAAa,CAAC,EAAE;UACzC,IAAI,CAACA,aAAa,GAAG,cAAc;QACrC;QAEA,IAAI,CAACA,aAAa,GAAG,IAAI,CAACA,aAAa,CAAC4B,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC;QAE1D,IAAI,CAAC9F,OAAO,CAAC+F,UAAU,CAAC,IAAI,CAACxB,cAAc,CAAC,EAAE;UAC5C,IAAI,CAACA,cAAc,GAAG,KAAK;QAC7B;QAEA,IAAI,CAACvE,OAAO,CAAC+F,UAAU,CAAC,IAAI,CAACpB,cAAc,CAAC,EAAE;UAC5C,IAAI,CAACA,cAAc,GAAG,KAAK;QAC7B;QAEA,IAAI,CAAC3E,OAAO,CAAC+F,UAAU,CAAC,IAAI,CAAC5B,OAAO,CAAC,EAAE;UACrC,IAAI,CAACA,OAAO,GAAG,KAAK;QACtB;QAEA,IAAI,CAACnE,OAAO,CAACsF,SAAS,CAAC,IAAI,CAAC/B,eAAe,CAAC,EAAE;UAC5C,IAAI,CAACA,eAAe,GAAG,IAAI;QAC7B;QAEA,IAAI,CAACvD,OAAO,CAAC+F,UAAU,CAAC,IAAI,CAACnB,gBAAgB,CAAC,EAAE;UAC9C,IAAI,CAACA,gBAAgB,GAAG,KAAK;QAC/B;QAEA,IAAI,CAAC5E,OAAO,CAAC+F,UAAU,CAAC,IAAI,CAACzB,gBAAgB,CAAC,EAAE;UAC9C,IAAI,CAACA,gBAAgB,GAAG,KAAK;QAC/B;QAEA,IAAI,CAACtE,OAAO,CAAC+F,UAAU,CAAC,IAAI,CAAC1B,iBAAiB,CAAC,EAAE;UAC/C,IAAI,CAACA,iBAAiB,GAAG,KAAK;QAChC;QAEA,IAAI,CAACrE,OAAO,CAACsF,SAAS,CAAC,IAAI,CAACF,MAAM,CAAC,EAAE;UACnC,IAAI,CAACA,MAAM,GAAG,IAAI;QACpB;QAEA,IAAI,CAACpF,OAAO,CAACsF,SAAS,CAAC,IAAI,CAAC7B,uBAAuB,CAAC,EAAE;UACpD,IAAI,CAACA,uBAAuB,GAAG,KAAK;QACtC;QAEA,IAAI,CAACzD,OAAO,CAACgG,QAAQ,CAAC,IAAI,CAAClB,WAAW,CAAC,EAAE;UACvC,IAAI,CAACA,WAAW,GAAGmB,QAAQ,CAAC,KAAK,EAAE,CAAC,CAAC;QACvC;QAEA,IAAI,CAACjG,OAAO,CAACgG,QAAQ,CAAC,IAAI,CAACnB,oBAAoB,CAAC,EAAE;UAChD,IAAI,CAACA,oBAAoB,GAAGoB,QAAQ,CAAC,KAAK,EAAE,CAAC,CAAC;QAChD;QAEA,IAAI,CAACjG,OAAO,CAACyF,QAAQ,CAAC,IAAI,CAAC/B,YAAY,CAAC,EAAE;UACxC,IAAI,CAACA,YAAY,GAAG,6CAA6C;QACnE;QAEA,IAAI,CAAC1D,OAAO,CAAC+F,UAAU,CAAC,IAAI,CAACtB,aAAa,CAAC,EAAE;UAC3C,IAAI,CAACA,aAAa,GAAG,KAAK;QAC5B;QAEA,IAAI,CAACzE,OAAO,CAACsF,SAAS,CAAC,IAAI,CAACtB,aAAa,CAAC,EAAE;UAC1C,IAAI,CAACA,aAAa,GAAG,KAAK;QAC5B;QAEA,IAAI,CAAChE,OAAO,CAAC+F,UAAU,CAAC,IAAI,CAACvB,aAAa,CAAC,EAAE;UAC3C,IAAI,CAACA,aAAa,GAAG,KAAK;QAC5B;QAEA,IAAI,CAACxE,OAAO,CAAC+F,UAAU,CAAC,IAAI,CAACrB,cAAc,CAAC,EAAE;UAC5C,IAAI,CAACA,cAAc,GAAG,KAAK;QAC7B;QAEA,IAAI,CAAC1E,OAAO,CAACsF,SAAS,CAAC,IAAI,CAAClB,cAAc,CAAC,EAAE;UAC3C,IAAI,CAACA,cAAc,GAAG,IAAI;QAC5B;QAEA,IAAI,CAACpE,OAAO,CAACsF,SAAS,CAAC,IAAI,CAACvB,eAAe,CAAC,EAAE;UAC5C,IAAI,CAACA,eAAe,GAAG,KAAK;QAC9B;QAEA,IAAI,IAAI,CAACP,cAAc,KAAK,IAAI,IAAI,IAAI,CAACA,cAAc,KAAK,KAAK,CAAC,EAAE;UAClE,IAAI,CAACA,cAAc,GAAG,iCAAiC;QACzD;QAEA,IAAI,CAACxD,OAAO,CAACkG,QAAQ,CAAC,IAAI,CAACC,eAAe,CAAC,EAAE;UAC3C,IAAI,CAACA,eAAe,GAAG,CAAC,CAAC;QAC3B;QAEA,IAAI,CAACnG,OAAO,CAAC+F,UAAU,CAAC,IAAI,CAAC9B,gBAAgB,CAAC,EAAE;UAC9C,IAAI,CAACA,gBAAgB,GAAG,KAAK;QAC/B;QAEA,IAAI,CAACjE,OAAO,CAACgG,QAAQ,CAAC,IAAI,CAACnC,iBAAiB,CAAC,EAAE;UAC7C,IAAI,CAACA,iBAAiB,GAAG,KAAK;QAChC;QAEA,IAAI,CAAC7D,OAAO,CAAC+F,UAAU,CAAC,IAAI,CAACb,QAAQ,CAAC,EAAE;UACtC,IAAI,CAACA,QAAQ,GAAGlF,OAAO,CAACkF,QAAQ;QAClC;QAEA,IAAI,CAAClF,OAAO,CAAC+F,UAAU,CAAC,IAAI,CAACd,eAAe,CAAC,EAAE;UAC7C,IAAI,CAACA,eAAe,GAAG,CAACmB,YAAY,EAAEC,OAAO,EAAEC,UAAU,KAAK;YAC5D,MAAMC,OAAO,GAAG,CAAC,CAAC;YAClB,QAAQH,YAAY;cACpB,KAAK,KAAK;gBACRG,OAAO,CAACC,MAAM,GAAG,SAAS;gBAC1BD,OAAO,CAAC,mBAAmB,CAAC,GAAG,SAAS;gBACxC;cACF,KAAK,KAAK;gBACRA,OAAO,CAAC,eAAe,CAAC,GAAG,UAAU;gBACrC;cACF,KAAK,KAAK;gBACRA,OAAO,CAAC,eAAe,CAAC,cAAAzD,MAAA,CAAcwD,UAAU,CAACG,IAAI,CAAE;gBACvD;cACF;gBACE;YACF;YAEAF,OAAO,CAACG,UAAU,GAAG,YAAY;YACjCH,OAAO,CAAC,cAAc,CAAC,GAAGD,UAAU,CAACK,IAAI,IAAI,0BAA0B;YACvEJ,OAAO,CAAC,eAAe,CAAC,GAAG,OAAO;YAClC,OAAOA,OAAO;UAChB,CAAC;QACH;QAEA,IAAI,IAAI,CAACvB,MAAM,IAAI,CAAC5B,WAAW,EAAE;UAC/B,MAAM,IAAI9C,MAAM,CAACuF,KAAK,CAAC,GAAG,sBAAA/C,MAAA,CAAsB,IAAI,CAACc,cAAc,wJAA+I,CAAC;QACrN;QAEA,IAAI,CAACR,WAAW,EAAE;UAChBA,WAAW,GAAG,SAAAA,CAAA,EAAY;YACxB,gBAAAN,MAAA,CAAgB3B,QAAQ,CAACyF,GAAG,SAAA9D,MAAA,CAAM3B,QAAQ,CAACyF,GAAG,aAAA9D,MAAA,CAAU3B,QAAQ,CAACyF,GAAG,EAAA9D,MAAA,CAAGuC,IAAI,CAACzB,cAAc;UAC5F,CAAC;QACH;QAEA,IAAI5D,OAAO,CAACyF,QAAQ,CAACrC,WAAW,CAAC,EAAE;UACjC,IAAI,CAACA,WAAW,GAAG,MAAMA,WAAW;QACtC,CAAC,MAAM;UACL,IAAI,CAACA,WAAW,GAAG,YAAY;YAC7B,IAAIyD,EAAE,GAAGzD,WAAW,CAAC0D,KAAK,CAACzB,IAAI,EAAE0B,SAAS,CAAC;YAC3C,IAAI,CAAC/G,OAAO,CAACyF,QAAQ,CAACoB,EAAE,CAAC,EAAE;cACzB,MAAM,IAAIvG,MAAM,CAACuF,KAAK,CAAC,GAAG,sBAAA/C,MAAA,CAAsBuC,IAAI,CAACzB,cAAc,qDAAgD,CAAC;YACtH;YACAiD,EAAE,GAAGA,EAAE,CAACf,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC;YAC1B,OAAO3E,QAAQ,CAAC6F,SAAS,CAACH,EAAE,CAAC;UAC/B,CAAC;QACH;QAEA,IAAI,CAAChE,MAAM,CAAC,uCAAuC,EAAE,IAAI,CAACO,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC;QAE1E,IAAI;UACFnC,EAAE,CAACgG,SAAS,CAAC,IAAI,CAAC7D,WAAW,CAAC,CAAC,CAAC,CAAC,EAAE;YACjC8D,IAAI,EAAE,IAAI,CAACrC,oBAAoB;YAC/BsC,SAAS,EAAE;UACb,CAAC,CAAC;QACJ,CAAC,CAAC,OAAOC,KAAK,EAAE;UACd,IAAIA,KAAK,EAAE;YACT,MAAM,IAAI9G,MAAM,CAACuF,KAAK,CAAC,GAAG,sBAAA/C,MAAA,CAAsBuC,IAAI,CAACzB,cAAc,eAAAd,MAAA,CAAW,IAAI,CAACM,WAAW,CAAC,CAAC,CAAC,CAAC,0BAAsBgE,KAAK,CAAC;UAChI;QACF;QAEA3G,KAAK,CAAC,IAAI,CAAC2E,MAAM,EAAEiC,OAAO,CAAC;QAC3B5G,KAAK,CAAC,IAAI,CAACqE,WAAW,EAAEwC,MAAM,CAAC;QAC/B7G,KAAK,CAAC,IAAI,CAAC2C,WAAW,EAAEmE,QAAQ,CAAC;QACjC9G,KAAK,CAAC,IAAI,CAACiD,YAAY,EAAEkC,MAAM,CAAC;QAChCnF,KAAK,CAAC,IAAI,CAAC+D,aAAa,EAAE9D,KAAK,CAAC8G,KAAK,CAAC,KAAK,EAAED,QAAQ,CAAC,CAAC;QACvD9G,KAAK,CAAC,IAAI,CAACgE,aAAa,EAAE/D,KAAK,CAAC8G,KAAK,CAAC,KAAK,EAAED,QAAQ,CAAC,CAAC;QACvD9G,KAAK,CAAC,IAAI,CAACuD,aAAa,EAAEqD,OAAO,CAAC;QAClC5G,KAAK,CAAC,IAAI,CAAC2D,cAAc,EAAEiD,OAAO,CAAC;QACnC5G,KAAK,CAAC,IAAI,CAACiE,cAAc,EAAEhE,KAAK,CAAC8G,KAAK,CAAC,KAAK,EAAED,QAAQ,CAAC,CAAC;QACxD9G,KAAK,CAAC,IAAI,CAACsD,eAAe,EAAEsD,OAAO,CAAC;QACpC5G,KAAK,CAAC,IAAI,CAACwD,gBAAgB,EAAEvD,KAAK,CAAC8G,KAAK,CAAC,KAAK,EAAED,QAAQ,CAAC,CAAC;QAC1D9G,KAAK,CAAC,IAAI,CAAC6D,gBAAgB,EAAE5D,KAAK,CAAC8G,KAAK,CAAC,KAAK,EAAED,QAAQ,CAAC,CAAC;QAC1D9G,KAAK,CAAC,IAAI,CAAC4D,iBAAiB,EAAE3D,KAAK,CAAC8G,KAAK,CAAC,KAAK,EAAED,QAAQ,CAAC,CAAC;QAC3D9G,KAAK,CAAC,IAAI,CAACoD,iBAAiB,EAAEyD,MAAM,CAAC;QACrC7G,KAAK,CAAC,IAAI,CAACwE,eAAe,EAAEvE,KAAK,CAAC8G,KAAK,CAAC/E,MAAM,EAAE8E,QAAQ,CAAC,CAAC;QAC1D9G,KAAK,CAAC,IAAI,CAAC+C,cAAc,EAAE9C,KAAK,CAAC8G,KAAK,CAACH,OAAO,EAAEI,MAAM,CAAC,CAAC;QACxDhH,KAAK,CAAC,IAAI,CAACgD,uBAAuB,EAAE4D,OAAO,CAAC;QAE5C,IAAI,CAACK,QAAQ,GAAG,IAAIlH,OAAO,CAAC;UAC1BiD,uBAAuB,EAAE,IAAI,CAACA,uBAAuB;UACrDkE,qBAAqB,EAAE,IAAI,CAACnE;QAC9B,CAAC,CAAC;QAEF,IAAI,CAAC,IAAI,CAACQ,aAAa,EAAE;UACvB,IAAI,CAAChE,OAAO,CAACyF,QAAQ,CAAC,IAAI,CAACnC,kBAAkB,CAAC,IAAI,CAAC,IAAI,CAACD,cAAc,EAAE;YACtE,IAAI,CAACC,kBAAkB,YAAAR,MAAA,CAAY,IAAI,CAACc,cAAc,CAAE;UAC1D;UAEA,IAAI,CAAC,IAAI,CAACP,cAAc,EAAE;YACxB,IAAI,CAACA,cAAc,GAAG,IAAIpD,KAAK,CAACyF,UAAU,CAAC,IAAI,CAACpC,kBAAkB,CAAC;UACrE,CAAC,MAAM;YACL,IAAI,CAACA,kBAAkB,GAAG,IAAI,CAACD,cAAc,CAACL,KAAK;UACrD;UACAvC,KAAK,CAAC,IAAI,CAAC6C,kBAAkB,EAAEsC,MAAM,CAAC;UAEtChE,WAAW,CAAC,IAAI,CAACyB,cAAc,EAAE;YAAEuE,SAAS,EAAE;UAAE,CAAC,EAAE;YAAEC,kBAAkB,EAAE,IAAI,CAAChE,iBAAiB;YAAEiE,UAAU,EAAE;UAAK,CAAC,CAAC;UACpH,MAAMC,oBAAoB,GAAG,IAAI,CAAC1E,cAAc,CAAC2E,IAAI,CAAC,CAAC,CAAC,EAAE;YACxDC,MAAM,EAAE;cACNC,GAAG,EAAE,CAAC;cACNC,UAAU,EAAE;YACd;UACF,CAAC,CAAC;UAEFJ,oBAAoB,CAACK,OAAO,CAAC;YAC3B,MAAMC,OAAOA,CAACC,GAAG,EAAE;cACjB,IAAIA,GAAG,CAACH,UAAU,EAAE;gBAClB9C,IAAI,CAACxC,MAAM,gEAAAC,MAAA,CAAgEwF,GAAG,CAACJ,GAAG,CAAE,CAAC;gBACrF,MAAM7C,IAAI,CAAChC,cAAc,CAACkF,WAAW,CAAC;kBAACL,GAAG,EAAEI,GAAG,CAACJ;gBAAG,CAAC,CAAC;cACvD;YACF,CAAC;YACD,MAAMM,OAAOA,CAACF,GAAG,EAAE;cACjB;cACA;cACAjD,IAAI,CAACxC,MAAM,gEAAAC,MAAA,CAAgEwF,GAAG,CAACJ,GAAG,CAAE,CAAC;cACrF,IAAIlI,OAAO,CAACkG,QAAQ,CAACb,IAAI,CAACc,eAAe,CAACmC,GAAG,CAACJ,GAAG,CAAC,CAAC,EAAE;gBACnD7C,IAAI,CAACc,eAAe,CAACmC,GAAG,CAACJ,GAAG,CAAC,CAACO,IAAI,CAAC,CAAC;gBACpCpD,IAAI,CAACc,eAAe,CAACmC,GAAG,CAACJ,GAAG,CAAC,CAACQ,GAAG,CAAC,CAAC;;gBAEnC;gBACA;gBACA,IAAI,CAACJ,GAAG,CAACH,UAAU,IAAI,CAAC,MAAM9C,IAAI,CAACrD,UAAU,CAACgG,IAAI,CAAC;kBAAEE,GAAG,EAAEI,GAAG,CAACJ;gBAAI,CAAC,CAAC,CAACS,UAAU,CAAC,CAAC,MAAM,CAAC,EAAE;kBACxFtD,IAAI,CAACxC,MAAM,+EAAAC,MAAA,CAA+EwF,GAAG,CAACJ,GAAG,CAAE,CAAC;kBACpG7C,IAAI,CAACc,eAAe,CAACmC,GAAG,CAACJ,GAAG,CAAC,CAACU,KAAK,CAAC,CAAC;gBACvC;gBAEA,OAAOvD,IAAI,CAACc,eAAe,CAACmC,GAAG,CAACJ,GAAG,CAAC;cACtC;YACF;UACF,CAAC,CAAC;UAEF,IAAI,CAACW,aAAa,GAAG,CAACX,GAAG,EAAEY,IAAI,EAAE/G,IAAI,KAAK;YACxC,IAAI,CAACoE,eAAe,CAAC+B,GAAG,CAAC,GAAG,IAAIvH,WAAW,CAACmI,IAAI,EAAE/G,IAAI,CAACgH,UAAU,EAAEhH,IAAI,EAAE,IAAI,CAAC+C,WAAW,CAAC;UAC5F,CAAC;;UAED;UACA;UACA,IAAI,CAACkE,eAAe,GAAG,MAAOd,GAAG,IAAK;YACpC,IAAI,IAAI,CAAC/B,eAAe,CAAC+B,GAAG,CAAC,IAAI,IAAI,CAAC/B,eAAe,CAAC+B,GAAG,CAAC,CAACe,IAAI,EAAE;cAC/D,IAAI,CAAC,IAAI,CAAC9C,eAAe,CAAC+B,GAAG,CAAC,CAACgB,OAAO,IAAI,CAAC,IAAI,CAAC/C,eAAe,CAAC+B,GAAG,CAAC,CAACiB,KAAK,EAAE;gBAC1E,OAAO,IAAI,CAAChD,eAAe,CAAC+B,GAAG,CAAC,CAACe,IAAI;cACvC;cACA,IAAI,CAACJ,aAAa,CAACX,GAAG,EAAE,IAAI,CAAC/B,eAAe,CAAC+B,GAAG,CAAC,CAACe,IAAI,CAACA,IAAI,CAACH,IAAI,EAAE,IAAI,CAAC3C,eAAe,CAAC+B,GAAG,CAAC,CAACe,IAAI,CAAC;cACjG,OAAO,IAAI,CAAC9C,eAAe,CAAC+B,GAAG,CAAC,CAACe,IAAI;YACvC;YACA,MAAMG,QAAQ,GAAG,MAAM,IAAI,CAAC/F,cAAc,CAACgG,YAAY,CAAC;cAACnB;YAAG,CAAC,CAAC;YAC9D,IAAIkB,QAAQ,EAAE;cACZ,IAAI,CAACP,aAAa,CAACX,GAAG,EAAEkB,QAAQ,CAACH,IAAI,CAACH,IAAI,EAAEM,QAAQ,CAAC;cACrD,OAAO,IAAI,CAACjD,eAAe,CAAC+B,GAAG,CAAC,CAACe,IAAI;YACvC;YACA,OAAO,KAAK;UACd,CAAC;QACH;QAEA,IAAI,CAAC,IAAI,CAAC9D,MAAM,EAAE;UAChB,IAAI,CAACA,MAAM,GAAGtE,mBAAmB,CAACsE,MAAM;QAC1C;QAEA1E,KAAK,CAAC,IAAI,CAACqD,KAAK,EAAEuD,OAAO,CAAC;QAC1B5G,KAAK,CAAC,IAAI,CAAC0E,MAAM,EAAE1C,MAAM,CAAC;QAC1BhC,KAAK,CAAC,IAAI,CAACuE,MAAM,EAAEqC,OAAO,CAAC;QAC3B5G,KAAK,CAAC,IAAI,CAAC0D,OAAO,EAAEzD,KAAK,CAAC8G,KAAK,CAAC,KAAK,EAAED,QAAQ,CAAC,CAAC;QACjD9G,KAAK,CAAC,IAAI,CAACsE,SAAS,EAAErE,KAAK,CAAC8G,KAAK,CAACH,OAAO,EAAEE,QAAQ,CAAC,CAAC;QACrD9G,KAAK,CAAC,IAAI,CAACkD,SAAS,EAAE2D,MAAM,CAAC;QAC7B7G,KAAK,CAAC,IAAI,CAACyD,aAAa,EAAE0B,MAAM,CAAC;QACjCnF,KAAK,CAAC,IAAI,CAAC8D,cAAc,EAAE7D,KAAK,CAAC8G,KAAK,CAAC,KAAK,EAAED,QAAQ,CAAC,CAAC;QACxD9G,KAAK,CAAC,IAAI,CAACkE,cAAc,EAAEjE,KAAK,CAAC8G,KAAK,CAAC,KAAK,EAAED,QAAQ,CAAC,CAAC;QACxD9G,KAAK,CAAC,IAAI,CAACmE,gBAAgB,EAAElE,KAAK,CAAC8G,KAAK,CAAC,KAAK,EAAED,QAAQ,CAAC,CAAC;QAC1D9G,KAAK,CAAC,IAAI,CAAC8C,eAAe,EAAE8D,OAAO,CAAC;QAEpC,IAAI,IAAI,CAACrC,MAAM,IAAI,IAAI,CAACD,SAAS,EAAE;UACjC,MAAM,IAAIzE,MAAM,CAACuF,KAAK,CAAC,GAAG,sBAAA/C,MAAA,CAAsB,IAAI,CAACc,cAAc,+DAA4D,CAAC;QAClI;QAEA,IAAI,CAAC0F,YAAY,GAAG,MAAOC,IAAI,IAAK;UAClC,IAAI,IAAI,CAACxE,SAAS,EAAE;YAClB,IAAIyE,MAAM;YACV,MAAM;cAACC,SAAS;cAAEC;YAAM,CAAC,GAAG,IAAI,CAACC,QAAQ,CAACJ,IAAI,CAAC;YAE/C,IAAIvJ,OAAO,CAAC+F,UAAU,CAAC,IAAI,CAAChB,SAAS,CAAC,EAAE;cACtC,IAAIsB,OAAO;cACX,IAAIrG,OAAO,CAACkG,QAAQ,CAACqD,IAAI,CAACK,MAAM,CAAC,IAAKL,IAAI,CAACK,MAAM,CAAC1B,GAAG,EAAE;gBACrD7B,OAAO,GAAG,MAAM,IAAI,CAACrE,UAAU,CAACqH,YAAY,CAACE,IAAI,CAACK,MAAM,CAAC1B,GAAG,CAAC;cAC/D;cAEAsB,MAAM,GAAGD,IAAI,GAAG,MAAM,IAAI,CAACxE,SAAS,CAAC8E,IAAI,CAACpH,MAAM,CAACqH,MAAM,CAACP,IAAI,EAAE;gBAACE,SAAS;gBAAEC;cAAM,CAAC,CAAC,EAAGrD,OAAO,IAAI,IAAK,CAAC,GAAG,MAAM,IAAI,CAACtB,SAAS,CAAC8E,IAAI,CAAC;gBAACJ,SAAS;gBAAEC;cAAM,CAAC,EAAGrD,OAAO,IAAI,IAAK,CAAC;YAC5K,CAAC,MAAM;cACLmD,MAAM,GAAG,CAAC,CAACE,MAAM;YACnB;YAEA,IAAKH,IAAI,IAAKC,MAAM,KAAK,IAAK,IAAK,CAACD,IAAI,EAAE;cACxC,OAAO,IAAI;YACb;YAEA,MAAMQ,EAAE,GAAG/J,OAAO,CAACgG,QAAQ,CAACwD,MAAM,CAAC,GAAGA,MAAM,GAAG,GAAG;YAClD,IAAI,CAAC3G,MAAM,CAAC,qDAAqD,CAAC;YAClE,IAAI0G,IAAI,EAAE;cACR,MAAMS,IAAI,GAAG,gBAAgB;cAC7B,IAAI,CAACT,IAAI,CAACU,QAAQ,CAACC,WAAW,EAAE;gBAC9BX,IAAI,CAACU,QAAQ,CAACE,SAAS,CAACJ,EAAE,EAAE;kBAC1B,cAAc,EAAE,YAAY;kBAC5B,gBAAgB,EAAEC,IAAI,CAACI;gBACzB,CAAC,CAAC;cACJ;cAEA,IAAI,CAACb,IAAI,CAACU,QAAQ,CAACI,QAAQ,EAAE;gBAC3Bd,IAAI,CAACU,QAAQ,CAACvB,GAAG,CAACsB,IAAI,CAAC;cACzB;YACF;YAEA,OAAO,KAAK;UACd;UACA,OAAO,IAAI;QACb,CAAC;QAED,IAAI,CAACM,YAAY,GAAG;UAClBC,MAAM,2BAAAzH,MAAA,CAA2B,IAAI,CAACc,cAAc,CAAE;UACtD4G,MAAM,2BAAA1H,MAAA,CAA2B,IAAI,CAACc,cAAc,CAAE;UACtD6G,MAAM,2BAAA3H,MAAA,CAA2B,IAAI,CAACc,cAAc,CAAE;UACtD8G,OAAO,4BAAA5H,MAAA,CAA4B,IAAI,CAACc,cAAc;QACxD,CAAC;QAED,IAAI,CAAC+G,EAAE,CAAC,eAAe,EAAE,IAAI,CAACC,aAAa,CAAC;QAC5C,IAAI,CAACD,EAAE,CAAC,eAAe,EAAE,IAAI,CAACE,aAAa,CAAC;QAC5C,IAAI,CAACC,iBAAiB,GAAGxK,MAAM,CAACyK,SAAS,CAAC,IAAI,CAACH,aAAa,CAACI,IAAI,CAAC,IAAI,CAAC,CAAC;QAExE,IAAI,IAAI,CAAChH,aAAa,IAAI,IAAI,CAACD,eAAe,EAAE;UAC9C;QACF;QACA1D,MAAM,CAAC4K,eAAe,CAACC,GAAG,CAAC,OAAOC,OAAO,EAAEC,QAAQ,EAAEC,IAAI,KAAK;UAC5D,IAAI,IAAI,CAAC7H,cAAc,IAAI2H,OAAO,CAACG,UAAU,CAACxC,IAAI,CAACyC,QAAQ,IAAAzI,MAAA,CAAI,IAAI,CAACoB,aAAa,MAAG,CAAC,IAAI,CAACkH,QAAQ,CAAClB,WAAW,EAAE;YAC9G,IAAI,IAAI,CAAC1G,cAAc,CAACgI,IAAI,CAACL,OAAO,CAAC5E,OAAO,CAACkF,MAAM,CAAC,EAAE;cACpDL,QAAQ,CAACM,SAAS,CAAC,kCAAkC,EAAE,MAAM,CAAC;cAC9DN,QAAQ,CAACM,SAAS,CAAC,6BAA6B,EAAEP,OAAO,CAAC5E,OAAO,CAACkF,MAAM,CAAC;YAC3E;YAEA,IAAIN,OAAO,CAACQ,MAAM,KAAK,SAAS,EAAE;cAChCP,QAAQ,CAACM,SAAS,CAAC,8BAA8B,EAAE,oBAAoB,CAAC;cACxEN,QAAQ,CAACM,SAAS,CAAC,8BAA8B,EAAE,kEAAkE,CAAC;cACtHN,QAAQ,CAACM,SAAS,CAAC,+BAA+B,EAAE,gEAAgE,CAAC;cACrHN,QAAQ,CAACM,SAAS,CAAC,OAAO,EAAE,oBAAoB,CAAC;cACjDN,QAAQ,CAACjB,SAAS,CAAC,GAAG,CAAC;cACvBiB,QAAQ,CAAC1C,GAAG,CAAC,CAAC;cACd;YACF;UACF;UAEA,IAAI,CAAC,IAAI,CAAC1E,aAAa,IAAImH,OAAO,CAACG,UAAU,CAACxC,IAAI,CAACyC,QAAQ,IAAAzI,MAAA,CAAI,IAAI,CAACoB,aAAa,OAAApB,MAAA,CAAI,IAAI,CAACc,cAAc,cAAW,CAAC,EAAE;YACpH,IAAIuH,OAAO,CAACQ,MAAM,KAAK,MAAM,EAAE;cAC7BN,IAAI,CAAC,CAAC;cACN;YACF;YAEA,MAAMO,WAAW,GAAIC,MAAM,IAAK;cAC9B,IAAIzE,KAAK,GAAGyE,MAAM;cAClBvL,MAAM,CAACuC,MAAM,CAAC,8CAA8C,EAAEuE,KAAK,CAAC;cAEpE,IAAI,CAACgE,QAAQ,CAAClB,WAAW,EAAE;gBACzBkB,QAAQ,CAACjB,SAAS,CAAC,GAAG,CAAC;cACzB;cAEA,IAAI,CAACiB,QAAQ,CAACf,QAAQ,EAAE;gBACtB,IAAIrK,OAAO,CAACkG,QAAQ,CAACkB,KAAK,CAAC,IAAIpH,OAAO,CAAC+F,UAAU,CAACqB,KAAK,CAAC0E,QAAQ,CAAC,EAAE;kBACjE1E,KAAK,GAAGA,KAAK,CAAC0E,QAAQ,CAAC,CAAC;gBAC1B;gBAEA,IAAI,CAAC9L,OAAO,CAACyF,QAAQ,CAAC2B,KAAK,CAAC,EAAE;kBAC5BA,KAAK,GAAG,mBAAmB;gBAC7B;gBAEAgE,QAAQ,CAAC1C,GAAG,CAACqD,IAAI,CAACC,SAAS,CAAC;kBAAE5E;gBAAM,CAAC,CAAC,CAAC;cACzC;YACF,CAAC;YAED,IAAI6E,IAAI,GAAG,EAAE;YACb,MAAMC,UAAU,GAAG,MAAAA,CAAA,KAAY;cAC7B,IAAI;gBACF,IAAInK,IAAI;gBACR,IAAIyH,MAAM;gBACV,IAAI2C,IAAI,GAAG,IAAI,CAACxC,QAAQ,CAAC;kBAACyC,OAAO,EAAEjB,OAAO;kBAAElB,QAAQ,EAAEmB;gBAAQ,CAAC,CAAC;gBAEhE,IAAID,OAAO,CAAC5E,OAAO,CAAC,SAAS,CAAC,KAAK,GAAG,EAAE;kBACtC;kBACAxE,IAAI,GAAG;oBACLsK,MAAM,EAAE,IAAI,CAACnH,QAAQ,CAACiG,OAAO,CAAC5E,OAAO,CAAC,UAAU,CAAC,EAAE,EAAE,EAAE,GAAG;kBAC5D,CAAC;kBAED,IAAI4E,OAAO,CAAC5E,OAAO,CAAC,OAAO,CAAC,KAAK,GAAG,EAAE;oBACpCxE,IAAI,CAACuK,GAAG,GAAG,IAAI;kBACjB,CAAC,MAAM;oBACLvK,IAAI,CAACwK,OAAO,GAAGC,MAAM,CAACC,IAAI,CAACR,IAAI,EAAE,QAAQ,CAAC;oBAC1ClK,IAAI,CAAC2K,OAAO,GAAGzG,QAAQ,CAACkF,OAAO,CAAC5E,OAAO,CAAC,WAAW,CAAC,CAAC;kBACvD;kBAEA,MAAMyC,eAAe,GAAG,MAAM,IAAI,CAACA,eAAe,CAACjH,IAAI,CAACsK,MAAM,CAAC;kBAC/D,IAAI,CAACrD,eAAe,EAAE;oBACpB,MAAM,IAAI1I,MAAM,CAACuF,KAAK,CAAC,GAAG,EAAE,8DAA8D,CAAC;kBAC7F;kBAEA,CAAC;oBAAC2D,MAAM;oBAAEzH;kBAAI,CAAC,GAAG,MAAM,IAAI,CAAC4K,cAAc,CAAClK,MAAM,CAACqH,MAAM,CAAC/H,IAAI,EAAEiH,eAAe,CAAC,EAAEmD,IAAI,CAACzC,MAAM,EAAE,MAAM,CAAC;kBAEtG,IAAI3H,IAAI,CAACuK,GAAG,EAAE;oBACZ;oBACA,IAAI,CAAC1B,aAAa,CAACpB,MAAM,EAAEzH,IAAI,EAAG8J,MAAM,IAAK;sBAC3C,IAAIzE,KAAK,GAAGyE,MAAM;sBAClB,IAAIzE,KAAK,EAAE;wBACT,IAAI,CAACgE,QAAQ,CAAClB,WAAW,EAAE;0BACzBkB,QAAQ,CAACjB,SAAS,CAAC,GAAG,CAAC;wBACzB;wBAEA,IAAI,CAACiB,QAAQ,CAACf,QAAQ,EAAE;0BACtB,IAAIrK,OAAO,CAACkG,QAAQ,CAACkB,KAAK,CAAC,IAAIpH,OAAO,CAAC+F,UAAU,CAACqB,KAAK,CAAC0E,QAAQ,CAAC,EAAE;4BACjE1E,KAAK,GAAGA,KAAK,CAAC0E,QAAQ,CAAC,CAAC;0BAC1B;0BAEA,IAAI,CAAC9L,OAAO,CAACyF,QAAQ,CAAC2B,KAAK,CAAC,EAAE;4BAC5BA,KAAK,GAAG,mBAAmB;0BAC7B;0BAEAgE,QAAQ,CAAC1C,GAAG,CAACqD,IAAI,CAACC,SAAS,CAAC;4BAAE5E;0BAAM,CAAC,CAAC,CAAC;wBACzC;sBACF;sBAEA,IAAI,CAACgE,QAAQ,CAAClB,WAAW,EAAE;wBACzBkB,QAAQ,CAACjB,SAAS,CAAC,GAAG,CAAC;sBACzB;sBAEA,IAAInK,OAAO,CAACkG,QAAQ,CAACsD,MAAM,CAACP,IAAI,CAAC,IAAIO,MAAM,CAACP,IAAI,CAAC2D,IAAI,EAAE;wBACrDpD,MAAM,CAACP,IAAI,CAAC2D,IAAI,GAAG7L,gBAAgB,CAACyI,MAAM,CAACP,IAAI,CAAC2D,IAAI,CAAC;sBACvD;sBAEA,IAAI,CAACxB,QAAQ,CAACf,QAAQ,EAAE;wBACtBe,QAAQ,CAAC1C,GAAG,CAACqD,IAAI,CAACC,SAAS,CAACxC,MAAM,CAAC,CAAC;sBACtC;oBACF,CAAC,CAAC;oBACF;kBACF;kBAEA,IAAI,CAACqD,IAAI,CAAC,eAAe,EAAErD,MAAM,EAAEzH,IAAI,EAAEJ,IAAI,CAAC;kBAE9C,IAAI,CAACyJ,QAAQ,CAAClB,WAAW,EAAE;oBACzBkB,QAAQ,CAACjB,SAAS,CAAC,GAAG,CAAC;kBACzB;kBACA,IAAI,CAACiB,QAAQ,CAACf,QAAQ,EAAE;oBACtBe,QAAQ,CAAC1C,GAAG,CAAC,CAAC;kBAChB;gBACF,CAAC,MAAM;kBACL;kBACA,IAAI;oBACF3G,IAAI,GAAGgK,IAAI,CAACe,KAAK,CAACb,IAAI,CAAC;kBACzB,CAAC,CAAC,OAAOc,OAAO,EAAE;oBAChBzM,MAAM,CAACuC,MAAM,CAAC,uFAAuF,EAAEkK,OAAO,CAAC;oBAC/GhL,IAAI,GAAG;sBAACkH,IAAI,EAAE,CAAC;oBAAC,CAAC;kBACnB;kBAEA,IAAI,CAACjJ,OAAO,CAACkG,QAAQ,CAACnE,IAAI,CAACkH,IAAI,CAAC,EAAE;oBAChClH,IAAI,CAACkH,IAAI,GAAG,CAAC,CAAC;kBAChB;kBAEA,IAAIlH,IAAI,CAACsK,MAAM,EAAE;oBACftK,IAAI,CAACsK,MAAM,GAAG,IAAI,CAACnH,QAAQ,CAACnD,IAAI,CAACsK,MAAM,EAAE,EAAE,EAAE,GAAG,CAAC;kBACnD;kBAEA,IAAI,CAACxJ,MAAM,wCAAAC,MAAA,CAAwCf,IAAI,CAACkH,IAAI,CAACtG,IAAI,IAAI,WAAW,SAAAG,MAAA,CAAMf,IAAI,CAACsK,MAAM,CAAE,CAAC;kBACpG,IAAIrM,OAAO,CAACkG,QAAQ,CAACnE,IAAI,CAACkH,IAAI,CAAC,IAAIlH,IAAI,CAACkH,IAAI,CAAC2D,IAAI,EAAE;oBACjD7K,IAAI,CAACkH,IAAI,CAAC2D,IAAI,GAAG9L,YAAY,CAACiB,IAAI,CAACkH,IAAI,CAAC2D,IAAI,CAAC;kBAC/C;kBAEA7K,IAAI,CAACiL,IAAI,GAAG,IAAI;kBAChB,CAAC;oBAACxD;kBAAM,CAAC,GAAG,MAAM,IAAI,CAACmD,cAAc,CAAC3M,OAAO,CAACiN,KAAK,CAAClL,IAAI,CAAC,EAAEoK,IAAI,CAACzC,MAAM,EAAE,mBAAmB,CAAC;kBAE5F,IAAIwD,GAAG;kBACPA,GAAG,GAAG,MAAM,IAAI,CAAClL,UAAU,CAACqH,YAAY,CAACG,MAAM,CAACtB,GAAG,CAAC;kBAEpD,IAAIgF,GAAG,EAAE;oBACP,MAAM,IAAI5M,MAAM,CAACuF,KAAK,CAAC,GAAG,EAAE,kDAAkD,CAAC;kBACjF;kBAEA9D,IAAI,CAACmG,GAAG,GAAGnG,IAAI,CAACsK,MAAM;kBACtBtK,IAAI,CAAC6F,SAAS,GAAG,IAAIuF,IAAI,CAAC,CAAC;kBAC3BpL,IAAI,CAACqL,SAAS,GAAGrL,IAAI,CAACgH,UAAU;kBAEhC,MAAM,IAAI,CAAC1F,cAAc,CAACgK,WAAW,CAACrN,OAAO,CAACsN,IAAI,CAACvL,IAAI,EAAE,MAAM,CAAC,CAAC;kBACjE,IAAI,CAAC8G,aAAa,CAACW,MAAM,CAACtB,GAAG,EAAEsB,MAAM,CAACV,IAAI,EAAE9I,OAAO,CAACsN,IAAI,CAACvL,IAAI,EAAE,MAAM,CAAC,CAAC;kBAEvE,IAAIA,IAAI,CAACwL,UAAU,EAAE;oBACnB,IAAI,CAACnC,QAAQ,CAAClB,WAAW,EAAE;sBACzBkB,QAAQ,CAACjB,SAAS,CAAC,GAAG,CAAC;oBACzB;oBAEA,IAAI,CAACiB,QAAQ,CAACf,QAAQ,EAAE;sBACtBe,QAAQ,CAAC1C,GAAG,CAACqD,IAAI,CAACC,SAAS,CAAC;wBAC1BwB,WAAW,KAAA1K,MAAA,CAAK,IAAI,CAACoB,aAAa,OAAApB,MAAA,CAAI,IAAI,CAACc,cAAc,cAAW;wBACpEqF,IAAI,EAAEO;sBACR,CAAC,CAAC,CAAC;oBACL;kBACF,CAAC,MAAM;oBACL,IAAI,CAAC4B,QAAQ,CAAClB,WAAW,EAAE;sBACzBkB,QAAQ,CAACjB,SAAS,CAAC,GAAG,CAAC;oBACzB;oBAEA,IAAI,CAACiB,QAAQ,CAACf,QAAQ,EAAE;sBACtBe,QAAQ,CAAC1C,GAAG,CAAC,CAAC;oBAChB;kBACF;gBACF;cACF,CAAC,CAAC,OAAO+E,WAAW,EAAE;gBACpB7B,WAAW,CAAC6B,WAAW,CAAC;cAC1B;YACF,CAAC;YAEDtC,OAAO,CAACuC,UAAU,CAAC,KAAK,EAAE9B,WAAW,CAAC;YACtC,IAAI,OAAOT,OAAO,CAACc,IAAI,KAAK,QAAQ,IAAIxJ,MAAM,CAACX,IAAI,CAACqJ,OAAO,CAACc,IAAI,CAAC,CAAC7B,MAAM,KAAK,CAAC,EAAE;cAC9E6B,IAAI,GAAGF,IAAI,CAACC,SAAS,CAACb,OAAO,CAACc,IAAI,CAAC;cACnCC,UAAU,CAAC,CAAC;YACd,CAAC,MAAM;cACLf,OAAO,CAACR,EAAE,CAAC,MAAM,EAAGgD,IAAI,IAAKnM,KAAK,CAAC,MAAM;gBACvCyK,IAAI,IAAI0B,IAAI;cACd,CAAC,CAAC,CAAC;cAEHxC,OAAO,CAACR,EAAE,CAAC,KAAK,EAAE,MAAMnJ,KAAK,CAAC,MAAM;gBAClC0K,UAAU,CAAC,CAAC;cACd,CAAC,CAAC,CAAC;YACL;YACA;UACF;UAEA,IAAI,CAAC,IAAI,CAACnI,eAAe,EAAE;YACzB,IAAI6J,GAAG;YAEP,IAAI,CAAC,IAAI,CAAC5I,MAAM,EAAE;cAChB,IAAImG,OAAO,CAACG,UAAU,CAACxC,IAAI,CAACyC,QAAQ,IAAAzI,MAAA,CAAI,IAAI,CAACoB,aAAa,OAAApB,MAAA,CAAI,IAAI,CAACc,cAAc,CAAE,CAAC,EAAE;gBACpFgK,GAAG,GAAGzC,OAAO,CAACG,UAAU,CAACxC,IAAI,CAAChD,OAAO,IAAAhD,MAAA,CAAI,IAAI,CAACoB,aAAa,OAAApB,MAAA,CAAI,IAAI,CAACc,cAAc,GAAI,EAAE,CAAC;gBACzF,IAAIgK,GAAG,CAACC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE;kBAC1BD,GAAG,GAAGA,GAAG,CAACE,SAAS,CAAC,CAAC,CAAC;gBACxB;gBAEA,MAAMC,IAAI,GAAGH,GAAG,CAACI,KAAK,CAAC,GAAG,CAAC;gBAC3B,IAAID,IAAI,CAAC3D,MAAM,KAAK,CAAC,EAAE;kBACrB,MAAMR,MAAM,GAAG;oBACb1B,GAAG,EAAE6F,IAAI,CAAC,CAAC,CAAC;oBACZE,KAAK,EAAE9C,OAAO,CAACG,UAAU,CAAC2C,KAAK,GAAG/M,MAAM,CAAC4L,KAAK,CAAC3B,OAAO,CAACG,UAAU,CAAC2C,KAAK,CAAC,GAAG,CAAC,CAAC;oBAC7EtL,IAAI,EAAEoL,IAAI,CAAC,CAAC,CAAC,CAACC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;oBAC3BE,OAAO,EAAEH,IAAI,CAAC,CAAC;kBACjB,CAAC;kBAED,MAAMxE,IAAI,GAAG;oBAAC6C,OAAO,EAAEjB,OAAO;oBAAElB,QAAQ,EAAEmB,QAAQ;oBAAExB;kBAAM,CAAC;kBAE3D,IAAI,IAAI,CAACtF,gBAAgB,IAAItE,OAAO,CAAC+F,UAAU,CAAC,IAAI,CAACzB,gBAAgB,CAAC,IAAI,CAAC,MAAM,IAAI,CAACA,gBAAgB,CAACiF,IAAI,CAAC,MAAM,IAAI,EAAE;oBACtH;kBACF;kBAEA,IAAI,MAAM,IAAI,CAACD,YAAY,CAACC,IAAI,CAAC,EAAE;oBACjC,MAAM,IAAI,CAAC4E,QAAQ,CAAC5E,IAAI,EAAEwE,IAAI,CAAC,CAAC,CAAC,EAAE,MAAM,IAAI,CAAC/L,UAAU,CAACqH,YAAY,CAAC0E,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;kBACjF;gBACF,CAAC,MAAM;kBACL1C,IAAI,CAAC,CAAC;gBACR;cACF,CAAC,MAAM;gBACLA,IAAI,CAAC,CAAC;cACR;YACF,CAAC,MAAM;cACL,IAAIF,OAAO,CAACG,UAAU,CAACxC,IAAI,CAACyC,QAAQ,IAAAzI,MAAA,CAAI,IAAI,CAACoB,aAAa,CAAE,CAAC,EAAE;gBAC7D0J,GAAG,GAAGzC,OAAO,CAACG,UAAU,CAACxC,IAAI,CAAChD,OAAO,IAAAhD,MAAA,CAAI,IAAI,CAACoB,aAAa,GAAI,EAAE,CAAC;gBAClE,IAAI0J,GAAG,CAACC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE;kBAC1BD,GAAG,GAAGA,GAAG,CAACE,SAAS,CAAC,CAAC,CAAC;gBACxB;gBAEA,MAAMC,IAAI,GAAGH,GAAG,CAACI,KAAK,CAAC,GAAG,CAAC;gBAC3B,IAAII,KAAK,GAAGL,IAAI,CAACA,IAAI,CAAC3D,MAAM,GAAG,CAAC,CAAC;gBACjC,IAAIgE,KAAK,EAAE;kBACT,IAAIF,OAAO;kBACX,IAAIE,KAAK,CAAC7C,QAAQ,CAAC,GAAG,CAAC,EAAE;oBACvB2C,OAAO,GAAGE,KAAK,CAACJ,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;oBAC7BI,KAAK,GAAGA,KAAK,CAACJ,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAACA,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;kBAC3C,CAAC,MAAM;oBACLE,OAAO,GAAG,UAAU;oBACpBE,KAAK,GAAGA,KAAK,CAACJ,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;kBAC7B;kBAEA,MAAMpE,MAAM,GAAG;oBACbqE,KAAK,EAAE9C,OAAO,CAACG,UAAU,CAAC2C,KAAK,GAAG/M,MAAM,CAAC4L,KAAK,CAAC3B,OAAO,CAACG,UAAU,CAAC2C,KAAK,CAAC,GAAG,CAAC,CAAC;oBAC7EhF,IAAI,EAAEmF,KAAK;oBACXlG,GAAG,EAAEkG,KAAK,CAACJ,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;oBACxBE,OAAO;oBACPvL,IAAI,EAAEyL;kBACR,CAAC;kBACD,MAAM7E,IAAI,GAAG;oBAAC6C,OAAO,EAAEjB,OAAO;oBAAElB,QAAQ,EAAEmB,QAAQ;oBAAExB;kBAAM,CAAC;kBAC3D,IAAI,IAAI,CAACtF,gBAAgB,IAAItE,OAAO,CAAC+F,UAAU,CAAC,IAAI,CAACzB,gBAAgB,CAAC,IAAI,CAAC,MAAM,IAAI,CAACA,gBAAgB,CAACiF,IAAI,CAAC,MAAM,IAAI,EAAE;oBACtH;kBACF;kBACA,MAAM,IAAI,CAAC4E,QAAQ,CAAC5E,IAAI,EAAE2E,OAAO,EAAE,MAAM,IAAI,CAAClM,UAAU,CAACqH,YAAY,CAACO,MAAM,CAAC1B,GAAG,CAAC,CAAC;gBACpF,CAAC,MAAM;kBACLmD,IAAI,CAAC,CAAC;gBACR;cACF,CAAC,MAAM;gBACLA,IAAI,CAAC,CAAC;cACR;YACF;YACA;UACF;UACAA,IAAI,CAAC,CAAC;QACR,CAAC,CAAC;QAEF,IAAI,CAAC,IAAI,CAACrH,aAAa,EAAE;UACvB,MAAMqK,QAAQ,GAAG,CAAC,CAAC;;UAEnB;UACA;UACAA,QAAQ,CAAC,IAAI,CAAC/D,YAAY,CAACI,OAAO,CAAC,GAAG,gBAAgB4D,QAAQ,EAAE;YAC9D7N,KAAK,CAAC6N,QAAQ,EAAE5N,KAAK,CAAC8G,KAAK,CAAC5B,MAAM,EAAEnD,MAAM,CAAC,CAAC;YAC5C4C,IAAI,CAACxC,MAAM,+CAAAC,MAAA,CAA+CwL,QAAQ,OAAI,CAAC;YAEvE,IAAIjJ,IAAI,CAAC9B,eAAe,EAAE;cACxB,IAAI8B,IAAI,CAACX,cAAc,IAAI1E,OAAO,CAAC+F,UAAU,CAACV,IAAI,CAACX,cAAc,CAAC,EAAE;gBAClE,MAAMgF,MAAM,GAAG,IAAI,CAACA,MAAM;gBAC1B,MAAM6E,SAAS,GAAG;kBAChB7E,MAAM,EAAE,IAAI,CAACA,MAAM;kBACnBD,SAASA,CAAA,EAAE;oBACT,IAAInJ,MAAM,CAACkO,KAAK,EAAE;sBAChB,OAAOlO,MAAM,CAACkO,KAAK,CAACnF,YAAY,CAACK,MAAM,CAAC;oBAC1C;oBACA,OAAO,IAAI;kBACb;gBACF,CAAC;gBAED,IAAI,EAAE,MAAMrE,IAAI,CAACX,cAAc,CAACmF,IAAI,CAAC0E,SAAS,EAAGlJ,IAAI,CAAC2C,IAAI,CAACsG,QAAQ,CAAC,IAAI,IAAK,CAAC,CAAC,EAAE;kBAC/E,MAAM,IAAIhO,MAAM,CAACuF,KAAK,CAAC,GAAG,EAAE,2CAA2C,CAAC;gBAC1E;cACF;cAEA,MAAM4I,MAAM,GAAGpJ,IAAI,CAAC2C,IAAI,CAACsG,QAAQ,CAAC;cAClC,IAAI,CAAC,MAAMG,MAAM,CAAC9F,UAAU,CAAC,CAAC,IAAI,CAAC,EAAE;gBACnCtD,IAAI,CAACkD,WAAW,CAAC+F,QAAQ,CAAC;gBAC1B,OAAO,IAAI;cACb;cACA,MAAM,IAAIhO,MAAM,CAACuF,KAAK,CAAC,GAAG,EAAE,sCAAsC,CAAC;YACrE,CAAC,MAAM;cACL,MAAM,IAAIvF,MAAM,CAACuF,KAAK,CAAC,GAAG,EAAE,qEAAqE,CAAC;YACpG;UACF,CAAC;;UAGD;UACA;UACA;UACA;UACA;UACA;UACAwI,QAAQ,CAAC,IAAI,CAAC/D,YAAY,CAACG,MAAM,CAAC,GAAG,gBAAgB1I,IAAI,EAAEwL,UAAU,EAAE;YACrE9M,KAAK,CAACsB,IAAI,EAAE;cACVkH,IAAI,EAAExG,MAAM;cACZ4J,MAAM,EAAEzG,MAAM;cACd8I,MAAM,EAAEhO,KAAK,CAACiO,QAAQ,CAAC/I,MAAM,CAAC;cAC9BjC,SAAS,EAAE2D,MAAM;cACjByB,UAAU,EAAEzB;YACd,CAAC,CAAC;YAEF7G,KAAK,CAAC8M,UAAU,EAAE7M,KAAK,CAACiO,QAAQ,CAACtH,OAAO,CAAC,CAAC;YAE1CtF,IAAI,CAACsK,MAAM,GAAGhH,IAAI,CAACH,QAAQ,CAACnD,IAAI,CAACsK,MAAM,EAAE,EAAE,EAAE,GAAG,CAAC;YAEjDhH,IAAI,CAACxC,MAAM,0CAAAC,MAAA,CAA0Cf,IAAI,CAACkH,IAAI,CAACtG,IAAI,SAAAG,MAAA,CAAMf,IAAI,CAACsK,MAAM,CAAE,CAAC;YACvFtK,IAAI,CAACiL,IAAI,GAAG,IAAI;YAChB,MAAM;cAAExD;YAAO,CAAC,GAAG,MAAMnE,IAAI,CAACsH,cAAc,CAAC3M,OAAO,CAACiN,KAAK,CAAClL,IAAI,CAAC,EAAE,IAAI,CAAC2H,MAAM,EAAE,kBAAkB,CAAC;YAElG,IAAI,MAAMrE,IAAI,CAACrD,UAAU,CAACqH,YAAY,CAACG,MAAM,CAACtB,GAAG,CAAC,EAAE;cAClD,MAAM,IAAI5H,MAAM,CAACuF,KAAK,CAAC,GAAG,EAAE,kDAAkD,CAAC;YACjF;YAEA9D,IAAI,CAACmG,GAAG,GAAGnG,IAAI,CAACsK,MAAM;YACtBtK,IAAI,CAAC6F,SAAS,GAAG,IAAIuF,IAAI,CAAC,CAAC;YAC3BpL,IAAI,CAACqL,SAAS,GAAGrL,IAAI,CAACgH,UAAU;YAChC,IAAI;cACF,MAAM1D,IAAI,CAAChC,cAAc,CAACgK,WAAW,CAACrN,OAAO,CAACsN,IAAI,CAACvL,IAAI,EAAE,MAAM,CAAC,CAAC;cACjEsD,IAAI,CAACwD,aAAa,CAACW,MAAM,CAACtB,GAAG,EAAEsB,MAAM,CAACV,IAAI,EAAE9I,OAAO,CAACsN,IAAI,CAACvL,IAAI,EAAE,MAAM,CAAC,CAAC;YACzE,CAAC,CAAC,OAAOG,CAAC,EAAE;cACVmD,IAAI,CAACxC,MAAM,uDAAAC,MAAA,CAAuDf,IAAI,CAACkH,IAAI,CAACtG,IAAI,SAAAG,MAAA,CAAMf,IAAI,CAACsK,MAAM,GAAInK,CAAC,CAAC;cACvG,MAAM,IAAI5B,MAAM,CAACuF,KAAK,CAAC,GAAG,EAAE,cAAc,CAAC;YAC7C;YAEA,IAAI0H,UAAU,EAAE;cACd,OAAO;gBACLC,WAAW,KAAA1K,MAAA,CAAKuC,IAAI,CAACnB,aAAa,OAAApB,MAAA,CAAIuC,IAAI,CAACzB,cAAc,cAAW;gBACpEqF,IAAI,EAAEO;cACR,CAAC;YACH;YACA,OAAO,IAAI;UACb,CAAC;;UAGD;UACA;UACA;UACA6E,QAAQ,CAAC,IAAI,CAAC/D,YAAY,CAACE,MAAM,CAAC,GAAG,gBAAgBoE,KAAK,EAAE;YAC1D,IAAI7M,IAAI,GAAG6M,KAAK;YAChB,IAAIpF,MAAM;YACV/I,KAAK,CAACsB,IAAI,EAAE;cACVuK,GAAG,EAAE5L,KAAK,CAACiO,QAAQ,CAACtH,OAAO,CAAC;cAC5BgF,MAAM,EAAEzG,MAAM;cACd2G,OAAO,EAAE7L,KAAK,CAACiO,QAAQ,CAAC/I,MAAM,CAAC;cAC/B8G,OAAO,EAAEhM,KAAK,CAACiO,QAAQ,CAACrH,MAAM;YAChC,CAAC,CAAC;YAEFvF,IAAI,CAACsK,MAAM,GAAGhH,IAAI,CAACH,QAAQ,CAACnD,IAAI,CAACsK,MAAM,EAAE,EAAE,EAAE,GAAG,CAAC;YAEjD,IAAItK,IAAI,CAACwK,OAAO,EAAE;cAChBxK,IAAI,CAACwK,OAAO,GAAGC,MAAM,CAACC,IAAI,CAAC1K,IAAI,CAACwK,OAAO,EAAE,QAAQ,CAAC;YACpD;YAEA,MAAMvD,eAAe,GAAG,MAAM3D,IAAI,CAAC2D,eAAe,CAACjH,IAAI,CAACsK,MAAM,CAAC;YAC/D,IAAI,CAACrD,eAAe,EAAE;cACpB,MAAM,IAAI1I,MAAM,CAACuF,KAAK,CAAC,GAAG,EAAE,8DAA8D,CAAC;YAC7F;YAEA,CAAC;cAAC2D,MAAM;cAAEzH;YAAI,CAAC,GAAG,MAAMsD,IAAI,CAACsH,cAAc,CAAClK,MAAM,CAACqH,MAAM,CAAC/H,IAAI,EAAEiH,eAAe,CAAC,EAAE,IAAI,CAACU,MAAM,EAAE,KAAK,CAAC;YAErG,IAAI3H,IAAI,CAACuK,GAAG,EAAE;cACZ,IAAI;gBACF,OAAOjH,IAAI,CAACyF,iBAAiB,CAACtB,MAAM,EAAEzH,IAAI,CAAC;cAC7C,CAAC,CAAC,OAAO8M,eAAe,EAAE;gBACxBxJ,IAAI,CAACxC,MAAM,CAAC,mDAAmD,EAAEgM,eAAe,CAAC;gBACjF,MAAMA,eAAe;cACvB;YACF,CAAC,MAAM;cACLxJ,IAAI,CAACwH,IAAI,CAAC,eAAe,EAAErD,MAAM,EAAEzH,IAAI,EAAEJ,IAAI,CAAC;YAChD;YACA,OAAO,IAAI;UACb,CAAC;;UAED;UACA;UACA;UACA;UACA;UACA0M,QAAQ,CAAC,IAAI,CAAC/D,YAAY,CAACC,MAAM,CAAC,GAAG,gBAAgBrC,GAAG,EAAE;YACxDzH,KAAK,CAACyH,GAAG,EAAEtC,MAAM,CAAC;YAElB,MAAMoD,eAAe,GAAG,MAAM3D,IAAI,CAAC2D,eAAe,CAACd,GAAG,CAAC;YACvD7C,IAAI,CAACxC,MAAM,sCAAAC,MAAA,CAAsCoF,GAAG,SAAApF,MAAA,CAAO9C,OAAO,CAACkG,QAAQ,CAAC8C,eAAe,CAACC,IAAI,CAAC,GAAGD,eAAe,CAACC,IAAI,CAACH,IAAI,GAAG,EAAE,CAAG,CAAC;YAEtI,IAAIzD,IAAI,CAACc,eAAe,IAAId,IAAI,CAACc,eAAe,CAAC+B,GAAG,CAAC,EAAE;cACrD7C,IAAI,CAACc,eAAe,CAAC+B,GAAG,CAAC,CAACO,IAAI,CAAC,CAAC;cAChCpD,IAAI,CAACc,eAAe,CAAC+B,GAAG,CAAC,CAACU,KAAK,CAAC,CAAC;YACnC;YAEA,IAAII,eAAe,EAAE;cACnB,MAAM3D,IAAI,CAAChC,cAAc,CAACkF,WAAW,CAAC;gBAACL;cAAG,CAAC,CAAC;cAC5C,MAAM7C,IAAI,CAACkD,WAAW,CAAC;gBAACL;cAAG,CAAC,CAAC;cAG7B,IAAIlI,OAAO,CAACkG,QAAQ,CAAC8C,eAAe,CAACC,IAAI,CAAC,IAAID,eAAe,CAACC,IAAI,CAACH,IAAI,EAAE;gBACvE,MAAMzD,IAAI,CAACyJ,MAAM,CAAC;kBAAC5G,GAAG;kBAAEY,IAAI,EAAEE,eAAe,CAACC,IAAI,CAACH;gBAAI,CAAC,CAAC;cAC3D;YACF;YACA,OAAO,IAAI;UACb,CAAC;UAEDxI,MAAM,CAACyO,OAAO,CAACV,QAAQ,CAAC;QAC1B;MACF;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;MACE,MAAM1B,cAAcA,CAAA,EAA+B;QAAA,IAA9B5K,IAAI,GAAAgF,SAAA,CAAAqD,MAAA,QAAArD,SAAA,QAAAiI,SAAA,GAAAjI,SAAA,MAAG,CAAC,CAAC;QAAA,IAAE2C,MAAM,GAAA3C,SAAA,CAAAqD,MAAA,OAAArD,SAAA,MAAAiI,SAAA;QAAA,IAAEC,SAAS,GAAAlI,SAAA,CAAAqD,MAAA,OAAArD,SAAA,MAAAiI,SAAA;QAC/C,IAAIE,GAAG;QACP,IAAI,CAAClP,OAAO,CAACsF,SAAS,CAACvD,IAAI,CAACuK,GAAG,CAAC,EAAE;UAChCvK,IAAI,CAACuK,GAAG,GAAG,KAAK;QAClB;QAEA,IAAI,CAACvK,IAAI,CAACwK,OAAO,EAAE;UACjBxK,IAAI,CAACwK,OAAO,GAAG,KAAK;QACtB;QAEA,IAAI,CAACvM,OAAO,CAACgG,QAAQ,CAACjE,IAAI,CAAC2K,OAAO,CAAC,EAAE;UACnC3K,IAAI,CAAC2K,OAAO,GAAG,CAAC,CAAC;QACnB;QAEA,IAAI,CAAC1M,OAAO,CAACyF,QAAQ,CAAC1D,IAAI,CAAC2M,MAAM,CAAC,EAAE;UAClC3M,IAAI,CAAC2M,MAAM,GAAG3M,IAAI,CAACsK,MAAM;QAC3B;QAEA,IAAI,CAACxJ,MAAM,gCAAAC,MAAA,CAAgCmM,SAAS,aAAAnM,MAAA,CAAUf,IAAI,CAAC2K,OAAO,OAAA5J,MAAA,CAAIf,IAAI,CAACgH,UAAU,oBAAAjG,MAAA,CAAiBf,IAAI,CAACkH,IAAI,CAACtG,IAAI,IAAIZ,IAAI,CAACkH,IAAI,CAACkG,QAAQ,CAAE,CAAC;QAErJ,MAAMA,QAAQ,GAAG,IAAI,CAACC,YAAY,CAACrN,IAAI,CAACkH,IAAI,CAAC;QAC7C,MAAM;UAACoG,SAAS;UAAEC;QAAgB,CAAC,GAAG,IAAI,CAACC,OAAO,CAACJ,QAAQ,CAAC;QAE5D,IAAI,CAACnP,OAAO,CAACkG,QAAQ,CAACnE,IAAI,CAACkH,IAAI,CAAC2D,IAAI,CAAC,EAAE;UACrC7K,IAAI,CAACkH,IAAI,CAAC2D,IAAI,GAAG,CAAC,CAAC;QACrB;QAEA,IAAIpD,MAAM,GAAGzH,IAAI,CAACkH,IAAI;QACtBO,MAAM,CAAC7G,IAAI,GAAGwM,QAAQ;QACtB3F,MAAM,CAACoD,IAAI,GAAG7K,IAAI,CAACkH,IAAI,CAAC2D,IAAI;QAC5BpD,MAAM,CAAC6F,SAAS,GAAGA,SAAS;QAC5B7F,MAAM,CAACgG,GAAG,GAAGH,SAAS;QACtB7F,MAAM,CAACtB,GAAG,GAAGnG,IAAI,CAACsK,MAAM;QACxB7C,MAAM,CAACE,MAAM,GAAGA,MAAM,IAAI,IAAI;QAC9B3H,IAAI,CAAC2M,MAAM,GAAG,IAAI,CAACxJ,QAAQ,CAACnD,IAAI,CAAC2M,MAAM,CAAC;QAExC,IAAI,IAAI,CAACnK,cAAc,EAAE;UACvBxC,IAAI,CAAC2M,MAAM,GAAG,IAAI,CAACnK,cAAc,CAACxC,IAAI,CAAC;QACzC;QAEAyH,MAAM,CAACV,IAAI,MAAAhG,MAAA,CAAM,IAAI,CAACM,WAAW,CAACoG,MAAM,CAAC,EAAA1G,MAAA,CAAG3B,QAAQ,CAACyF,GAAG,EAAA9D,MAAA,CAAGf,IAAI,CAAC2M,MAAM,EAAA5L,MAAA,CAAGwM,gBAAgB,CAAE;QAC3F9F,MAAM,GAAG/G,MAAM,CAACqH,MAAM,CAACN,MAAM,EAAE,IAAI,CAACiG,aAAa,CAACjG,MAAM,CAAC,CAAC;QAE1D,IAAI,IAAI,CAAC7E,cAAc,IAAI3E,OAAO,CAAC+F,UAAU,CAAC,IAAI,CAACpB,cAAc,CAAC,EAAE;UAClEuK,GAAG,GAAGzM,MAAM,CAACqH,MAAM,CAAC;YAClBb,IAAI,EAAElH,IAAI,CAACkH;UACb,CAAC,EAAE;YACDyD,OAAO,EAAE3K,IAAI,CAAC2K,OAAO;YACrBhD,MAAM,EAAEF,MAAM,CAACE,MAAM;YACrB,MAAMD,SAASA,CAAA,EAAG;cAChB,IAAInJ,MAAM,CAACkO,KAAK,IAAIhF,MAAM,CAACE,MAAM,EAAE;gBACjC,OAAOpJ,MAAM,CAACkO,KAAK,CAACnF,YAAY,CAACG,MAAM,CAACE,MAAM,CAAC;cACjD;cACA,OAAO,IAAI;YACb,CAAC;YACD4C,GAAG,EAAEvK,IAAI,CAACuK;UACZ,CAAC,CAAC;UACF,MAAMoD,eAAe,GAAG,MAAM,IAAI,CAAC/K,cAAc,CAACkF,IAAI,CAACqF,GAAG,EAAE1F,MAAM,CAAC;UAEnE,IAAIkG,eAAe,KAAK,IAAI,EAAE;YAC5B,MAAM,IAAIpP,MAAM,CAACuF,KAAK,CAAC,GAAG,EAAE7F,OAAO,CAACyF,QAAQ,CAACiK,eAAe,CAAC,GAAGA,eAAe,GAAG,kCAAkC,CAAC;UACvH,CAAC,MAAM;YACL,IAAK3N,IAAI,CAACiL,IAAI,KAAK,IAAI,IAAK,IAAI,CAACpI,gBAAgB,IAAI5E,OAAO,CAAC+F,UAAU,CAAC,IAAI,CAACnB,gBAAgB,CAAC,EAAE;cAC9F,MAAM,IAAI,CAACA,gBAAgB,CAACiF,IAAI,CAACqF,GAAG,EAAE1F,MAAM,CAAC;YAC/C;UACF;QACF,CAAC,MAAM,IAAKzH,IAAI,CAACiL,IAAI,KAAK,IAAI,IAAK,IAAI,CAACpI,gBAAgB,IAAI5E,OAAO,CAAC+F,UAAU,CAAC,IAAI,CAACnB,gBAAgB,CAAC,EAAE;UACrGsK,GAAG,GAAGzM,MAAM,CAACqH,MAAM,CAAC;YAClBb,IAAI,EAAElH,IAAI,CAACkH;UACb,CAAC,EAAE;YACDyD,OAAO,EAAE3K,IAAI,CAAC2K,OAAO;YACrBhD,MAAM,EAAEF,MAAM,CAACE,MAAM;YACrB,MAAMD,SAASA,CAAA,EAAG;cAChB,IAAInJ,MAAM,CAACkO,KAAK,IAAIhF,MAAM,CAACE,MAAM,EAAE;gBACjC,OAAOpJ,MAAM,CAACkO,KAAK,CAACnF,YAAY,CAACG,MAAM,CAACE,MAAM,CAAC;cACjD;cACA,OAAO,IAAI;YACb,CAAC;YACD4C,GAAG,EAAEvK,IAAI,CAACuK;UACZ,CAAC,CAAC;UACF,MAAM,IAAI,CAAC1H,gBAAgB,CAACiF,IAAI,CAACqF,GAAG,EAAE1F,MAAM,CAAC;QAC/C;QAEA,OAAO;UAACA,MAAM;UAAEzH;QAAI,CAAC;MACvB;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;MACE,MAAM8I,aAAaA,CAACrB,MAAM,EAAEzH,IAAI,EAAE4N,EAAE,EAAE;QACpC,IAAI,CAAC9M,MAAM,sDAAAC,MAAA,CAAsD0G,MAAM,CAACV,IAAI,CAAE,CAAC;QAC/E7H,EAAE,CAAC2O,KAAK,CAACpG,MAAM,CAACV,IAAI,EAAE,IAAI,CAAChE,WAAW,EAAEnD,IAAI,CAAC;QAC7C6H,MAAM,CAAC7C,IAAI,GAAG,IAAI,CAACkJ,YAAY,CAAC9N,IAAI,CAACkH,IAAI,CAAC;QAC1CO,MAAM,CAACxE,MAAM,GAAG,IAAI,CAACA,MAAM;QAC3B,IAAI,CAAC8K,gBAAgB,CAACtG,MAAM,CAAC;QAE7B,IAAItB,GAAG;QACP,IAAI;UACFA,GAAG,GAAG,MAAM,IAAI,CAAClG,UAAU,CAACqL,WAAW,CAACrN,OAAO,CAACiN,KAAK,CAACzD,MAAM,CAAC,CAAC;UAC9D,IAAI;YACF,MAAM,IAAI,CAACnG,cAAc,CAAC0M,WAAW,CAAC;cAAC7H,GAAG,EAAEnG,IAAI,CAACsK;YAAM,CAAC,EAAE;cAAC2D,IAAI,EAAE;gBAAC7H,UAAU,EAAE;cAAI;YAAC,CAAC,CAAC;YACrF,IAAID,GAAG,EAAEsB,MAAM,CAACtB,GAAG,GAAGA,GAAG;YACzB,IAAI,CAACrF,MAAM,qDAAAC,MAAA,CAAqD0G,MAAM,CAACV,IAAI,CAAE,CAAC;YAC9E,IAAI,IAAI,CAACrE,aAAa,IAAIzE,OAAO,CAAC+F,UAAU,CAAC,IAAI,CAACtB,aAAa,CAAC,EAAE;cAChE,MAAM,IAAI,CAACA,aAAa,CAACoF,IAAI,CAAC,IAAI,EAAEL,MAAM,CAAC;YAC7C;YACA,IAAI,CAACqD,IAAI,CAAC,aAAa,EAAErD,MAAM,CAAC;YAChCmG,EAAE,CAAC,IAAI,EAAEnG,MAAM,CAAC;UAClB,CAAC,CAAC,OAAOyG,cAAc,EAAE;YACvBN,EAAE,CAACM,cAAc,CAAC;YAClB,IAAI,CAACpN,MAAM,CAAC,4DAA4D,EAAEoN,cAAc,CAAC;UAC3F;QACF,CAAC,CAAC,OAAOC,SAAS,EAAC;UACjBP,EAAE,CAACO,SAAS,CAAC;UACb,IAAI,CAACrN,MAAM,CAAC,4DAA4D,EAAEqN,SAAS,CAAC;QACtF;MACF;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;MACEtF,aAAaA,CAACpB,MAAM,EAAEzH,IAAI,EAAE4N,EAAE,EAAE;QAC9B,IAAI;UACF,IAAI5N,IAAI,CAACuK,GAAG,EAAE;YACZ,IAAI,CAACnG,eAAe,CAACqD,MAAM,CAACtB,GAAG,CAAC,CAACQ,GAAG,CAAC,MAAM;cACzC,IAAI,CAACmE,IAAI,CAAC,eAAe,EAAErD,MAAM,EAAEzH,IAAI,EAAE4N,EAAE,CAAC;YAC9C,CAAC,CAAC;UACJ,CAAC,MAAM;YACL,IAAI,CAACxJ,eAAe,CAACqD,MAAM,CAACtB,GAAG,CAAC,CAACiI,KAAK,CAACpO,IAAI,CAAC2K,OAAO,EAAE3K,IAAI,CAACwK,OAAO,EAAEoD,EAAE,CAAC;UACxE;QACF,CAAC,CAAC,OAAOzN,CAAC,EAAE;UACV,IAAI,CAACW,MAAM,CAAC,8BAA8B,EAAEX,CAAC,CAAC;UAC9CyN,EAAE,IAAIA,EAAE,CAACzN,CAAC,CAAC;QACb;MACF;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;MACE2N,YAAYA,CAACO,QAAQ,EAAE;QACrB,IAAIC,IAAI;QACR5P,KAAK,CAAC2P,QAAQ,EAAE3N,MAAM,CAAC;QACvB,IAAIzC,OAAO,CAACkG,QAAQ,CAACkK,QAAQ,CAAC,IAAIA,QAAQ,CAACzJ,IAAI,EAAE;UAC/C0J,IAAI,GAAGD,QAAQ,CAACzJ,IAAI;QACtB;QAEA,IAAI,CAAC0J,IAAI,IAAI,CAACrQ,OAAO,CAACyF,QAAQ,CAAC4K,IAAI,CAAC,EAAE;UACpCA,IAAI,GAAG,0BAA0B;QACnC;QACA,OAAOA,IAAI;MACb;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;MACEC,UAAUA,CAACC,KAAK,EAAE;QAChB,IAAI,CAACA,KAAK,EAAE,OAAO,IAAI;;QAEvB;QACA,IAAI,CAACjQ,MAAM,CAACkQ,MAAM,CAACC,QAAQ,YAAYC,GAAG,IAAI,CAAC1Q,OAAO,CAACkG,QAAQ,CAAC5F,MAAM,CAACkQ,MAAM,CAACC,QAAQ,CAAC,EAAE;UACvF,MAAM,IAAI5K,KAAK,CAAC,sDAAsD,CAAC;QACzE;QAEA,IAAIvF,MAAM,CAACkQ,MAAM,CAACC,QAAQ,YAAYC,GAAG,IAAIpQ,MAAM,CAACkQ,MAAM,CAACC,QAAQ,CAACE,GAAG,CAACJ,KAAK,CAAC,IAAIvQ,OAAO,CAACkG,QAAQ,CAAC5F,MAAM,CAACkQ,MAAM,CAACC,QAAQ,CAACG,GAAG,CAACL,KAAK,CAAC,CAAC,EAAE;UACrI;UACA,OAAOjQ,MAAM,CAACkQ,MAAM,CAACC,QAAQ,CAACG,GAAG,CAACL,KAAK,CAAC,CAAC7G,MAAM;QACjD,CAAC,MAAM,IAAI1J,OAAO,CAACkG,QAAQ,CAAC5F,MAAM,CAACkQ,MAAM,CAACC,QAAQ,CAAC,IAAIF,KAAK,IAAIjQ,MAAM,CAACkQ,MAAM,CAACC,QAAQ,IAAIzQ,OAAO,CAACkG,QAAQ,CAAC5F,MAAM,CAACkQ,MAAM,CAACC,QAAQ,CAACF,KAAK,CAAC,CAAC,EAAE;UACzI;UACA,OAAOjQ,MAAM,CAACkQ,MAAM,CAACC,QAAQ,CAACF,KAAK,CAAC,CAAC7G,MAAM;QAC7C;QAEA,OAAO,IAAI;MACb;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;MACEC,QAAQA,CAAA,EAAG;QACT,OAAO,IAAI,CAACxF,OAAO,GACjB,IAAI,CAACA,OAAO,CAAC,GAAG4C,SAAS,CAAC,GAAG,IAAI,CAAC8J,eAAe,CAAC,GAAG9J,SAAS,CAAC;MACnE;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;MACE8J,eAAeA,CAACtH,IAAI,EAAE;QACpB,MAAMC,MAAM,GAAG;UACb,MAAMC,SAASA,CAAA,EAAG;YAAE,OAAO,IAAI;UAAE,CAAC;UAClC0C,IAAIA,CAAA,EAAG;YAAE,OAAO,IAAI;UAAE,CAAC;UACvBzC,MAAM,EAAE;QACV,CAAC;QAED,IAAIH,IAAI,EAAE;UACR,IAAIuH,IAAI,GAAG,IAAI;UACf,IAAIvH,IAAI,CAAC6C,OAAO,CAAC7F,OAAO,CAAC,QAAQ,CAAC,EAAE;YAClCuK,IAAI,GAAGvH,IAAI,CAAC6C,OAAO,CAAC7F,OAAO,CAAC,QAAQ,CAAC;UACvC,CAAC,MAAM;YACL,MAAMwK,MAAM,GAAGxH,IAAI,CAAC6C,OAAO,CAAC5L,OAAO;YACnC,IAAIuQ,MAAM,CAACJ,GAAG,CAAC,QAAQ,CAAC,EAAE;cACxBG,IAAI,GAAGC,MAAM,CAACH,GAAG,CAAC,QAAQ,CAAC;YAC7B;UACF;UAEA,IAAIE,IAAI,EAAE;YACR,MAAMpH,MAAM,GAAG,IAAI,CAAC4G,UAAU,CAACQ,IAAI,CAAC;YAEpC,IAAIpH,MAAM,EAAE;cACVF,MAAM,CAACC,SAAS,GAAG,MAAMnJ,MAAM,CAACkO,KAAK,CAACnF,YAAY,CAACK,MAAM,CAAC;cAC1DF,MAAM,CAACE,MAAM,GAAGA,MAAM;YACxB;UACF;QACF;QAEA,OAAOF,MAAM;MACf;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MACE,MAAM2G,KAAKA,CAACa,MAAM,EAAmC;QAAA,IAAjCpC,KAAK,GAAA7H,SAAA,CAAAqD,MAAA,QAAArD,SAAA,QAAAiI,SAAA,GAAAjI,SAAA,MAAG,CAAC,CAAC;QAAA,IAAEkK,mBAAmB,GAAAlK,SAAA,CAAAqD,MAAA,OAAArD,SAAA,MAAAiI,SAAA;QACjD,IAAI,CAACnM,MAAM,CAAC,kCAAkC,CAAC;QAC/C,IAAId,IAAI,GAAG6M,KAAK;QAChB,IAAIsC,kBAAkB,GAAGD,mBAAmB;QAE5C,IAAIjR,OAAO,CAACsF,SAAS,CAACvD,IAAI,CAAC,EAAE;UAC3BmP,kBAAkB,GAAGnP,IAAI;UACzBA,IAAI,GAAG,CAAC,CAAC;QACX;QAEAtB,KAAK,CAACsB,IAAI,EAAErB,KAAK,CAACiO,QAAQ,CAAClM,MAAM,CAAC,CAAC;QACnChC,KAAK,CAACyQ,kBAAkB,EAAExQ,KAAK,CAACiO,QAAQ,CAACtH,OAAO,CAAC,CAAC;QAElDtF,IAAI,CAACsK,MAAM,GAAGtK,IAAI,CAACsK,MAAM,IAAI,IAAI,CAACnH,QAAQ,CAACnD,IAAI,CAACsK,MAAM,EAAE,EAAE,EAAE,GAAG,CAAC;QAChE,MAAMA,MAAM,GAAGtK,IAAI,CAACsK,MAAM,IAAI9L,MAAM,CAAC4Q,EAAE,CAAC,CAAC;QACzC,MAAMC,MAAM,GAAG,IAAI,CAAC7M,cAAc,GAAG,IAAI,CAACA,cAAc,CAACxC,IAAI,CAAC,GAAGsK,MAAM;QACvE,MAAM8C,QAAQ,GAAIpN,IAAI,CAACY,IAAI,IAAIZ,IAAI,CAACoN,QAAQ,GAAKpN,IAAI,CAACY,IAAI,IAAIZ,IAAI,CAACoN,QAAQ,GAAIiC,MAAM;QAErF,MAAM;UAAC/B,SAAS;UAAEC;QAAgB,CAAC,GAAG,IAAI,CAACC,OAAO,CAACJ,QAAQ,CAAC;QAE5DpN,IAAI,CAAC+G,IAAI,MAAAhG,MAAA,CAAM,IAAI,CAACM,WAAW,CAACrB,IAAI,CAAC,EAAAe,MAAA,CAAG3B,QAAQ,CAACyF,GAAG,EAAA9D,MAAA,CAAGsO,MAAM,EAAAtO,MAAA,CAAGwM,gBAAgB,CAAE;QAClFvN,IAAI,CAAC4E,IAAI,GAAG,IAAI,CAACkJ,YAAY,CAAC9N,IAAI,CAAC;QACnC,IAAI,CAAC/B,OAAO,CAACkG,QAAQ,CAACnE,IAAI,CAAC6K,IAAI,CAAC,EAAE;UAChC7K,IAAI,CAAC6K,IAAI,GAAG,CAAC,CAAC;QAChB;QAEA,IAAI,CAAC5M,OAAO,CAACgG,QAAQ,CAACjE,IAAI,CAAC0E,IAAI,CAAC,EAAE;UAChC1E,IAAI,CAAC0E,IAAI,GAAGuK,MAAM,CAAC5G,MAAM;QAC3B;QAEA,MAAMZ,MAAM,GAAG,IAAI,CAACiG,aAAa,CAAC;UAChC9M,IAAI,EAAEwM,QAAQ;UACdrG,IAAI,EAAE/G,IAAI,CAAC+G,IAAI;UACf8D,IAAI,EAAE7K,IAAI,CAAC6K,IAAI;UACfjG,IAAI,EAAE5E,IAAI,CAAC4E,IAAI;UACfF,IAAI,EAAE1E,IAAI,CAAC0E,IAAI;UACfiD,MAAM,EAAE3H,IAAI,CAAC2H,MAAM;UACnB2F;QACF,CAAC,CAAC;QAEF7F,MAAM,CAACtB,GAAG,GAAGmE,MAAM;QAEnB,IAAIhG,OAAO;QAEX,IAAIgL,mBAAmB,GAAG,KAAK;QAC/B,IAAI;UACF,MAAMC,KAAK,GAAG,MAAMrQ,EAAE,CAACsQ,QAAQ,CAACC,IAAI,CAACzP,IAAI,CAAC+G,IAAI,CAAC;UAC/C,IAAI,CAACwI,KAAK,CAACG,MAAM,CAAC,CAAC,EAAE;YACnBJ,mBAAmB,GAAG,IAAI;UAC5B;QACF,CAAC,CAAC,OAAOK,SAAS,EAAE;UAClBL,mBAAmB,GAAG,IAAI;QAC5B;QACA,IAAIA,mBAAmB,EAAE;UACvB,MAAMM,KAAK,GAAG5P,IAAI,CAAC+G,IAAI,CAACkF,KAAK,CAAC,GAAG,CAAC;UAClC2D,KAAK,CAACC,GAAG,CAAC,CAAC;UACX,MAAM3Q,EAAE,CAACsQ,QAAQ,CAACM,KAAK,CAACF,KAAK,CAAC5O,IAAI,CAAC,GAAG,CAAC,EAAE;YAAEoE,SAAS,EAAE;UAAK,CAAC,CAAC;UAC7D,MAAMlG,EAAE,CAACsQ,QAAQ,CAACO,SAAS,CAAC/P,IAAI,CAAC+G,IAAI,EAAE,EAAE,CAAC;QAC5C;QAEA,MAAMiJ,MAAM,GAAG9Q,EAAE,CAAC+Q,iBAAiB,CAACjQ,IAAI,CAAC+G,IAAI,EAAE;UAACmJ,KAAK,EAAE,GAAG;UAAE/K,IAAI,EAAE,IAAI,CAACpC;QAAW,CAAC,CAAC;QAEpF,MAAM,IAAIoN,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;UACrCL,MAAM,CAACrJ,GAAG,CAACsI,MAAM,EAAGqB,SAAS,IAAK;YAChC,IAAIA,SAAS,EAAE;cACbD,MAAM,CAACC,SAAS,CAAC;YACnB,CAAC,MAAM;cACLF,OAAO,CAAC,CAAC;YACX;UACF,CAAC,CAAC;QACJ,CAAC,CAAC;QAEF,IAAI;UACF,MAAMjK,GAAG,GAAG,MAAM,IAAI,CAAClG,UAAU,CAACqL,WAAW,CAAC7D,MAAM,CAAC;UACrDnD,OAAO,GAAG,MAAM,IAAI,CAACrE,UAAU,CAACqH,YAAY,CAACnB,GAAG,CAAC;UAEjD,IAAIgJ,kBAAkB,KAAK,IAAI,EAAE;YAC/B,IAAI,IAAI,CAACzM,aAAa,EAAC;cACrB,MAAM,IAAI,CAACA,aAAa,CAACoF,IAAI,CAAC,IAAI,EAAExD,OAAO,CAAC;YAC9C;YACA,IAAI,CAACwG,IAAI,CAAC,kBAAkB,EAAExG,OAAO,CAAC;UACxC;UACA,IAAI,CAACxD,MAAM,+BAAAC,MAAA,CAA+BqM,QAAQ,UAAArM,MAAA,CAAO,IAAI,CAACc,cAAc,CAAE,CAAC;QACjF,CAAC,CAAC,OAAO0O,SAAS,EAAE;UAClB,IAAI,CAACzP,MAAM,8CAAAC,MAAA,CAA8CqM,QAAQ,UAAArM,MAAA,CAAO,IAAI,CAACc,cAAc,GAAI0O,SAAS,CAAC;UACzG,MAAM,IAAIhS,MAAM,CAACuF,KAAK,CAAC,YAAY,EAAEyM,SAAS,CAAC;QACjD;QAEA,OAAOjM,OAAO;MAChB;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MACE,MAAMkM,IAAIA,CAACC,GAAG,EAA2C;QAAA,IAAzC5D,KAAK,GAAA7H,SAAA,CAAAqD,MAAA,QAAArD,SAAA,QAAAiI,SAAA,GAAAjI,SAAA,MAAG,CAAC,CAAC;QAAA,IAAEkK,mBAAmB,GAAAlK,SAAA,CAAAqD,MAAA,QAAArD,SAAA,QAAAiI,SAAA,GAAAjI,SAAA,MAAG,KAAK;QACrD,IAAI,CAAClE,MAAM,iCAAAC,MAAA,CAAiC0P,GAAG,QAAA1P,MAAA,CAAKiJ,IAAI,CAACC,SAAS,CAAC4C,KAAK,CAAC,iBAAc,CAAC;QACxF,IAAI7M,IAAI,GAAG6M,KAAK;QAChB,IAAIsC,kBAAkB,GAAGD,mBAAmB;QAE5C,IAAIjR,OAAO,CAACsF,SAAS,CAACsJ,KAAK,CAAC,EAAE;UAC5BsC,kBAAkB,GAAGtC,KAAK;UAC1B7M,IAAI,GAAG,CAAC,CAAC;QACX;QAEAtB,KAAK,CAAC+R,GAAG,EAAE5M,MAAM,CAAC;QAClBnF,KAAK,CAACsB,IAAI,EAAErB,KAAK,CAACiO,QAAQ,CAAClM,MAAM,CAAC,CAAC;QACnChC,KAAK,CAACyQ,kBAAkB,EAAExQ,KAAK,CAACiO,QAAQ,CAACtH,OAAO,CAAC,CAAC;QAElD,IAAI,CAACrH,OAAO,CAACkG,QAAQ,CAACnE,IAAI,CAAC,EAAE;UAC3BA,IAAI,GAAG;YACL0Q,OAAO,EAAE;UACX,CAAC;QACH;QAEA,IAAI,CAAC1Q,IAAI,CAAC0Q,OAAO,EAAE;UACjB1Q,IAAI,CAAC0Q,OAAO,GAAG,MAAM;QACvB;QAEA,MAAMpG,MAAM,GAAItK,IAAI,CAACsK,MAAM,IAAI,IAAI,CAACnH,QAAQ,CAACnD,IAAI,CAACsK,MAAM,EAAE,EAAE,EAAE,GAAG,CAAC,IAAK9L,MAAM,CAAC4Q,EAAE,CAAC,CAAC;QAClF,MAAMC,MAAM,GAAG,IAAI,CAAC7M,cAAc,GAAG,IAAI,CAACA,cAAc,CAACxC,IAAI,CAAC,GAAGsK,MAAM;QACvE,MAAMqG,SAAS,GAAGF,GAAG,CAACxE,KAAK,CAAC,GAAG,CAAC;QAChC,MAAMmB,QAAQ,GAAIpN,IAAI,CAACY,IAAI,IAAIZ,IAAI,CAACoN,QAAQ,GAAKpN,IAAI,CAACY,IAAI,IAAIZ,IAAI,CAACoN,QAAQ,GAAIuD,SAAS,CAACA,SAAS,CAACtI,MAAM,GAAG,CAAC,CAAC,CAAC4D,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,IAAIoD,MAAM;QAEtI,MAAM;UAAC/B,SAAS;UAAEC;QAAgB,CAAC,GAAG,IAAI,CAACC,OAAO,CAACJ,QAAQ,CAAC;QAC5DpN,IAAI,CAAC+G,IAAI,MAAAhG,MAAA,CAAM,IAAI,CAACM,WAAW,CAACrB,IAAI,CAAC,EAAAe,MAAA,CAAG3B,QAAQ,CAACyF,GAAG,EAAA9D,MAAA,CAAGsO,MAAM,EAAAtO,MAAA,CAAGwM,gBAAgB,CAAE;;QAElF;QACA,IAAIjJ,OAAO;;QAEX;QACA;QACA,MAAMsM,WAAW,GAAG,MAAOnJ,MAAM,IAAK;UACpCA,MAAM,CAACtB,GAAG,GAAGmE,MAAM;UACnB,MAAMnE,GAAG,GAAI,MAAM,IAAI,CAAClG,UAAU,CAACqL,WAAW,CAAC7D,MAAM,CAAC;UAEtDnD,OAAO,GAAG,MAAM,IAAI,CAACrE,UAAU,CAACqH,YAAY,CAACnB,GAAG,CAAC;UACjD,IAAIgJ,kBAAkB,KAAK,IAAI,EAAE;YAC/B,IAAI,IAAI,CAACzM,aAAa,EAAC;cACrB,MAAM,IAAI,CAACA,aAAa,CAACoF,IAAI,CAAC,IAAI,EAAExD,OAAO,CAAC;YAC9C;YACA,IAAI,CAACwG,IAAI,CAAC,kBAAkB,EAAExG,OAAO,CAAC;UACxC;UACA,IAAI,CAACxD,MAAM,sCAAAC,MAAA,CAAsCqM,QAAQ,UAAArM,MAAA,CAAO,IAAI,CAACc,cAAc,CAAE,CAAC;QACxF,CAAC;;QAED;QACA,IAAIyN,mBAAmB,GAAG,KAAK;QAC/B,IAAI;UACF,MAAMC,KAAK,GAAG,MAAMrQ,EAAE,CAACsQ,QAAQ,CAACC,IAAI,CAACzP,IAAI,CAAC+G,IAAI,CAAC;UAC/C,IAAI,CAACwI,KAAK,CAACG,MAAM,CAAC,CAAC,EAAE;YACnBJ,mBAAmB,GAAG,IAAI;UAC5B;QACF,CAAC,CAAC,OAAOK,SAAS,EAAE;UAClBL,mBAAmB,GAAG,IAAI;QAC5B;QACA,IAAGA,mBAAmB,EAAE;UACtB,MAAMM,KAAK,GAAG5P,IAAI,CAAC+G,IAAI,CAACkF,KAAK,CAAC,GAAG,CAAC;UAClC2D,KAAK,CAACC,GAAG,CAAC,CAAC;UACX3Q,EAAE,CAACgG,SAAS,CAAC0K,KAAK,CAAC5O,IAAI,CAAC,GAAG,CAAC,EAAE;YAAEoE,SAAS,EAAE;UAAK,CAAC,CAAC;UAClDlG,EAAE,CAAC2R,aAAa,CAAC7Q,IAAI,CAAC+G,IAAI,EAAE,EAAE,CAAC;QACjC;QAEA,MAAM+J,OAAO,GAAG5R,EAAE,CAAC+Q,iBAAiB,CAACjQ,IAAI,CAAC+G,IAAI,EAAE;UAACmJ,KAAK,EAAE,GAAG;UAAE/K,IAAI,EAAE,IAAI,CAACpC,WAAW;UAAEgO,SAAS,EAAE,IAAI;UAAEC,SAAS,EAAE;QAAM,CAAC,CAAC;QACzH,MAAMC,UAAU,GAAG,IAAIhS,eAAe,CAAC,CAAC;QAExC,IAAI;UACF,IAAIiS,KAAK;UAET,IAAIlR,IAAI,CAAC0Q,OAAO,GAAG,CAAC,EAAE;YACpBQ,KAAK,GAAG3S,MAAM,CAACoN,UAAU,CAAC,MAAM;cAC9BsF,UAAU,CAACpK,KAAK,CAAC,CAAC;cAClB,MAAM,IAAItI,MAAM,CAACuF,KAAK,CAAC,GAAG,2BAAA/C,MAAA,CAA2Bf,IAAI,CAAC0Q,OAAO,OAAI,CAAC;YACxE,CAAC,EAAE1Q,IAAI,CAAC0Q,OAAO,CAAC;UAClB;UAEA,MAAMvF,GAAG,GAAG,MAAM9M,KAAK,CAACoS,GAAG,EAAE;YAC3BjM,OAAO,EAAExE,IAAI,CAACwE,OAAO,IAAI,CAAC,CAAC;YAC3B2M,MAAM,EAAEF,UAAU,CAACE;UACrB,CAAC,CAAC;UAEF,IAAID,KAAK,EAAE;YACT3S,MAAM,CAAC6S,YAAY,CAACF,KAAK,CAAC;YAC1BA,KAAK,GAAG,IAAI;UACd;UAEA,IAAI,CAAC/F,GAAG,CAACkG,EAAE,EAAE;YACX,MAAM,IAAIvN,KAAK,wBAAA/C,MAAA,CAAwBoK,GAAG,CAACmG,UAAU,CAAE,CAAC;UAC1D;UAEA,MAAMhS,QAAQ,CAAC6L,GAAG,CAACjB,IAAI,EAAE4G,OAAO,CAAC;UAEjC,MAAMrJ,MAAM,GAAG,IAAI,CAACiG,aAAa,CAAC;YAChC9M,IAAI,EAAEwM,QAAQ;YACdrG,IAAI,EAAE/G,IAAI,CAAC+G,IAAI;YACf8D,IAAI,EAAE7K,IAAI,CAAC6K,IAAI;YACfjG,IAAI,EAAE5E,IAAI,CAAC4E,IAAI,IAAIuG,GAAG,CAAC3G,OAAO,CAACqK,GAAG,CAAC,cAAc,CAAC,IAAI,IAAI,CAACf,YAAY,CAAC;cAAC/G,IAAI,EAAE/G,IAAI,CAAC+G;YAAI,CAAC,CAAC;YAC1FrC,IAAI,EAAE1E,IAAI,CAAC0E,IAAI,IAAIR,QAAQ,CAACiH,GAAG,CAAC3G,OAAO,CAACqK,GAAG,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;YACnElH,MAAM,EAAE3H,IAAI,CAAC2H,MAAM;YACnB2F;UACF,CAAC,CAAC;UAEF,IAAI,CAAC7F,MAAM,CAAC/C,IAAI,EAAE;YAChB,MAAM6M,QAAQ,GAAG,MAAMrS,EAAE,CAACsQ,QAAQ,CAACC,IAAI,CAACzP,IAAI,CAAC+G,IAAI,CAAC;YAClDU,MAAM,CAAC+J,QAAQ,CAACC,QAAQ,CAAC/M,IAAI,GAAI+C,MAAM,CAAC/C,IAAI,GAAG6M,QAAQ,CAAC7M,IAAK;YAC7D,MAAMkM,WAAW,CAACnJ,MAAM,CAAC;UAC3B,CAAC,MAAM;YACL,MAAMmJ,WAAW,CAACnJ,MAAM,CAAC;UAC3B;UACA0D,GAAG,CAACjB,IAAI,CAACwH,IAAI,CAACZ,OAAO,CAAC;QACxB,CAAC,CAAC,OAAMzL,KAAK,EAAC;UACZ,IAAI,CAACvE,MAAM,yCAAAC,MAAA,CAAyC0P,GAAG,gBAAapL,KAAK,CAAC;UAE1E,IAAInG,EAAE,CAACyS,UAAU,CAAC3R,IAAI,CAAC+G,IAAI,CAAC,EAAE;YAC5B,MAAM7H,EAAE,CAACsQ,QAAQ,CAACzC,MAAM,CAAC/M,IAAI,CAAC+G,IAAI,CAAC;UACrC;UAEA,MAAM1B,KAAK;QACb;QAGA,OAAOf,OAAO;MAChB;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MACE,MAAMsN,OAAOA,CAAC7K,IAAI,EAAmC;QAAA,IAAjC8F,KAAK,GAAA7H,SAAA,CAAAqD,MAAA,QAAArD,SAAA,QAAAiI,SAAA,GAAAjI,SAAA,MAAG,CAAC,CAAC;QAAA,IAAEkK,mBAAmB,GAAAlK,SAAA,CAAAqD,MAAA,OAAArD,SAAA,MAAAiI,SAAA;QACjD,IAAI,CAACnM,MAAM,+BAAAC,MAAA,CAA+BgG,IAAI,OAAI,CAAC;QACnD,IAAI/G,IAAI,GAAG6M,KAAK;QAChB,IAAIsC,kBAAkB,GAAGD,mBAAmB;QAE5C,IAAI,IAAI,CAACjM,MAAM,EAAE;UACf,MAAM,IAAI1E,MAAM,CAACuF,KAAK,CACpB,GAAG,EACH,kHACF,CAAC;QACH;QAEApF,KAAK,CAACqI,IAAI,EAAElD,MAAM,CAAC;QACnBnF,KAAK,CAACsB,IAAI,EAAErB,KAAK,CAACiO,QAAQ,CAAClM,MAAM,CAAC,CAAC;QACnChC,KAAK,CAACyQ,kBAAkB,EAAExQ,KAAK,CAACiO,QAAQ,CAACtH,OAAO,CAAC,CAAC;QAElD,IAAIiK,KAAK;QACT,IAAI;UACFA,KAAK,GAAG,MAAMrQ,EAAE,CAACsQ,QAAQ,CAACC,IAAI,CAAC1I,IAAI,CAAC;QACtC,CAAC,CAAC,OAAO8K,OAAO,EAAE;UAChB,IAAIA,OAAO,CAACzR,IAAI,KAAK,QAAQ,EAAE;YAC7B,MAAM,IAAI7B,MAAM,CAACuF,KAAK,CACpB,GAAG,gCAAA/C,MAAA,CAC2BgG,IAAI,4BACpC,CAAC;UACH;UACA,MAAM,IAAIxI,MAAM,CAACuF,KAAK,CAAC+N,OAAO,CAACzR,IAAI,EAAEyR,OAAO,CAACC,OAAO,CAAC;QACvD;QACA,IAAIvC,KAAK,CAACG,MAAM,CAAC,CAAC,EAAE;UAClB,IAAI,CAACzR,OAAO,CAACkG,QAAQ,CAACnE,IAAI,CAAC,EAAE;YAC3BA,IAAI,GAAG,CAAC,CAAC;UACX;UACAA,IAAI,CAAC+G,IAAI,GAAGA,IAAI;UAEhB,IAAI,CAAC/G,IAAI,CAACoN,QAAQ,EAAE;YAClB,MAAMuD,SAAS,GAAG5J,IAAI,CAACkF,KAAK,CAAC7M,QAAQ,CAACyF,GAAG,CAAC;YAC1C7E,IAAI,CAACoN,QAAQ,GAAGrG,IAAI,CAACkF,KAAK,CAAC7M,QAAQ,CAACyF,GAAG,CAAC,CAAC8L,SAAS,CAACtI,MAAM,GAAG,CAAC,CAAC;UAChE;UAEA,MAAM;YAAEiF;UAAU,CAAC,GAAG,IAAI,CAACE,OAAO,CAACxN,IAAI,CAACoN,QAAQ,CAAC;UAEjD,IAAI,CAACnP,OAAO,CAACyF,QAAQ,CAAC1D,IAAI,CAAC4E,IAAI,CAAC,EAAE;YAChC5E,IAAI,CAAC4E,IAAI,GAAG,IAAI,CAACkJ,YAAY,CAAC9N,IAAI,CAAC;UACrC;UAEA,IAAI,CAAC/B,OAAO,CAACkG,QAAQ,CAACnE,IAAI,CAAC6K,IAAI,CAAC,EAAE;YAChC7K,IAAI,CAAC6K,IAAI,GAAG,CAAC,CAAC;UAChB;UAEA,IAAI,CAAC5M,OAAO,CAACgG,QAAQ,CAACjE,IAAI,CAAC0E,IAAI,CAAC,EAAE;YAChC1E,IAAI,CAAC0E,IAAI,GAAG6K,KAAK,CAAC7K,IAAI;UACxB;UAEA,MAAM+C,MAAM,GAAG,IAAI,CAACiG,aAAa,CAAC;YAChC9M,IAAI,EAAEZ,IAAI,CAACoN,QAAQ;YACnBrG,IAAI;YACJ8D,IAAI,EAAE7K,IAAI,CAAC6K,IAAI;YACfjG,IAAI,EAAE5E,IAAI,CAAC4E,IAAI;YACfF,IAAI,EAAE1E,IAAI,CAAC0E,IAAI;YACfiD,MAAM,EAAE3H,IAAI,CAAC2H,MAAM;YACnB2F,SAAS;YACTyE,YAAY,EAAEhL,IAAI,CAAChD,OAAO,IAAAhD,MAAA,CAAI3B,QAAQ,CAACyF,GAAG,EAAA9D,MAAA,CAAGf,IAAI,CAACoN,QAAQ,GAAI,EAAE,CAAC;YACjE9C,MAAM,EAAGtK,IAAI,CAACsK,MAAM,IAAI,IAAI,CAACnH,QAAQ,CAACnD,IAAI,CAACsK,MAAM,EAAE,EAAE,EAAE,GAAG,CAAC,IAAK;UAClE,CAAC,CAAC;UAEF,IAAInE,GAAG;UACP,IAAI;YACFA,GAAG,GAAG,MAAM,IAAI,CAAClG,UAAU,CAACqL,WAAW,CAAC7D,MAAM,CAAC;UACjD,CAAC,CAAC,OAAO8I,SAAS,EAAE;YAClB,IAAI,CAACzP,MAAM,0DAAAC,MAAA,CACgD0G,MAAM,CAAC7G,IAAI,UAAAG,MAAA,CAAO,IAAI,CAACc,cAAc,GAC9F0O,SACF,CAAC;YACD,MAAM,IAAIhS,MAAM,CAACuF,KAAK,CAACyM,SAAS,CAACnQ,IAAI,EAAEmQ,SAAS,CAACuB,OAAO,CAAC;UAC3D;UAEA,MAAMxN,OAAO,GAAG,MAAM,IAAI,CAACrE,UAAU,CAACqH,YAAY,CAACnB,GAAG,CAAC;UAEvD,IAAIgJ,kBAAkB,KAAK,IAAI,EAAE;YAC/B,IAAI,CAACzM,aAAa,IAAI,IAAI,CAACA,aAAa,CAACoF,IAAI,CAAC,IAAI,EAAExD,OAAO,CAAC;YAC5D,IAAI,CAACwG,IAAI,CAAC,aAAa,EAAExG,OAAO,CAAC;UACnC;UACA,IAAI,CAACxD,MAAM,sCAAAC,MAAA,CAC4B0G,MAAM,CAAC7G,IAAI,UAAAG,MAAA,CAAO,IAAI,CAACc,cAAc,CAC5E,CAAC;UACD,OAAOyC,OAAO;QAChB;QACA,MAAM,IAAI/F,MAAM,CAACuF,KAAK,CACpB,GAAG,gCAAA/C,MAAA,CAC2BgG,IAAI,4BACpC,CAAC;MACH;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MACE,MAAMP,WAAWA,CAAC+F,QAAQ,EAAE;QAC1B,IAAI,CAACzL,MAAM,mCAAAC,MAAA,CAAmCiJ,IAAI,CAACC,SAAS,CAACsC,QAAQ,CAAC,OAAI,CAAC;QAC3E,IAAIA,QAAQ,KAAK,KAAK,CAAC,EAAE;UACvB,OAAO,CAAC;QACV;QAEA,MAAMyF,KAAK,GAAG,IAAI,CAAC/R,UAAU,CAACgG,IAAI,CAACsG,QAAQ,CAAC;QAC5C,IAAI,OAAMyF,KAAK,CAACpL,UAAU,CAAC,CAAC,IAAG,CAAC,EAAE;UAChC,MAAMoL,KAAK,CAACC,YAAY,CAAE/K,IAAI,IAAK;YACjC,IAAI,CAAC6F,MAAM,CAAC7F,IAAI,CAAC;UACnB,CAAC,CAAC;QACJ,CAAC,MAAM;UACL,MAAM,IAAI3I,MAAM,CAACuF,KAAK,CAAC,GAAG,EAAE,sCAAsC,CAAC;QACrE;QAEA,IAAI,IAAI,CAACrB,aAAa,EAAE;UACtB,MAAMyP,IAAI,GAAG,MAAMF,KAAK,CAACG,UAAU,CAAC,CAAC;UACrC,MAAM,IAAI,CAAClS,UAAU,CAACuG,WAAW,CAAC+F,QAAQ,CAAC;UAC3C,MAAM,IAAI,CAAC9J,aAAa,CAACyP,IAAI,CAAC;QAChC,CAAC,MAAM;UACL,MAAM,IAAI,CAACjS,UAAU,CAACuG,WAAW,CAAC+F,QAAQ,CAAC;QAC7C;QACA,OAAO,IAAI;MACb;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MACE6F,IAAIA,CAACC,KAAK,EAAE;QACV,IAAI,CAACpS,UAAU,CAACmS,IAAI,CAACC,KAAK,CAAC;QAC3B,OAAO,IAAI,CAACpS,UAAU;MACxB;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MACEqS,KAAKA,CAACD,KAAK,EAAE;QACX,IAAI,CAACpS,UAAU,CAACqS,KAAK,CAACD,KAAK,CAAC;QAC5B,OAAO,IAAI,CAACpS,UAAU;MACxB;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;MACEsS,UAAUA,CAAA,EAAG;QACX,IAAI,CAACtS,UAAU,CAACmS,IAAI,CAAC;UACnBI,MAAMA,CAAA,EAAG;YAAE,OAAO,IAAI;UAAE,CAAC;UACzBC,MAAMA,CAAA,EAAG;YAAE,OAAO,IAAI;UAAE,CAAC;UACzBC,MAAMA,CAAA,EAAG;YAAE,OAAO,IAAI;UAAE;QAC1B,CAAC,CAAC;QACF,OAAO,IAAI,CAACzS,UAAU;MACxB;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;MACE0S,WAAWA,CAAA,EAAG;QACZ,IAAI,CAAC1S,UAAU,CAACqS,KAAK,CAAC;UACpBE,MAAMA,CAAA,EAAG;YAAE,OAAO,IAAI;UAAE,CAAC;UACzBC,MAAMA,CAAA,EAAG;YAAE,OAAO,IAAI;UAAE,CAAC;UACzBC,MAAMA,CAAA,EAAG;YAAE,OAAO,IAAI;UAAE;QAC1B,CAAC,CAAC;QACF,OAAO,IAAI,CAACzS,UAAU;MACxB;;MAGA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MACE8M,MAAMA,CAACzI,OAAO,EAAE6H,OAAO,EAAExM,QAAQ,EAAE;QACjC,IAAI,CAACmB,MAAM,8BAAAC,MAAA,CAA8BuD,OAAO,CAAC6B,GAAG,QAAApF,MAAA,CAAKoL,OAAO,OAAI,CAAC;QACrE,IAAIA,OAAO,EAAE;UACX,IAAIlO,OAAO,CAACkG,QAAQ,CAACG,OAAO,CAACkN,QAAQ,CAAC,IAAIvT,OAAO,CAACkG,QAAQ,CAACG,OAAO,CAACkN,QAAQ,CAACrF,OAAO,CAAC,CAAC,IAAI7H,OAAO,CAACkN,QAAQ,CAACrF,OAAO,CAAC,CAACpF,IAAI,EAAE;YACvH7H,EAAE,CAAC6N,MAAM,CAACzI,OAAO,CAACkN,QAAQ,CAACrF,OAAO,CAAC,CAACpF,IAAI,EAAGpH,QAAQ,IAAIC,IAAK,CAAC;UAC/D;QACF,CAAC,MAAM;UACL,IAAI3B,OAAO,CAACkG,QAAQ,CAACG,OAAO,CAACkN,QAAQ,CAAC,EAAE;YACtC,KAAI,IAAIoB,IAAI,IAAItO,OAAO,CAACkN,QAAQ,EAAE;cAChC,IAAIlN,OAAO,CAACkN,QAAQ,CAACoB,IAAI,CAAC,IAAItO,OAAO,CAACkN,QAAQ,CAACoB,IAAI,CAAC,CAAC7L,IAAI,EAAE;gBACzD7H,EAAE,CAAC6N,MAAM,CAACzI,OAAO,CAACkN,QAAQ,CAACoB,IAAI,CAAC,CAAC7L,IAAI,EAAGpH,QAAQ,IAAIC,IAAK,CAAC;cAC5D;YACF;UACF,CAAC,MAAM;YACLV,EAAE,CAAC6N,MAAM,CAACzI,OAAO,CAACyC,IAAI,EAAGpH,QAAQ,IAAIC,IAAK,CAAC;UAC7C;QACF;QACA,OAAO,IAAI;MACb;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;MACEiT,IAAIA,CAACrL,IAAI,EAAE;QACT,IAAI,CAAC1G,MAAM,gCAAAC,MAAA,CAAgCyG,IAAI,CAAC6C,OAAO,CAACyI,WAAW,6BAA0B,CAAC;QAC9F,MAAM7K,IAAI,GAAG,mBAAmB;QAEhC,IAAI,CAACT,IAAI,CAACU,QAAQ,CAACC,WAAW,EAAE;UAC9BX,IAAI,CAACU,QAAQ,CAACE,SAAS,CAAC,GAAG,EAAE;YAC3B,cAAc,EAAE,YAAY;YAC5B,gBAAgB,EAAEH,IAAI,CAACI;UACzB,CAAC,CAAC;QACJ;QAEA,IAAI,CAACb,IAAI,CAACU,QAAQ,CAACI,QAAQ,EAAE;UAC3Bd,IAAI,CAACU,QAAQ,CAACvB,GAAG,CAACsB,IAAI,CAAC;QACzB;MACF;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MACE,MAAMmE,QAAQA,CAAC5E,IAAI,EAAiC;QAAA,IAA/B2E,OAAO,GAAAnH,SAAA,CAAAqD,MAAA,QAAArD,SAAA,QAAAiI,SAAA,GAAAjI,SAAA,MAAG,UAAU;QAAA,IAAEV,OAAO,GAAAU,SAAA,CAAAqD,MAAA,OAAArD,SAAA,MAAAiI,SAAA;QAChD,IAAI8F,IAAI;QACR,IAAI,CAACjS,MAAM,gCAAAC,MAAA,CACsByG,IAAI,CAAC6C,OAAO,CAACyI,WAAW,QAAA/R,MAAA,CAAKoL,OAAO,OACrE,CAAC;QAED,IAAI7H,OAAO,EAAE;UACX,IACErG,OAAO,CAAC2Q,GAAG,CAACtK,OAAO,EAAE,UAAU,CAAC,IAChCrG,OAAO,CAAC2Q,GAAG,CAACtK,OAAO,CAACkN,QAAQ,EAAErF,OAAO,CAAC,EACtC;YACA4G,IAAI,GAAGzO,OAAO,CAACkN,QAAQ,CAACrF,OAAO,CAAC;YAChC4G,IAAI,CAAC5M,GAAG,GAAG7B,OAAO,CAAC6B,GAAG;UACxB,CAAC,MAAM;YACL4M,IAAI,GAAGzO,OAAO;UAChB;QACF,CAAC,MAAM;UACLyO,IAAI,GAAG,KAAK;QACd;QAEA,IAAI,CAACA,IAAI,IAAI,CAAC9U,OAAO,CAACkG,QAAQ,CAAC4O,IAAI,CAAC,EAAE;UACpC,OAAO,IAAI,CAACF,IAAI,CAACrL,IAAI,CAAC;QACxB,CAAC,MAAM,IAAIlD,OAAO,EAAE;UAClB,IACErG,OAAO,CAAC+F,UAAU,CAAC,IAAI,CAAC9B,gBAAgB,CAAC,IACzC,EAAE,MAAM,IAAI,CAACA,gBAAgB,CAC3BxB,MAAM,CAACqH,MAAM,CAACP,IAAI,EAAE,IAAI,CAACI,QAAQ,CAACJ,IAAI,CAAC,CAAC,EACxClD,OACF,CAAC,CAAC,EACF;YACA,OAAO,IAAI,CAACuO,IAAI,CAACrL,IAAI,CAAC;UACxB;UAEA,IACE,IAAI,CAAClF,iBAAiB,IACtBrE,OAAO,CAAC+F,UAAU,CAAC,IAAI,CAAC1B,iBAAiB,CAAC,IAC1C,CAAC,MAAM,IAAI,CAACA,iBAAiB,CAACkF,IAAI,EAAElD,OAAO,EAAE6H,OAAO,CAAC,MAAM,IAAI,EAC/D;YACA,OAAO,KAAK,CAAC;UACf;UAEA,IAAIoD,KAAK;UAET,IAAI;YACFA,KAAK,GAAG,MAAMrQ,EAAE,CAACsQ,QAAQ,CAACC,IAAI,CAACsD,IAAI,CAAChM,IAAI,CAAC;UAC3C,CAAC,CAAC,OAAO8K,OAAO,EAAC;YACf,IAAIA,OAAO,EAAE;cACX,OAAO,IAAI,CAACgB,IAAI,CAACrL,IAAI,CAAC;YACxB;UACF;UACA,IAAI,CAAC+H,KAAK,CAACG,MAAM,CAAC,CAAC,EAAE;YACnB,OAAO,IAAI,CAACmD,IAAI,CAACrL,IAAI,CAAC;UACxB;UACA,IAAIwL,YAAY;UAEhB,IAAIzD,KAAK,CAAC7K,IAAI,KAAKqO,IAAI,CAACrO,IAAI,IAAI,CAAC,IAAI,CAACrC,cAAc,EAAE;YACpD0Q,IAAI,CAACrO,IAAI,GAAG6K,KAAK,CAAC7K,IAAI;UACxB;UAEA,IAAI6K,KAAK,CAAC7K,IAAI,KAAKqO,IAAI,CAACrO,IAAI,IAAI,IAAI,CAACrC,cAAc,EAAE;YACnD2Q,YAAY,GAAG,KAAK;UACtB;UAEA,IAAI,CAACC,KAAK,CACRzL,IAAI,EACJlD,OAAO,EACPyO,IAAI,EACJ5G,OAAO,EACP,IAAI,EACJ6G,YAAY,IAAI,KAClB,CAAC;UAED,OAAO,KAAK,CAAC;QACf;QACA,OAAO,IAAI,CAACH,IAAI,CAACrL,IAAI,CAAC;MACxB;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MACEyL,KAAKA,CAACzL,IAAI,EAAElD,OAAO,EAAEyO,IAAI,EAAwF;QAAA,IAAAG,YAAA,EAAAC,kBAAA,EAAAC,aAAA,EAAAC,mBAAA;QAAA,IAAtFlH,OAAO,GAAAnH,SAAA,CAAAqD,MAAA,QAAArD,SAAA,QAAAiI,SAAA,GAAAjI,SAAA,MAAG,UAAU;QAAA,IAAEsO,cAAc,GAAAtO,SAAA,CAAAqD,MAAA,QAAArD,SAAA,QAAAiI,SAAA,GAAAjI,SAAA,MAAG,IAAI;QAAA,IAAEuO,aAAa,GAAAvO,SAAA,CAAAqD,MAAA,QAAArD,SAAA,QAAAiI,SAAA,GAAAjI,SAAA,MAAG,KAAK;QAAA,IAAEwO,QAAQ,GAAAxO,SAAA,CAAAqD,MAAA,QAAArD,SAAA,QAAAiI,SAAA,GAAAjI,SAAA,MAAG,KAAK;QAC7G,IAAIyO,QAAQ,GAAG,KAAK;QACpB,IAAIC,QAAQ,GAAG,KAAK;QACpB,IAAIC,eAAe,GAAG,EAAE;QACxB,IAAIC,KAAK;QACT,IAAIjN,GAAG;QACP,IAAIkN,IAAI;QACR,IAAIb,YAAY,GAAGO,aAAa;QAEhC,IAAI,CAAAL,YAAA,GAAA1L,IAAI,CAACK,MAAM,cAAAqL,YAAA,gBAAAC,kBAAA,GAAXD,YAAA,CAAahH,KAAK,cAAAiH,kBAAA,eAAlBA,kBAAA,CAAoB/G,QAAQ,IAAK5E,IAAI,CAACK,MAAM,CAACqE,KAAK,CAACE,QAAQ,KAAK,MAAO,EAAE;UAC3EuH,eAAe,GAAG,cAAc;QAClC,CAAC,MAAM;UACLA,eAAe,GAAG,UAAU;QAC9B;QAEA,MAAMG,eAAe,iBAAA/S,MAAA,CAAiBgT,SAAS,CAAChB,IAAI,CAACnS,IAAI,IAAI0D,OAAO,CAAC1D,IAAI,CAAC,CAACmD,OAAO,CAAC,KAAK,EAAE,KAAK,CAAC,2BAAAhD,MAAA,CAAwBiT,kBAAkB,CAACjB,IAAI,CAACnS,IAAI,IAAI0D,OAAO,CAAC1D,IAAI,CAAC,OAAI;QACzK,MAAMqT,mBAAmB,GAAG,eAAe;QAE3C,IAAI,CAACzM,IAAI,CAACU,QAAQ,CAACC,WAAW,EAAE;UAC9BX,IAAI,CAACU,QAAQ,CAACyB,SAAS,CAAC,qBAAqB,EAAEgK,eAAe,GAAGG,eAAe,GAAGG,mBAAmB,CAAC;QACzG;QAEA,IAAIzM,IAAI,CAAC6C,OAAO,CAAC7F,OAAO,CAAC0P,KAAK,IAAI,CAACV,QAAQ,EAAE;UAC3CC,QAAQ,GAAG,IAAI;UACf,MAAMU,KAAK,GAAG3M,IAAI,CAAC6C,OAAO,CAAC7F,OAAO,CAAC0P,KAAK,CAACjI,KAAK,CAAC,yBAAyB,CAAC;UACzE2H,KAAK,GAAG1P,QAAQ,CAACiQ,KAAK,CAAC,CAAC,CAAC,CAAC;UAC1BxN,GAAG,GAAGzC,QAAQ,CAACiQ,KAAK,CAAC,CAAC,CAAC,CAAC;UACxB,IAAIC,KAAK,CAACzN,GAAG,CAAC,EAAE;YACdA,GAAG,GAAGoM,IAAI,CAACrO,IAAI,GAAG,CAAC;UACrB;UACAmP,IAAI,GAAGlN,GAAG,GAAGiN,KAAK;QACpB,CAAC,MAAM;UACLA,KAAK,GAAG,CAAC;UACTjN,GAAG,GAAGoM,IAAI,CAACrO,IAAI,GAAG,CAAC;UACnBmP,IAAI,GAAGd,IAAI,CAACrO,IAAI;QAClB;QAEA,IAAI+O,QAAQ,IAAK,CAAAL,aAAA,GAAA5L,IAAI,CAACK,MAAM,cAAAuL,aAAA,gBAAAC,mBAAA,GAAXD,aAAA,CAAalH,KAAK,cAAAmH,mBAAA,eAAlBA,mBAAA,CAAoBgB,IAAI,IAAK7M,IAAI,CAACK,MAAM,CAACqE,KAAK,CAACmI,IAAI,KAAK,MAAQ,EAAE;UACjFX,QAAQ,GAAG;YAACE,KAAK;YAAEjN;UAAG,CAAC;UACvB,IAAIyN,KAAK,CAACR,KAAK,CAAC,IAAI,CAACQ,KAAK,CAACzN,GAAG,CAAC,EAAE;YAC/B+M,QAAQ,CAACE,KAAK,GAAGjN,GAAG,GAAGkN,IAAI;YAC3BH,QAAQ,CAAC/M,GAAG,GAAGA,GAAG;UACpB;UACA,IAAI,CAACyN,KAAK,CAACR,KAAK,CAAC,IAAIQ,KAAK,CAACzN,GAAG,CAAC,EAAE;YAC/B+M,QAAQ,CAACE,KAAK,GAAGA,KAAK;YACtBF,QAAQ,CAAC/M,GAAG,GAAGiN,KAAK,GAAGC,IAAI;UAC7B;UAEA,IAAKD,KAAK,GAAGC,IAAI,IAAKd,IAAI,CAACrO,IAAI,EAAE;YAC/BgP,QAAQ,CAAC/M,GAAG,GAAGoM,IAAI,CAACrO,IAAI,GAAG,CAAC;UAC9B;UAEA,IAAI,IAAI,CAACrB,MAAM,KAAMqQ,QAAQ,CAACE,KAAK,IAAKb,IAAI,CAACrO,IAAI,GAAG,CAAE,IAAMgP,QAAQ,CAAC/M,GAAG,GAAIoM,IAAI,CAACrO,IAAI,GAAG,CAAG,CAAC,EAAE;YAC5FsO,YAAY,GAAG,KAAK;UACtB,CAAC,MAAM;YACLA,YAAY,GAAG,KAAK;UACtB;QACF,CAAC,MAAM;UACLA,YAAY,GAAG,KAAK;QACtB;QAEA,MAAMsB,kBAAkB,GAAIjP,KAAK,IAAK;UACpC,IAAI,CAACvE,MAAM,6BAAAC,MAAA,CAA6BgS,IAAI,CAAChM,IAAI,QAAAhG,MAAA,CAAKoL,OAAO,eAAY9G,KAAK,CAAC;UAC/E,IAAI,CAACmC,IAAI,CAACU,QAAQ,CAACI,QAAQ,EAAE;YAC3Bd,IAAI,CAACU,QAAQ,CAACvB,GAAG,CAACtB,KAAK,CAAC0E,QAAQ,CAAC,CAAC,CAAC;UACrC;QACF,CAAC;QAED,MAAMvF,OAAO,GAAGvG,OAAO,CAAC+F,UAAU,CAAC,IAAI,CAACd,eAAe,CAAC,GAAG,IAAI,CAACA,eAAe,CAAC8P,YAAY,EAAE1O,OAAO,EAAEyO,IAAI,EAAE5G,OAAO,EAAE3E,IAAI,CAAC,GAAG,IAAI,CAACtE,eAAe;QAElJ,IAAI,CAACsB,OAAO,CAAC,eAAe,CAAC,EAAE;UAC7B,IAAI,CAACgD,IAAI,CAACU,QAAQ,CAACC,WAAW,EAAE;YAC9BX,IAAI,CAACU,QAAQ,CAACyB,SAAS,CAAC,eAAe,EAAE,IAAI,CAAChI,YAAY,CAAC;UAC7D;QACF;QAEA,KAAK,IAAIhB,GAAG,IAAI6D,OAAO,EAAE;UACvB,IAAI,CAACgD,IAAI,CAACU,QAAQ,CAACC,WAAW,EAAE;YAC9BX,IAAI,CAACU,QAAQ,CAACyB,SAAS,CAAChJ,GAAG,EAAE6D,OAAO,CAAC7D,GAAG,CAAC,CAAC;UAC5C;QACF;QAEA,MAAM4T,OAAO,GAAGA,CAACvE,MAAM,EAAE5P,IAAI,KAAK;UAChC4P,MAAM,CAACwE,QAAQ,GAAG,KAAK;UACvB,MAAMC,aAAa,GAAIC,UAAU,IAAK;YACpC,IAAI,CAACA,UAAU,EAAE;cACf1E,MAAM,CAACwE,QAAQ,GAAG,IAAI;YACxB,CAAC,MAAM;cACL,IAAI,CAAC1T,MAAM,6BAAAC,MAAA,CAA6BgS,IAAI,CAAChM,IAAI,QAAAhG,MAAA,CAAKoL,OAAO,2MAAwMuI,UAAU,CAAC;YAClR;UACF,CAAC;UAED,MAAMC,WAAW,GAAGA,CAAA,KAAM;YACxB,IAAI,CAAC3E,MAAM,CAACwE,QAAQ,IAAI,CAACxE,MAAM,CAAC4E,SAAS,EAAE;cACzC,IAAI;gBACF,IAAI,OAAO5E,MAAM,CAAC6E,KAAK,KAAK,UAAU,EAAE;kBACtC7E,MAAM,CAAC6E,KAAK,CAACJ,aAAa,CAAC;gBAC7B,CAAC,MAAM,IAAI,OAAOzE,MAAM,CAACrJ,GAAG,KAAK,UAAU,EAAE;kBAC3CqJ,MAAM,CAACrJ,GAAG,CAAC8N,aAAa,CAAC;gBAC3B,CAAC,MAAM,IAAI,OAAOzE,MAAM,CAAC8E,OAAO,KAAK,UAAU,EAAE;kBAC/C9E,MAAM,CAAC8E,OAAO,CAAC,0BAA0B,EAAEL,aAAa,CAAC;gBAC3D;cACF,CAAC,CAAC,OAAOM,gBAAgB,EAAE;gBACzB;gBACA;cAAA;YAEJ;UACF,CAAC;UAED,IAAI,CAACvN,IAAI,CAACU,QAAQ,CAACC,WAAW,IAAImL,cAAc,EAAE;YAChD9L,IAAI,CAACU,QAAQ,CAACE,SAAS,CAAChI,IAAI,CAAC;UAC/B;UAEAoH,IAAI,CAAC6C,OAAO,CAACzB,EAAE,CAAC,SAAS,EAAE,MAAM;YAC/BpB,IAAI,CAAC6C,OAAO,CAAClD,OAAO,GAAG,IAAI;UAC7B,CAAC,CAAC;UAEF6I,MAAM,CAACpH,EAAE,CAAC,MAAM,EAAE,MAAM;YACtB,IAAI,CAACpB,IAAI,CAACU,QAAQ,CAACC,WAAW,EAAE;cAC9BX,IAAI,CAACU,QAAQ,CAACE,SAAS,CAAChI,IAAI,CAAC;YAC/B;UACF,CAAC,CAAC,CAACwI,EAAE,CAAC,OAAO,EAAE,MAAM;YACnB+L,WAAW,CAAC,CAAC;YACb,IAAI,CAACnN,IAAI,CAACU,QAAQ,CAACI,QAAQ,EAAE;cAC3Bd,IAAI,CAACU,QAAQ,CAACvB,GAAG,CAAC,CAAC;YACrB;YACA,IAAI,CAACa,IAAI,CAAC6C,OAAO,CAAClD,OAAO,EAAE;cACzBK,IAAI,CAAC6C,OAAO,CAACyK,OAAO,CAAC,CAAC;YACxB;UACF,CAAC,CAAC,CAAClM,EAAE,CAAC,OAAO,EAAGoM,GAAG,IAAK;YACtBL,WAAW,CAAC,CAAC;YACbL,kBAAkB,CAACU,GAAG,CAAC;UACzB,CAAC,CAAC,CAACpM,EAAE,CAAC,KAAK,EAAE,MAAM;YACjB,IAAI,CAACpB,IAAI,CAACU,QAAQ,CAACI,QAAQ,EAAE;cAC3Bd,IAAI,CAACU,QAAQ,CAACvB,GAAG,CAAC,CAAC;YACrB;UACF,CAAC,CAAC,CAAC+K,IAAI,CAAClK,IAAI,CAACU,QAAQ,CAAC;QACxB,CAAC;QAED,QAAQ8K,YAAY;UACpB,KAAK,KAAK;YACR,IAAI,CAAClS,MAAM,6BAAAC,MAAA,CAA6BgS,IAAI,CAAChM,IAAI,QAAAhG,MAAA,CAAKoL,OAAO,sCAAmC,CAAC;YACjG,IAAIlE,IAAI,GAAG,0BAA0B;YAErC,IAAI,CAACT,IAAI,CAACU,QAAQ,CAACC,WAAW,EAAE;cAC9BX,IAAI,CAACU,QAAQ,CAACE,SAAS,CAAC,GAAG,EAAE;gBAC3B,cAAc,EAAE,YAAY;gBAC5B,gBAAgB,EAAEH,IAAI,CAACI;cACzB,CAAC,CAAC;YACJ;YAEA,IAAI,CAACb,IAAI,CAACU,QAAQ,CAACI,QAAQ,EAAE;cAC3Bd,IAAI,CAACU,QAAQ,CAACvB,GAAG,CAACsB,IAAI,CAAC;YACzB;YACA;UACF,KAAK,KAAK;YACR,IAAI,CAAC4K,IAAI,CAACrL,IAAI,CAAC;YACf;UACF,KAAK,KAAK;YACR,IAAI,CAAC1G,MAAM,6BAAAC,MAAA,CAA6BgS,IAAI,CAAChM,IAAI,QAAAhG,MAAA,CAAKoL,OAAO,6CAA0C,CAAC;YACxG,IAAI,CAAC3E,IAAI,CAACU,QAAQ,CAACC,WAAW,EAAE;cAC9BX,IAAI,CAACU,QAAQ,CAACE,SAAS,CAAC,GAAG,CAAC;YAC9B;YACA,IAAI,CAACZ,IAAI,CAACU,QAAQ,CAACI,QAAQ,EAAE;cAC3Bd,IAAI,CAACU,QAAQ,CAACvB,GAAG,CAAC,CAAC;YACrB;YACA;UACF,KAAK,KAAK;YACR,IAAI,CAAC7F,MAAM,6BAAAC,MAAA,CAA6BgS,IAAI,CAAChM,IAAI,QAAAhG,MAAA,CAAKoL,OAAO,aAAU,CAAC;YACxE,IAAI,CAAC3E,IAAI,CAACU,QAAQ,CAACC,WAAW,EAAE;cAC9BX,IAAI,CAACU,QAAQ,CAACyB,SAAS,CAAC,eAAe,WAAA5I,MAAA,CAAW2S,QAAQ,CAACE,KAAK,OAAA7S,MAAA,CAAI2S,QAAQ,CAAC/M,GAAG,OAAA5F,MAAA,CAAIgS,IAAI,CAACrO,IAAI,CAAE,CAAC;YAClG;YACA6P,OAAO,CAACjB,cAAc,IAAIpU,EAAE,CAAC+V,gBAAgB,CAAClC,IAAI,CAAChM,IAAI,EAAE;cAAC6M,KAAK,EAAEF,QAAQ,CAACE,KAAK;cAAEjN,GAAG,EAAE+M,QAAQ,CAAC/M;YAAG,CAAC,CAAC,EAAE,GAAG,CAAC;YAC1G;UACF;YACE,IAAI,CAACa,IAAI,CAACU,QAAQ,CAACC,WAAW,EAAE;cAC9BX,IAAI,CAACU,QAAQ,CAACyB,SAAS,CAAC,gBAAgB,KAAA5I,MAAA,CAAKgS,IAAI,CAACrO,IAAI,CAAE,CAAC;YAC3D;YACA,IAAI,CAAC5D,MAAM,6BAAAC,MAAA,CAA6BgS,IAAI,CAAChM,IAAI,QAAAhG,MAAA,CAAKoL,OAAO,aAAU,CAAC;YACxEoI,OAAO,CAACjB,cAAc,IAAIpU,EAAE,CAAC+V,gBAAgB,CAAClC,IAAI,CAAChM,IAAI,CAAC,EAAE,GAAG,CAAC;YAC9D;QACF;MACF;IACF;IAACmO,sBAAA;EAAA,SAAAC,WAAA;IAAA,OAAAD,sBAAA,CAAAC,WAAA;EAAA;EAAAD,sBAAA;AAAA;EAAA5R,IAAA;EAAA8R,KAAA;AAAA,G;;;;;;;;;;;;;;IC79DDtX,MAAM,CAACC,MAAM,CAAC;MAACc,OAAO,EAACA,CAAA,KAAIC;IAAmB,CAAC,CAAC;IAAC,IAAIuW,YAAY;IAACvX,MAAM,CAACK,IAAI,CAAC,eAAe,EAAC;MAACkX,YAAYA,CAACjX,CAAC,EAAC;QAACiX,YAAY,GAACjX,CAAC;MAAA;IAAC,CAAC,EAAC,CAAC,CAAC;IAAC,IAAIM,KAAK,EAACC,KAAK;IAACb,MAAM,CAACK,IAAI,CAAC,cAAc,EAAC;MAACO,KAAKA,CAACN,CAAC,EAAC;QAACM,KAAK,GAACN,CAAC;MAAA,CAAC;MAACO,KAAKA,CAACP,CAAC,EAAC;QAACO,KAAK,GAACP,CAAC;MAAA;IAAC,CAAC,EAAC,CAAC,CAAC;IAAC,IAAIkX,YAAY,EAACrX,OAAO;IAACH,MAAM,CAACK,IAAI,CAAC,UAAU,EAAC;MAACmX,YAAYA,CAAClX,CAAC,EAAC;QAACkX,YAAY,GAAClX,CAAC;MAAA,CAAC;MAACH,OAAOA,CAACG,CAAC,EAAC;QAACH,OAAO,GAACG,CAAC;MAAA;IAAC,CAAC,EAAC,CAAC,CAAC;IAAC,IAAImX,WAAW,EAACC,UAAU;IAAC1X,MAAM,CAACK,IAAI,CAAC,aAAa,EAAC;MAACoX,WAAWA,CAACnX,CAAC,EAAC;QAACmX,WAAW,GAACnX,CAAC;MAAA,CAAC;MAACoX,UAAUA,CAACpX,CAAC,EAAC;QAACoX,UAAU,GAACpX,CAAC;MAAA;IAAC,CAAC,EAAC,CAAC,CAAC;IAAC,IAAIoB,oBAAoB,CAAC,CAAC,EAAE,CAAC,MAAMA,oBAAoB,CAAC,CAAC,EAAE,CAAC;IAKne,MAAMV,mBAAmB,SAASuW,YAAY,CAAC;MAC5DlU,WAAWA,CAAA,EAAG;QACZ,KAAK,CAAC,CAAC;MACT;MA0FA;AACF;AACA;AACA;AACA;AACA;AACA;MACEL,MAAMA,CAAA,EAAG;QACP,IAAI,IAAI,CAACiB,KAAK,EAAE;UACd;UACA,CAAC0T,OAAO,CAACC,IAAI,IAAID,OAAO,CAACE,GAAG,IAAI,YAAY,CAAC,CAAC,EAAE5Q,KAAK,CAAC,KAAK,CAAC,EAAEC,SAAS,CAAC;QAC1E;MACF;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;MACEqI,YAAYA,CAACgB,QAAQ,EAAE;QACrB,MAAMjB,QAAQ,GAAGiB,QAAQ,CAACzN,IAAI,IAAIyN,QAAQ,CAACjB,QAAQ;QACnD,IAAInP,OAAO,CAACyF,QAAQ,CAAC0J,QAAQ,CAAC,IAAKA,QAAQ,CAAC/E,MAAM,GAAG,CAAE,EAAE;UACvD,OAAO,CAACgG,QAAQ,CAACzN,IAAI,IAAIyN,QAAQ,CAACjB,QAAQ,EAAErJ,OAAO,CAAC,QAAQ,EAAE,EAAE,CAAC,CAACA,OAAO,CAAC,SAAS,EAAE,GAAG,CAAC,CAACA,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC;QAC9G;QACA,OAAO,EAAE;MACX;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;MACEyJ,OAAOA,CAACJ,QAAQ,EAAE;QAChB,IAAIA,QAAQ,CAAC5D,QAAQ,CAAC,GAAG,CAAC,EAAE;UAC1B,MAAM8D,SAAS,GAAG,CAACF,QAAQ,CAACnB,KAAK,CAAC,GAAG,CAAC,CAAC4D,GAAG,CAAC,CAAC,CAAC5D,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,EAAE2J,WAAW,CAAC,CAAC,CAAC7R,OAAO,CAAC,sBAAsB,EAAE,EAAE,CAAC,CAACgI,SAAS,CAAC,CAAC,EAAE,EAAE,CAAC;UACpI,OAAO;YAAE0B,GAAG,EAAEH,SAAS;YAAEA,SAAS;YAAEC,gBAAgB,MAAAxM,MAAA,CAAMuM,SAAS;UAAG,CAAC;QACzE;QACA,OAAO;UAAEG,GAAG,EAAE,EAAE;UAAEH,SAAS,EAAE,EAAE;UAAEC,gBAAgB,EAAE;QAAG,CAAC;MACzD;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;MACEQ,gBAAgBA,CAACnC,IAAI,EAAE;QACrBA,IAAI,CAACiK,OAAO,GAAG,WAAW,CAACpM,IAAI,CAACmC,IAAI,CAAChH,IAAI,CAAC;QAC1CgH,IAAI,CAACkK,OAAO,GAAG,WAAW,CAACrM,IAAI,CAACmC,IAAI,CAAChH,IAAI,CAAC;QAC1CgH,IAAI,CAACmK,OAAO,GAAG,WAAW,CAACtM,IAAI,CAACmC,IAAI,CAAChH,IAAI,CAAC;QAC1CgH,IAAI,CAACoK,MAAM,GAAG,UAAU,CAACvM,IAAI,CAACmC,IAAI,CAAChH,IAAI,CAAC;QACxCgH,IAAI,CAACqK,MAAM,GAAG,sBAAsB,CAACxM,IAAI,CAACmC,IAAI,CAAChH,IAAI,CAAC;QACpDgH,IAAI,CAACsK,KAAK,GAAG,0BAA0B,CAACzM,IAAI,CAACmC,IAAI,CAAChH,IAAI,CAAC;MACzD;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;MACE8I,aAAaA,CAAC9B,IAAI,EAAE;QAClB,MAAMuK,EAAE,GAAG;UACTvV,IAAI,EAAEgL,IAAI,CAAChL,IAAI;UACf0M,SAAS,EAAE1B,IAAI,CAAC0B,SAAS;UACzBG,GAAG,EAAE7B,IAAI,CAAC0B,SAAS;UACnBC,gBAAgB,MAAAxM,MAAA,CAAM6K,IAAI,CAAC0B,SAAS,CAAE;UACtCvG,IAAI,EAAE6E,IAAI,CAAC7E,IAAI;UACf8D,IAAI,EAAEe,IAAI,CAACf,IAAI;UACfjG,IAAI,EAAEgH,IAAI,CAAChH,IAAI;UACf0J,IAAI,EAAE1C,IAAI,CAAChH,IAAI;UACf,WAAW,EAAEgH,IAAI,CAAChH,IAAI;UACtBF,IAAI,EAAEkH,IAAI,CAAClH,IAAI;UACfiD,MAAM,EAAEiE,IAAI,CAACjE,MAAM,IAAI,IAAI;UAC3B6J,QAAQ,EAAE;YACRC,QAAQ,EAAE;cACR1K,IAAI,EAAE6E,IAAI,CAAC7E,IAAI;cACfrC,IAAI,EAAEkH,IAAI,CAAClH,IAAI;cACfE,IAAI,EAAEgH,IAAI,CAAChH,IAAI;cACf0I,SAAS,EAAE1B,IAAI,CAAC0B;YAClB;UACF,CAAC;UACD8I,cAAc,EAAExK,IAAI,CAACwK,cAAc,IAAI,IAAI,CAACjU,aAAa;UACzDkU,eAAe,EAAEzK,IAAI,CAACyK,eAAe,IAAI,IAAI,CAACxU;QAChD,CAAC;;QAED;QACA,IAAI+J,IAAI,CAACtB,MAAM,EAAE;UACf6L,EAAE,CAAChQ,GAAG,GAAGyF,IAAI,CAACtB,MAAM;QACtB;QAEA,IAAI,CAACyD,gBAAgB,CAACoI,EAAE,CAAC;QACzBA,EAAE,CAACpE,YAAY,GAAGnG,IAAI,CAACmG,YAAY,IAAI,IAAI,CAAC1Q,WAAW,CAACX,MAAM,CAACqH,MAAM,CAAC,CAAC,CAAC,EAAE6D,IAAI,EAAEuK,EAAE,CAAC,CAAC;QACpF,OAAOA,EAAE;MACX;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MACE,MAAM7O,YAAYA,CAAA,EAAyB;QAAA,IAAxBiF,QAAQ,GAAAvH,SAAA,CAAAqD,MAAA,QAAArD,SAAA,QAAAiI,SAAA,GAAAjI,SAAA,MAAG,CAAC,CAAC;QAAA,IAAEsR,OAAO,GAAAtR,SAAA,CAAAqD,MAAA,OAAArD,SAAA,MAAAiI,SAAA;QACvC,IAAI,CAACnM,MAAM,oCAAAC,MAAA,CAAoCiJ,IAAI,CAACC,SAAS,CAACsC,QAAQ,CAAC,QAAAxL,MAAA,CAAKiJ,IAAI,CAACC,SAAS,CAACqM,OAAO,CAAC,OAAI,CAAC;QACxG5X,KAAK,CAAC6N,QAAQ,EAAE5N,KAAK,CAACiO,QAAQ,CAACjO,KAAK,CAAC8G,KAAK,CAAC/E,MAAM,EAAEmD,MAAM,EAAEyB,OAAO,EAAEC,MAAM,EAAE,IAAI,CAAC,CAAC,CAAC;QACnF7G,KAAK,CAAC4X,OAAO,EAAE3X,KAAK,CAACiO,QAAQ,CAAClM,MAAM,CAAC,CAAC;QAEtC,MAAM6F,GAAG,GAAG,MAAM,IAAI,CAACtG,UAAU,CAACqH,YAAY,CAACiF,QAAQ,EAAE+J,OAAO,CAAC;QACjE,IAAI/P,GAAG,EAAE;UACP,OAAO,IAAIiP,UAAU,CAACjP,GAAG,EAAE,IAAI,CAAC;QAClC;QACA,OAAOA,GAAG;MACZ;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MACEN,IAAIA,CAAA,EAAyB;QAAA,IAAxBsG,QAAQ,GAAAvH,SAAA,CAAAqD,MAAA,QAAArD,SAAA,QAAAiI,SAAA,GAAAjI,SAAA,MAAG,CAAC,CAAC;QAAA,IAAEsR,OAAO,GAAAtR,SAAA,CAAAqD,MAAA,OAAArD,SAAA,MAAAiI,SAAA;QACzB,IAAI,CAACnM,MAAM,4BAAAC,MAAA,CAA4BiJ,IAAI,CAACC,SAAS,CAACsC,QAAQ,CAAC,QAAAxL,MAAA,CAAKiJ,IAAI,CAACC,SAAS,CAACqM,OAAO,CAAC,OAAI,CAAC;QAChG5X,KAAK,CAAC6N,QAAQ,EAAE5N,KAAK,CAACiO,QAAQ,CAACjO,KAAK,CAAC8G,KAAK,CAAC/E,MAAM,EAAEmD,MAAM,EAAEyB,OAAO,EAAEC,MAAM,EAAE,IAAI,CAAC,CAAC,CAAC;QACnF7G,KAAK,CAAC4X,OAAO,EAAE3X,KAAK,CAACiO,QAAQ,CAAClM,MAAM,CAAC,CAAC;QAEtC,OAAO,IAAI6U,WAAW,CAAChJ,QAAQ,EAAE+J,OAAO,EAAE,IAAI,CAAC;MACjD;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;MACE,MAAMtI,WAAWA,CAAA,EAAG;QAClB,MAAM,IAAI,CAAC/N,UAAU,CAAC+N,WAAW,CAACjJ,KAAK,CAAC,IAAI,CAAC9E,UAAU,EAAE+E,SAAS,CAAC;QACnE,OAAO,IAAI,CAAC/E,UAAU;MACxB;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MACE9B,IAAIA,CAACmG,OAAO,EAAiC;QAAA,IAA/B6H,OAAO,GAAAnH,SAAA,CAAAqD,MAAA,QAAArD,SAAA,QAAAiI,SAAA,GAAAjI,SAAA,MAAG,UAAU;QAAA,IAAEuR,OAAO,GAAAvR,SAAA,CAAAqD,MAAA,OAAArD,SAAA,MAAAiI,SAAA;QACzC,IAAI,CAACnM,MAAM,4BAAAC,MAAA,CAA6B9C,OAAO,CAACkG,QAAQ,CAACG,OAAO,CAAC,GAAGA,OAAO,CAAC6B,GAAG,GAAG,KAAK,CAAC,QAAApF,MAAA,CAAMoL,OAAO,OAAI,CAAC;QAC1GzN,KAAK,CAAC4F,OAAO,EAAE5D,MAAM,CAAC;QAEtB,IAAI,CAAC4D,OAAO,EAAE;UACZ,OAAO,EAAE;QACX;QACA,OAAOgR,YAAY,CAAChR,OAAO,EAAE6H,OAAO,EAAEoK,OAAO,CAAC;MAChD;IACF;IA5QqBzX,mBAAmB,CAK/B0X,SAAS,GAAGvY,OAAO;IALPa,mBAAmB,CAO/BsE,MAAM,GAAG;MACd+C,GAAG,EAAE;QACHvB,IAAI,EAAEf;MACR,CAAC;MACDa,IAAI,EAAE;QACJE,IAAI,EAAEW;MACR,CAAC;MACD3E,IAAI,EAAE;QACJgE,IAAI,EAAEf;MACR,CAAC;MACDe,IAAI,EAAE;QACJA,IAAI,EAAEf;MACR,CAAC;MACDkD,IAAI,EAAE;QACJnC,IAAI,EAAEf;MACR,CAAC;MACDgS,OAAO,EAAE;QACPjR,IAAI,EAAEU;MACR,CAAC;MACDwQ,OAAO,EAAE;QACPlR,IAAI,EAAEU;MACR,CAAC;MACDyQ,OAAO,EAAE;QACPnR,IAAI,EAAEU;MACR,CAAC;MACD0Q,MAAM,EAAE;QACNpR,IAAI,EAAEU;MACR,CAAC;MACD2Q,MAAM,EAAE;QACNrR,IAAI,EAAEU;MACR,CAAC;MACD4Q,KAAK,EAAE;QACLtR,IAAI,EAAEU;MACR,CAAC;MACDgI,SAAS,EAAE;QACT1I,IAAI,EAAEf,MAAM;QACZ4S,QAAQ,EAAE;MACZ,CAAC;MACDhJ,GAAG,EAAE;QACH7I,IAAI,EAAEf,MAAM;QACZ4S,QAAQ,EAAE;MACZ,CAAC;MACDlJ,gBAAgB,EAAE;QAChB3I,IAAI,EAAEf,MAAM;QACZ4S,QAAQ,EAAE;MACZ,CAAC;MACDnI,IAAI,EAAE;QACJ1J,IAAI,EAAEf,MAAM;QACZ4S,QAAQ,EAAE;MACZ,CAAC;MACD,WAAW,EAAE;QACX7R,IAAI,EAAEf,MAAM;QACZ4S,QAAQ,EAAE;MACZ,CAAC;MACD1E,YAAY,EAAE;QACZnN,IAAI,EAAEf;MACR,CAAC;MACDuS,cAAc,EAAE;QACdxR,IAAI,EAAEf;MACR,CAAC;MACDwS,eAAe,EAAE;QACfzR,IAAI,EAAEf;MACR,CAAC;MACDZ,MAAM,EAAE;QACN2B,IAAI,EAAEU,OAAO;QACbmR,QAAQ,EAAE;MACZ,CAAC;MACD5L,IAAI,EAAE;QACJjG,IAAI,EAAElE,MAAM;QACZgW,QAAQ,EAAE,IAAI;QACdD,QAAQ,EAAE;MACZ,CAAC;MACD9O,MAAM,EAAE;QACN/C,IAAI,EAAEf,MAAM;QACZ4S,QAAQ,EAAE;MACZ,CAAC;MACDE,SAAS,EAAE;QACT/R,IAAI,EAAEwG,IAAI;QACVqL,QAAQ,EAAE;MACZ,CAAC;MACDjF,QAAQ,EAAE;QACR5M,IAAI,EAAElE,MAAM;QACZgW,QAAQ,EAAE;MACZ;IACF,CAAC;IAAAxB,sBAAA;EAAA,SAAAC,WAAA;IAAA,OAAAD,sBAAA,CAAAC,WAAA;EAAA;EAAAD,sBAAA;AAAA;EAAA5R,IAAA;EAAA8R,KAAA;AAAA,G;;;;;;;;;;;;;;IChGHtX,MAAM,CAACC,MAAM,CAAC;MAACyX,UAAU,EAACA,CAAA,KAAIA,UAAU;MAACD,WAAW,EAACA,CAAA,KAAIA;IAAW,CAAC,CAAC;IAAC,IAAIhX,MAAM;IAACT,MAAM,CAACK,IAAI,CAAC,eAAe,EAAC;MAACI,MAAMA,CAACH,CAAC,EAAC;QAACG,MAAM,GAACH,CAAC;MAAA;IAAC,CAAC,EAAC,CAAC,CAAC;IAAC,IAAIoB,oBAAoB,CAAC,CAAC,EAAE,CAAC,MAAMA,oBAAoB,CAAC,CAAC,EAAE,CAAC;IAU5L,MAAMgW,UAAU,CAAC;MACtBrU,WAAWA,CAACyV,QAAQ,EAAE9W,WAAW,EAAE;QACjC,IAAI,CAAC8W,QAAQ,GAAGA,QAAQ;QACxB,IAAI,CAAC9W,WAAW,GAAGA,WAAW;QAC9BY,MAAM,CAACqH,MAAM,CAAC,IAAI,EAAE6O,QAAQ,CAAC;MAC/B;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;MACE,MAAMpQ,WAAWA,CAAA,EAAG;QAClB,IAAI,CAAC1G,WAAW,CAACgB,MAAM,CAAC,gDAAgD,CAAC;QACzE,IAAI,IAAI,CAAC8V,QAAQ,EAAE;UACjB,MAAM,IAAI,CAAC9W,WAAW,CAAC0G,WAAW,CAAC,IAAI,CAACoQ,QAAQ,CAACzQ,GAAG,CAAC;QACvD,CAAC,MAAM;UACL,MAAM,IAAI5H,MAAM,CAACuF,KAAK,CAAC,GAAG,EAAE,cAAc,CAAC;QAC7C;QACA,OAAO,IAAI;MACb;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MACE3F,IAAIA,CAAA,EAAgC;QAAA,IAA/BgO,OAAO,GAAAnH,SAAA,CAAAqD,MAAA,QAAArD,SAAA,QAAAiI,SAAA,GAAAjI,SAAA,MAAG,UAAU;QAAA,IAAEuR,OAAO,GAAAvR,SAAA,CAAAqD,MAAA,OAAArD,SAAA,MAAAiI,SAAA;QAChC,IAAI,CAACnN,WAAW,CAACgB,MAAM,yCAAAC,MAAA,CAAyCoL,OAAO,OAAI,CAAC;QAC5E,IAAI,IAAI,CAACyK,QAAQ,EAAE;UACjB,OAAO,IAAI,CAAC9W,WAAW,CAAC3B,IAAI,CAAC,IAAI,CAACyY,QAAQ,EAAEzK,OAAO,EAAEoK,OAAO,CAAC;QAC/D;QACA,OAAO,EAAE;MACX;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;MACE1H,GAAGA,CAACgI,QAAQ,EAAE;QACZ,IAAI,CAAC/W,WAAW,CAACgB,MAAM,wCAAAC,MAAA,CAAwC8V,QAAQ,OAAI,CAAC;QAC5E,IAAIA,QAAQ,EAAE;UACZ,OAAO,IAAI,CAACD,QAAQ,CAACC,QAAQ,CAAC;QAChC;QACA,OAAO,IAAI,CAACD,QAAQ;MACtB;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;MACEvY,KAAKA,CAAA,EAAG;QACN,IAAI,CAACyB,WAAW,CAACgB,MAAM,CAAC,0CAA0C,CAAC;QACnE,OAAO,CAAC,IAAI,CAAC8V,QAAQ,CAAC;MACxB;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;MACEE,IAAIA,CAAA,EAAG;QACL,IAAI,CAAChX,WAAW,CAACgB,MAAM,CAAC,yCAAyC,CAAC;QAClE,OAAOJ,MAAM,CAACqH,MAAM,CAAC,IAAI,EAAE,IAAI,CAACjI,WAAW,CAACG,UAAU,CAAC8W,OAAO,CAAC,IAAI,CAACH,QAAQ,CAACzQ,GAAG,CAAC,CAAC;MACpF;IACF;IAWO,MAAMoP,WAAW,CAAC;MACvBpU,WAAWA,CAAA,EAAuC;QAAA,IAAtC6V,SAAS,GAAAhS,SAAA,CAAAqD,MAAA,QAAArD,SAAA,QAAAiI,SAAA,GAAAjI,SAAA,MAAG,CAAC,CAAC;QAAA,IAAEsR,OAAO,GAAAtR,SAAA,CAAAqD,MAAA,OAAArD,SAAA,MAAAiI,SAAA;QAAA,IAAEnN,WAAW,GAAAkF,SAAA,CAAAqD,MAAA,OAAArD,SAAA,MAAAiI,SAAA;QAC9C,IAAI,CAACnN,WAAW,GAAGA,WAAW;QAC9B,IAAI,CAACkX,SAAS,GAAGA,SAAS;QAC1B,IAAI,CAACC,QAAQ,GAAG,CAAC,CAAC;QAClB,IAAI,CAACvK,MAAM,GAAG,IAAI,CAAC5M,WAAW,CAACG,UAAU,CAACgG,IAAI,CAAC,IAAI,CAAC+Q,SAAS,EAAEV,OAAO,CAAC;MACzE;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;MACE,MAAMzH,GAAGA,CAAA,EAAG;QACV,IAAI,CAAC/O,WAAW,CAACgB,MAAM,CAAC,8CAA8C,CAAC;QACvE,OAAO,IAAI,CAAC4L,MAAM,CAACyF,UAAU,CAAC,CAAC;MACjC;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;MACE,MAAM+E,OAAOA,CAAA,EAAG;QACd,IAAI,CAACpX,WAAW,CAACgB,MAAM,CAAC,kDAAkD,CAAC;QAC3E,OAAO,IAAI,CAACmW,QAAQ,GAAG,CAAC,MAAM,IAAI,CAACvK,MAAM,CAAC9F,UAAU,CAAC,CAAC,IAAI,CAAC;MAC7D;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;MACE,MAAM0C,IAAIA,CAAA,EAAG;QACX,IAAI,CAACxJ,WAAW,CAACgB,MAAM,CAAC,+CAA+C,CAAC;QACxE,OAAO,CAAC,MAAM,IAAI,CAAC4L,MAAM,CAACyF,UAAU,CAAC,CAAC,EAAE,EAAE,IAAI,CAAC8E,QAAQ,CAAC;MAC1D;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;MACEE,WAAWA,CAAA,EAAG;QACZ,IAAI,CAACrX,WAAW,CAACgB,MAAM,CAAC,iDAAiD,CAAC;QAC1E,OAAO,IAAI,CAACmW,QAAQ,KAAK,CAAC,CAAC;MAC7B;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;MACE,MAAMG,QAAQA,CAAA,EAAG;QACf,IAAI,CAACtX,WAAW,CAACgB,MAAM,CAAC,mDAAmD,CAAC;QAC5E,OAAQ,IAAI,CAAC4L,MAAM,CAACyF,UAAU,CAAC,CAAC,CAAE,EAAE,IAAI,CAAC8E,QAAQ,CAAC;MACpD;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;MACE,MAAM9E,UAAUA,CAAA,EAAG;QACjB,IAAI,CAACrS,WAAW,CAACgB,MAAM,CAAC,gDAAgD,CAAC;QACzE,OAAO,CAAC,MAAM,IAAI,CAAC4L,MAAM,CAACyF,UAAU,CAAC,CAAC,KAAK,EAAE;MAC/C;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;MACE,MAAMkF,KAAKA,CAAA,EAAG;QACZ,IAAI,CAACvX,WAAW,CAACgB,MAAM,CAAC,gDAAgD,CAAC;QACzE,IAAI,CAACmW,QAAQ,GAAG,CAAC;QACjB,OAAO,CAAC,MAAM,IAAI,CAAC9E,UAAU,CAAC,CAAC,EAAE,IAAI,CAAC8E,QAAQ,CAAC;MACjD;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;MACE,MAAMK,IAAIA,CAAA,EAAG;QACX,IAAI,CAACxX,WAAW,CAACgB,MAAM,CAAC,0CAA0C,CAAC;QACnE,IAAI,CAACmW,QAAQ,GAAG,CAAC,MAAM,IAAI,CAACrQ,UAAU,CAAC,CAAC,IAAI,CAAC;QAC7C,OAAO,CAAC,MAAM,IAAI,CAACuL,UAAU,CAAC,CAAC,EAAE,IAAI,CAAC8E,QAAQ,CAAC;MACjD;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;MACE,MAAMrQ,UAAUA,CAAA,EAAG;QACjB,IAAI,CAAC9G,WAAW,CAACgB,MAAM,CAAC,gDAAgD,CAAC;QACzE,OAAO,IAAI,CAAC4L,MAAM,CAAC9F,UAAU,CAAC,CAAC;MACjC;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;MACE,MAAMJ,WAAWA,CAAA,EAAG;QAClB,IAAI,CAAC1G,WAAW,CAACgB,MAAM,CAAC,iDAAiD,CAAC;QAC1E,MAAM,IAAI,CAAChB,WAAW,CAAC0G,WAAW,CAAC,IAAI,CAACwQ,SAAS,CAAC;QAClD,OAAO,IAAI;MACb;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MACE,MAAM/E,YAAYA,CAACtS,QAAQ,EAAgB;QAAA,IAAd4X,OAAO,GAAAvS,SAAA,CAAAqD,MAAA,QAAArD,SAAA,QAAAiI,SAAA,GAAAjI,SAAA,MAAG,CAAC,CAAC;QACvC,IAAI,CAAClF,WAAW,CAACgB,MAAM,CAAC,kDAAkD,CAAC;QAC3E,MAAM,IAAI,CAAC4L,MAAM,CAACuF,YAAY,CAACtS,QAAQ,EAAE4X,OAAO,CAAC;MACnD;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;MACE,MAAMC,IAAIA,CAAA,EAAG;QACX,OAAO,IAAI,CAACC,QAAQ,CAAEvQ,IAAI,IAAK;UAC7B,OAAO,IAAIsO,UAAU,CAACtO,IAAI,EAAE,IAAI,CAACpH,WAAW,CAAC;QAC/C,CAAC,CAAC;MACJ;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MACE,MAAM2X,QAAQA,CAAC9X,QAAQ,EAAgB;QAAA,IAAd4X,OAAO,GAAAvS,SAAA,CAAAqD,MAAA,QAAArD,SAAA,QAAAiI,SAAA,GAAAjI,SAAA,MAAG,CAAC,CAAC;QACnC,IAAI,CAAClF,WAAW,CAACgB,MAAM,CAAC,8CAA8C,CAAC;QACvE,OAAO,IAAI,CAAC4L,MAAM,CAAC+K,QAAQ,CAAC9X,QAAQ,EAAE4X,OAAO,CAAC;MAChD;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;MACE,MAAMG,OAAOA,CAAA,EAAG;QACd,IAAI,CAAC5X,WAAW,CAACgB,MAAM,CAAC,kDAAkD,CAAC;QAC3E,IAAI,IAAI,CAACmW,QAAQ,GAAG,CAAC,EAAE;UACrB,IAAI,CAACA,QAAQ,GAAG,CAAC;QACnB;QACA,OAAO,CAAC,MAAM,IAAI,CAAC9E,UAAU,CAAC,CAAC,EAAE,IAAI,CAAC8E,QAAQ,CAAC;MACjD;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MACE,MAAM5Q,OAAOA,CAACsR,SAAS,EAAE;QACvB,IAAI,CAAC7X,WAAW,CAACgB,MAAM,CAAC,6CAA6C,CAAC;QACtE,OAAO,IAAI,CAAC4L,MAAM,CAACrG,OAAO,CAACsR,SAAS,CAAC;MACvC;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MACEC,cAAcA,CAACD,SAAS,EAAE;QACxB,IAAI,CAAC7X,WAAW,CAACgB,MAAM,CAAC,oDAAoD,CAAC;QAC7E,OAAO,IAAI,CAAC4L,MAAM,CAACkL,cAAc,CAACD,SAAS,CAAC;MAC9C;IACF;IAACzC,sBAAA;EAAA,SAAAC,WAAA;IAAA,OAAAD,sBAAA,CAAAC,WAAA;EAAA;EAAAD,sBAAA;AAAA;EAAA5R,IAAA;EAAA8R,KAAA;AAAA,G;;;;;;;;;;;;;;IC7TDtX,MAAM,CAACC,MAAM,CAAC;MAACgB,YAAY,EAACA,CAAA,KAAIA,YAAY;MAACC,gBAAgB,EAACA,CAAA,KAAIA,gBAAgB;MAACsW,YAAY,EAACA,CAAA,KAAIA,YAAY;MAACrX,OAAO,EAACA,CAAA,KAAIA;IAAO,CAAC,CAAC;IAAC,IAAIS,KAAK;IAACZ,MAAM,CAACK,IAAI,CAAC,cAAc,EAAC;MAACO,KAAKA,CAACN,CAAC,EAAC;QAACM,KAAK,GAACN,CAAC;MAAA;IAAC,CAAC,EAAC,CAAC,CAAC;IAAC,IAAIoB,oBAAoB,CAAC,CAAC,EAAE,CAAC,MAAMA,oBAAoB,CAAC,CAAC,EAAE,CAAC;IAE/P,MAAMvB,OAAO,GAAG;MACdkF,QAAQA,CAAA,EAAwC;QAAA,IAAvC0U,GAAG,GAAA7S,SAAA,CAAAqD,MAAA,QAAArD,SAAA,QAAAiI,SAAA,GAAAjI,SAAA,MAAG,EAAE;QAAA,IAAE8S,GAAG,GAAA9S,SAAA,CAAAqD,MAAA,QAAArD,SAAA,QAAAiI,SAAA,GAAAjI,SAAA,MAAG,EAAE;QAAA,IAAE+S,WAAW,GAAA/S,SAAA,CAAAqD,MAAA,QAAArD,SAAA,QAAAiI,SAAA,GAAAjI,SAAA,MAAG,GAAG;QAC5C,OAAO6S,GAAG,CAAC9T,OAAO,CAAC,oBAAoB,EAAEgU,WAAW,CAAC,CAAChM,SAAS,CAAC,CAAC,EAAE+L,GAAG,CAAC;MACzE,CAAC;MACDE,WAAWA,CAACC,GAAG,EAAE;QACf,OAAOA,GAAG,KAAK,KAAK,CAAC;MACvB,CAAC;MACD9T,QAAQA,CAAC8T,GAAG,EAAE;QACZ,IAAI,IAAI,CAACC,OAAO,CAACD,GAAG,CAAC,IAAI,IAAI,CAACjU,UAAU,CAACiU,GAAG,CAAC,EAAE;UAC7C,OAAO,KAAK;QACd;QACA,OAAOA,GAAG,KAAKvX,MAAM,CAACuX,GAAG,CAAC;MAC5B,CAAC;MACDC,OAAOA,CAACD,GAAG,EAAE;QACX,OAAOE,KAAK,CAACD,OAAO,CAACD,GAAG,CAAC;MAC3B,CAAC;MACD1U,SAASA,CAAC0U,GAAG,EAAE;QACb,OAAOA,GAAG,KAAK,IAAI,IAAIA,GAAG,KAAK,KAAK,IAAIvX,MAAM,CAAC0X,SAAS,CAACrO,QAAQ,CAACjC,IAAI,CAACmQ,GAAG,CAAC,KAAK,kBAAkB;MACpG,CAAC;MACDjU,UAAUA,CAACiU,GAAG,EAAE;QACd,OAAO,OAAOA,GAAG,KAAK,UAAU,IAAI,KAAK;MAC3C,CAAC;MACDI,MAAMA,CAACC,IAAI,EAAE;QACX,OAAO,CAAC/S,MAAM,CAAC6O,KAAK,CAAC,IAAIhJ,IAAI,CAACkN,IAAI,CAAC,CAACC,OAAO,CAAC,CAAC,CAAC;MAChD,CAAC;MACDC,OAAOA,CAACP,GAAG,EAAE;QACX,IAAI,IAAI,CAACI,MAAM,CAACJ,GAAG,CAAC,EAAE;UACpB,OAAO,KAAK;QACd;QACA,IAAI,IAAI,CAAC9T,QAAQ,CAAC8T,GAAG,CAAC,EAAE;UACtB,OAAO,CAACvX,MAAM,CAACX,IAAI,CAACkY,GAAG,CAAC,CAAC5P,MAAM;QACjC;QACA,IAAI,IAAI,CAAC6P,OAAO,CAACD,GAAG,CAAC,IAAI,IAAI,CAACvU,QAAQ,CAACuU,GAAG,CAAC,EAAE;UAC3C,OAAO,CAACA,GAAG,CAAC5P,MAAM;QACpB;QACA,OAAO,KAAK;MACd,CAAC;MACD6C,KAAKA,CAAC+M,GAAG,EAAE;QACT,IAAI,CAAC,IAAI,CAAC9T,QAAQ,CAAC8T,GAAG,CAAC,EAAE,OAAOA,GAAG;QACnC,OAAO,IAAI,CAACC,OAAO,CAACD,GAAG,CAAC,GAAGA,GAAG,CAACQ,KAAK,CAAC,CAAC,GAAG/X,MAAM,CAACqH,MAAM,CAAC,CAAC,CAAC,EAAEkQ,GAAG,CAAC;MACjE,CAAC;MACDrJ,GAAGA,CAAC8J,IAAI,EAAE3R,IAAI,EAAE;QACd,IAAIkR,GAAG,GAAGS,IAAI;QACd,IAAI,CAAC,IAAI,CAACvU,QAAQ,CAAC8T,GAAG,CAAC,EAAE;UACvB,OAAO,KAAK;QACd;QACA,IAAI,CAAC,IAAI,CAACC,OAAO,CAACnR,IAAI,CAAC,EAAE;UACvB,OAAO,IAAI,CAAC5C,QAAQ,CAAC8T,GAAG,CAAC,IAAIvX,MAAM,CAAC0X,SAAS,CAACO,cAAc,CAAC7Q,IAAI,CAACmQ,GAAG,EAAElR,IAAI,CAAC;QAC9E;QAEA,MAAMsB,MAAM,GAAGtB,IAAI,CAACsB,MAAM;QAC1B,KAAK,IAAIuQ,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGvQ,MAAM,EAAEuQ,CAAC,EAAE,EAAE;UAC/B,IAAI,CAAClY,MAAM,CAAC0X,SAAS,CAACO,cAAc,CAAC7Q,IAAI,CAACmQ,GAAG,EAAElR,IAAI,CAAC6R,CAAC,CAAC,CAAC,EAAE;YACvD,OAAO,KAAK;UACd;UACAX,GAAG,GAAGA,GAAG,CAAClR,IAAI,CAAC6R,CAAC,CAAC,CAAC;QACpB;QACA,OAAO,CAAC,CAACvQ,MAAM;MACjB,CAAC;MACDkD,IAAIA,CAAC0M,GAAG,EAAW;QACjB,MAAMY,KAAK,GAAGnY,MAAM,CAACqH,MAAM,CAAC,CAAC,CAAC,EAAEkQ,GAAG,CAAC;QAAC,SAAAa,IAAA,GAAA9T,SAAA,CAAAqD,MAAA,EAD1BtI,IAAI,OAAAoY,KAAA,CAAAW,IAAA,OAAAA,IAAA,WAAAC,IAAA,MAAAA,IAAA,GAAAD,IAAA,EAAAC,IAAA;UAAJhZ,IAAI,CAAAgZ,IAAA,QAAA/T,SAAA,CAAA+T,IAAA;QAAA;QAEf,KAAK,IAAIH,CAAC,GAAG7Y,IAAI,CAACsI,MAAM,GAAG,CAAC,EAAEuQ,CAAC,IAAI,CAAC,EAAEA,CAAC,EAAE,EAAE;UACzC,OAAOC,KAAK,CAAC9Y,IAAI,CAAC6Y,CAAC,CAAC,CAAC;QACvB;QAEA,OAAOC,KAAK;MACd,CAAC;MACDG,GAAG,EAAE5N,IAAI,CAAC4N,GAAG;MACbC,QAAQA,CAACC,IAAI,EAAEC,IAAI,EAAgB;QAAA,IAAd7C,OAAO,GAAAtR,SAAA,CAAAqD,MAAA,QAAArD,SAAA,QAAAiI,SAAA,GAAAjI,SAAA,MAAG,CAAC,CAAC;QAC/B,IAAIoS,QAAQ,GAAG,CAAC;QAChB,IAAI1G,OAAO,GAAG,IAAI;QAClB,IAAIjJ,MAAM;QACV,MAAM2R,IAAI,GAAG,IAAI;QACjB,IAAI9V,IAAI;QACR,IAAI+V,IAAI;QAER,MAAMC,KAAK,GAAGA,CAAA,KAAM;UAClBlC,QAAQ,GAAGd,OAAO,CAACiD,OAAO,KAAK,KAAK,GAAG,CAAC,GAAGH,IAAI,CAACJ,GAAG,CAAC,CAAC;UACrDtI,OAAO,GAAG,IAAI;UACdjJ,MAAM,GAAGyR,IAAI,CAACnU,KAAK,CAACzB,IAAI,EAAE+V,IAAI,CAAC;UAC/B,IAAI,CAAC3I,OAAO,EAAE;YACZpN,IAAI,GAAG+V,IAAI,GAAG,IAAI;UACpB;QACF,CAAC;QAED,MAAMG,SAAS,GAAG,SAAAA,CAAA,EAAY;UAC5B,MAAMR,GAAG,GAAGI,IAAI,CAACJ,GAAG,CAAC,CAAC;UACtB,IAAI,CAAC5B,QAAQ,IAAId,OAAO,CAACiD,OAAO,KAAK,KAAK,EAAEnC,QAAQ,GAAG4B,GAAG;UAC1D,MAAMS,SAAS,GAAGN,IAAI,IAAIH,GAAG,GAAG5B,QAAQ,CAAC;UACzC9T,IAAI,GAAG,IAAI;UACX+V,IAAI,GAAGrU,SAAS;UAChB,IAAIyU,SAAS,IAAI,CAAC,IAAIA,SAAS,GAAGN,IAAI,EAAE;YACtC,IAAIzI,OAAO,EAAE;cACXU,YAAY,CAACV,OAAO,CAAC;cACrBA,OAAO,GAAG,IAAI;YAChB;YACA0G,QAAQ,GAAG4B,GAAG;YACdvR,MAAM,GAAGyR,IAAI,CAACnU,KAAK,CAACzB,IAAI,EAAE+V,IAAI,CAAC;YAC/B,IAAI,CAAC3I,OAAO,EAAE;cACZpN,IAAI,GAAG+V,IAAI,GAAG,IAAI;YACpB;UACF,CAAC,MAAM,IAAI,CAAC3I,OAAO,IAAI4F,OAAO,CAACoD,QAAQ,KAAK,KAAK,EAAE;YACjDhJ,OAAO,GAAG/E,UAAU,CAAC2N,KAAK,EAAEG,SAAS,CAAC;UACxC;UACA,OAAOhS,MAAM;QACf,CAAC;QAED+R,SAAS,CAACG,MAAM,GAAG,MAAM;UACvBvI,YAAY,CAACV,OAAO,CAAC;UACrB0G,QAAQ,GAAG,CAAC;UACZ1G,OAAO,GAAGpN,IAAI,GAAG+V,IAAI,GAAG,IAAI;QAC9B,CAAC;QAED,OAAOG,SAAS;MAClB;IACF,CAAC;IAED,MAAMI,QAAQ,GAAG,CAAC,QAAQ,EAAE,QAAQ,EAAE,MAAM,CAAC;IAC7C,KAAK,IAAIhB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGgB,QAAQ,CAACvR,MAAM,EAAEuQ,CAAC,EAAE,EAAE;MACxC3a,OAAO,CAAC,IAAI,GAAG2b,QAAQ,CAAChB,CAAC,CAAC,CAAC,GAAG,UAAUX,GAAG,EAAE;QAC3C,OAAOvX,MAAM,CAAC0X,SAAS,CAACrO,QAAQ,CAACjC,IAAI,CAACmQ,GAAG,CAAC,gBAAAlX,MAAA,CAAgB6Y,QAAQ,CAAChB,CAAC,CAAC,MAAG;MAC1E,CAAC;IACH;;IAEA;AACA;AACA;IACA,MAAM7Z,YAAY,GAAG,SAAAA,CAASkZ,GAAG,EAAE;MACjC,KAAK,IAAItX,GAAG,IAAIsX,GAAG,EAAE;QACnB,IAAIha,OAAO,CAACyF,QAAQ,CAACuU,GAAG,CAACtX,GAAG,CAAC,CAAC,IAAIsX,GAAG,CAACtX,GAAG,CAAC,CAAC6I,QAAQ,CAAC,iBAAiB,CAAC,EAAE;UACtEyO,GAAG,CAACtX,GAAG,CAAC,GAAGsX,GAAG,CAACtX,GAAG,CAAC,CAACoD,OAAO,CAAC,iBAAiB,EAAE,EAAE,CAAC;UAClDkU,GAAG,CAACtX,GAAG,CAAC,GAAG,IAAIyK,IAAI,CAAClH,QAAQ,CAAC+T,GAAG,CAACtX,GAAG,CAAC,CAAC,CAAC;QACzC,CAAC,MAAM,IAAI1C,OAAO,CAACkG,QAAQ,CAAC8T,GAAG,CAACtX,GAAG,CAAC,CAAC,EAAE;UACrCsX,GAAG,CAACtX,GAAG,CAAC,GAAG5B,YAAY,CAACkZ,GAAG,CAACtX,GAAG,CAAC,CAAC;QACnC,CAAC,MAAM,IAAI1C,OAAO,CAACia,OAAO,CAACD,GAAG,CAACtX,GAAG,CAAC,CAAC,EAAE;UACpC,IAAIvC,CAAC;UACL,KAAK,IAAIwa,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGX,GAAG,CAACtX,GAAG,CAAC,CAAC0H,MAAM,EAAEuQ,CAAC,EAAE,EAAE;YACxCxa,CAAC,GAAG6Z,GAAG,CAACtX,GAAG,CAAC,CAACiY,CAAC,CAAC;YACf,IAAI3a,OAAO,CAACkG,QAAQ,CAAC/F,CAAC,CAAC,EAAE;cACvB6Z,GAAG,CAACtX,GAAG,CAAC,CAACiY,CAAC,CAAC,GAAG7Z,YAAY,CAACX,CAAC,CAAC;YAC/B,CAAC,MAAM,IAAIH,OAAO,CAACyF,QAAQ,CAACtF,CAAC,CAAC,IAAIA,CAAC,CAACoL,QAAQ,CAAC,iBAAiB,CAAC,EAAE;cAC/DpL,CAAC,GAAGA,CAAC,CAAC2F,OAAO,CAAC,iBAAiB,EAAE,EAAE,CAAC;cACpCkU,GAAG,CAACtX,GAAG,CAAC,CAACiY,CAAC,CAAC,GAAG,IAAIxN,IAAI,CAAClH,QAAQ,CAAC9F,CAAC,CAAC,CAAC;YACrC;UACF;QACF;MACF;MACA,OAAO6Z,GAAG;IACZ,CAAC;;IAED;AACA;AACA;IACA,MAAMjZ,gBAAgB,GAAG,SAAAA,CAASiZ,GAAG,EAAE;MACrC,KAAK,IAAItX,GAAG,IAAIsX,GAAG,EAAE;QACnB,IAAIha,OAAO,CAACoa,MAAM,CAACJ,GAAG,CAACtX,GAAG,CAAC,CAAC,EAAE;UAC5BsX,GAAG,CAACtX,GAAG,CAAC,qBAAAI,MAAA,CAAqB,CAACkX,GAAG,CAACtX,GAAG,CAAC,CAAE;QAC1C,CAAC,MAAM,IAAI1C,OAAO,CAACkG,QAAQ,CAAC8T,GAAG,CAACtX,GAAG,CAAC,CAAC,EAAE;UACrCsX,GAAG,CAACtX,GAAG,CAAC,GAAG3B,gBAAgB,CAACiZ,GAAG,CAACtX,GAAG,CAAC,CAAC;QACvC,CAAC,MAAM,IAAI1C,OAAO,CAACia,OAAO,CAACD,GAAG,CAACtX,GAAG,CAAC,CAAC,EAAE;UACpC,IAAIvC,CAAC;UACL,KAAK,IAAIwa,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGX,GAAG,CAACtX,GAAG,CAAC,CAAC0H,MAAM,EAAEuQ,CAAC,EAAE,EAAE;YACxCxa,CAAC,GAAG6Z,GAAG,CAACtX,GAAG,CAAC,CAACiY,CAAC,CAAC;YACf,IAAI3a,OAAO,CAACkG,QAAQ,CAAC/F,CAAC,CAAC,EAAE;cACvB6Z,GAAG,CAACtX,GAAG,CAAC,CAACiY,CAAC,CAAC,GAAG5Z,gBAAgB,CAACZ,CAAC,CAAC;YACnC,CAAC,MAAM,IAAIH,OAAO,CAACoa,MAAM,CAACja,CAAC,CAAC,EAAE;cAC5B6Z,GAAG,CAACtX,GAAG,CAAC,CAACiY,CAAC,CAAC,qBAAA7X,MAAA,CAAqB,CAAC3C,CAAC,CAAE;YACtC;UACF;QACF;MACF;MACA,OAAO6Z,GAAG;IACZ,CAAC;;IAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACA;IACA,MAAM3C,YAAY,GAAG,SAAAA,CAAChR,OAAO,EAAkF;MAAA,IAAhF6H,OAAO,GAAAnH,SAAA,CAAAqD,MAAA,QAAArD,SAAA,QAAAiI,SAAA,GAAAjI,SAAA,MAAG,UAAU;MAAA,IAAE6U,QAAQ,GAAA7U,SAAA,CAAAqD,MAAA,QAAArD,SAAA,QAAAiI,SAAA,GAAAjI,SAAA,MAAG,CAAC8U,yBAAyB,IAAI,CAAC,CAAC,EAAEC,QAAQ;MACxGrb,KAAK,CAAC4F,OAAO,EAAE5D,MAAM,CAAC;MACtBhC,KAAK,CAACyN,OAAO,EAAEtI,MAAM,CAAC;MACtB,IAAI0S,OAAO,GAAGsD,QAAQ;MAEtB,IAAI,CAAC5b,OAAO,CAACyF,QAAQ,CAAC6S,OAAO,CAAC,EAAE;QAC9B;QACAA,OAAO,GAAG,CAACuD,yBAAyB,IAAI,CAAC,CAAC,EAAEC,QAAQ,IAAI,GAAG;MAC7D;MAEA,MAAMC,KAAK,GAAGzD,OAAO,CAACxS,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC;MACzC,MAAMgP,IAAI,GAAIzO,OAAO,CAACkN,QAAQ,IAAIlN,OAAO,CAACkN,QAAQ,CAACrF,OAAO,CAAC,IAAK7H,OAAO,IAAI,CAAC,CAAC;MAE7E,IAAImJ,GAAG;MACP,IAAIxP,OAAO,CAACyF,QAAQ,CAACqP,IAAI,CAACzF,SAAS,CAAC,EAAE;QACpCG,GAAG,OAAA1M,MAAA,CAAOgS,IAAI,CAACzF,SAAS,CAACvJ,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC,CAAE;MAC/C,CAAC,MAAM;QACL0J,GAAG,GAAG,EAAE;MACV;MAEA,IAAInJ,OAAO,CAACrB,MAAM,KAAK,IAAI,EAAE;QAC3B,OAAO+W,KAAK,IAAI7N,OAAO,KAAK,UAAU,MAAApL,MAAA,CAAMuD,OAAO,CAAC8R,cAAc,OAAArV,MAAA,CAAIuD,OAAO,CAAC6B,GAAG,EAAApF,MAAA,CAAG0M,GAAG,OAAA1M,MAAA,CAAQuD,OAAO,CAAC8R,cAAc,OAAArV,MAAA,CAAIoL,OAAO,OAAApL,MAAA,CAAIuD,OAAO,CAAC6B,GAAG,EAAApF,MAAA,CAAG0M,GAAG,CAAE,CAAC;MAC1J;MACA,UAAA1M,MAAA,CAAUiZ,KAAK,EAAAjZ,MAAA,CAAGuD,OAAO,CAAC8R,cAAc,OAAArV,MAAA,CAAIuD,OAAO,CAAC+R,eAAe,OAAAtV,MAAA,CAAIuD,OAAO,CAAC6B,GAAG,OAAApF,MAAA,CAAIoL,OAAO,OAAApL,MAAA,CAAIuD,OAAO,CAAC6B,GAAG,EAAApF,MAAA,CAAG0M,GAAG;IACpH,CAAC;IAACyH,sBAAA;EAAA,SAAAC,WAAA;IAAA,OAAAD,sBAAA,CAAAC,WAAA;EAAA;EAAAD,sBAAA;AAAA;EAAA5R,IAAA;EAAA8R,KAAA;AAAA,G;;;;;;;;;;;;;;ICnNFtX,MAAM,CAACC,MAAM,CAAC;MAACc,OAAO,EAACA,CAAA,KAAID;IAAW,CAAC,CAAC;IAAC,IAAIM,EAAE;IAACpB,MAAM,CAACK,IAAI,CAAC,UAAU,EAAC;MAACU,OAAOA,CAACT,CAAC,EAAC;QAACc,EAAE,GAACd,CAAC;MAAA;IAAC,CAAC,EAAC,CAAC,CAAC;IAAC,IAAIgB,QAAQ;IAACtB,MAAM,CAACK,IAAI,CAAC,MAAM,EAAC;MAACU,OAAOA,CAACT,CAAC,EAAC;QAACgB,QAAQ,GAAChB,CAAC;MAAA;IAAC,CAAC,EAAC,CAAC,CAAC;IAAC,IAAIG,MAAM;IAACT,MAAM,CAACK,IAAI,CAAC,eAAe,EAAC;MAACI,MAAMA,CAACH,CAAC,EAAC;QAACG,MAAM,GAACH,CAAC;MAAA;IAAC,CAAC,EAAC,CAAC,CAAC;IAAC,IAAIH,OAAO;IAACH,MAAM,CAACK,IAAI,CAAC,UAAU,EAAC;MAACF,OAAOA,CAACG,CAAC,EAAC;QAACH,OAAO,GAACG,CAAC;MAAA;IAAC,CAAC,EAAC,CAAC,CAAC;IAAC,IAAIoB,oBAAoB,CAAC,CAAC,EAAE,CAAC,MAAMA,oBAAoB,CAAC,CAAC,EAAE,CAAC;IAInV,MAAMI,IAAI,GAAGA,CAAA,KAAM,CAAC,CAAC;;IAErB;AACA;AACA;AACA;IACA,MAAMH,KAAK,GAAGlB,MAAM,CAACmB,eAAe,CAACC,QAAQ,IAAIA,QAAQ,CAAC,CAAC,CAAC;IAC5D,MAAMsa,OAAO,GAAG,CAAC,CAAC;;IAElB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACe,MAAMrb,WAAW,CAAC;MAC/BuC,WAAWA,CAAC4F,IAAI,EAAEsE,SAAS,EAAEnE,IAAI,EAAEnE,WAAW,EAAE;QAC9C,IAAI,CAACgE,IAAI,GAAGA,IAAI,CAACmT,IAAI,CAAC,CAAC;QACvB,IAAI,CAAC7O,SAAS,GAAGA,SAAS;QAC1B,IAAI,CAACnE,IAAI,GAAGA,IAAI;QAChB,IAAI,CAACnE,WAAW,GAAGA,WAAW;QAC9B,IAAI,CAAC,IAAI,CAACgE,IAAI,IAAI,CAAC9I,OAAO,CAACyF,QAAQ,CAAC,IAAI,CAACqD,IAAI,CAAC,EAAE;UAC9C;QACF;QAEA,IAAI,CAACoT,EAAE,GAAG,IAAI;QACd,IAAI,CAAC/S,KAAK,GAAG,KAAK;QAClB,IAAI,CAACD,OAAO,GAAG,KAAK;QACpB,IAAI,CAACiT,aAAa,GAAG,CAAC;QAEtB,IAAIH,OAAO,CAAC,IAAI,CAAClT,IAAI,CAAC,IAAI,CAACkT,OAAO,CAAC,IAAI,CAAClT,IAAI,CAAC,CAACK,KAAK,IAAI,CAAC6S,OAAO,CAAC,IAAI,CAAClT,IAAI,CAAC,CAACI,OAAO,EAAE;UAClF,IAAI,CAACgT,EAAE,GAAGF,OAAO,CAAC,IAAI,CAAClT,IAAI,CAAC,CAACoT,EAAE;UAC/B,IAAI,CAACC,aAAa,GAAGH,OAAO,CAAC,IAAI,CAAClT,IAAI,CAAC,CAACqT,aAAa;QACvD,CAAC,MAAM;UACLlb,EAAE,CAACuQ,IAAI,CAAC,IAAI,CAAC1I,IAAI,EAAE,CAAC4I,SAAS,EAAEJ,KAAK,KAAK;YACvC9P,KAAK,CAAC,MAAM;cACV,IAAIkQ,SAAS,IAAI,CAACJ,KAAK,CAACG,MAAM,CAAC,CAAC,EAAE;gBAChC,MAAME,KAAK,GAAG,IAAI,CAAC7I,IAAI,CAACkF,KAAK,CAAC7M,QAAQ,CAACyF,GAAG,CAAC;gBAC3C+K,KAAK,CAACC,GAAG,CAAC,CAAC;gBACX,IAAI;kBACF3Q,EAAE,CAACgG,SAAS,CAAC0K,KAAK,CAAC5O,IAAI,CAAC5B,QAAQ,CAACyF,GAAG,CAAC,EAAE;oBAAEO,SAAS,EAAE;kBAAK,CAAC,CAAC;gBAC7D,CAAC,CAAC,OAAOiV,UAAU,EAAE;kBACnB,MAAM,IAAI9b,MAAM,CAACuF,KAAK,CAAC,GAAG,sGAAA/C,MAAA,CAAqG6O,KAAK,CAAC5O,IAAI,CAAC5B,QAAQ,CAACyF,GAAG,CAAC,SAAKwV,UAAU,CAAC;gBACzK;gBAEA,IAAI;kBACFnb,EAAE,CAAC2R,aAAa,CAAC,IAAI,CAAC9J,IAAI,EAAE,EAAE,CAAC;gBACjC,CAAC,CAAC,OAAOuT,cAAc,EAAE;kBACvB,MAAM,IAAI/b,MAAM,CAACuF,KAAK,CAAC,GAAG,+FAAA/C,MAAA,CAA8F,IAAI,CAACgG,IAAI,SAAKuT,cAAc,CAAC;gBACvJ;cACF;cAEApb,EAAE,CAACqb,IAAI,CAAC,IAAI,CAACxT,IAAI,EAAE,IAAI,EAAE,IAAI,CAAChE,WAAW,EAAE,CAACyX,MAAM,EAAEL,EAAE,KAAK;gBACzD1a,KAAK,CAAC,MAAM;kBACV,IAAI+a,MAAM,EAAE;oBACV,IAAI,CAAC3T,KAAK,CAAC,CAAC;oBACZ,MAAM,IAAItI,MAAM,CAACuF,KAAK,CAAC,GAAG,EAAE,+DAA+D,EAAE0W,MAAM,CAAC;kBACtG,CAAC,MAAM;oBACL,IAAI,CAACL,EAAE,GAAGA,EAAE;oBACZF,OAAO,CAAC,IAAI,CAAClT,IAAI,CAAC,GAAG,IAAI;kBAC3B;gBACF,CAAC,CAAC;cACJ,CAAC,CAAC;YACJ,CAAC,CAAC;UACJ,CAAC,CAAC;QACJ;MACF;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MACEqH,KAAKA,CAACqM,GAAG,EAAEC,KAAK,EAAE/a,QAAQ,EAAE;QAC1B,IAAI,CAAC,IAAI,CAACwH,OAAO,IAAI,CAAC,IAAI,CAACC,KAAK,EAAE;UAChC,IAAI,IAAI,CAAC+S,EAAE,EAAE;YACXjb,EAAE,CAACkP,KAAK,CAAC,IAAI,CAAC+L,EAAE,EAAEO,KAAK,EAAE,CAAC,EAAEA,KAAK,CAACrS,MAAM,EAAE,CAACoS,GAAG,GAAG,CAAC,IAAI,IAAI,CAACvT,IAAI,CAACtF,SAAS,EAAE,CAACyD,KAAK,EAAEsV,OAAO,EAAE1L,MAAM,KAAK;cACrGxP,KAAK,CAAC,MAAM;gBACVE,QAAQ,IAAIA,QAAQ,CAAC0F,KAAK,EAAEsV,OAAO,EAAE1L,MAAM,CAAC;gBAC5C,IAAI5J,KAAK,EAAE;kBACT9G,MAAM,CAACuC,MAAM,CAAC,kDAAkD,EAAEuE,KAAK,CAAC;kBACxE,IAAI,CAACwB,KAAK,CAAC,CAAC;gBACd,CAAC,MAAM;kBACL,EAAE,IAAI,CAACuT,aAAa;gBACtB;cACF,CAAC,CAAC;YACJ,CAAC,CAAC;UACJ,CAAC,MAAM;YACL7b,MAAM,CAACoN,UAAU,CAAC,MAAM;cACtB,IAAI,CAACyC,KAAK,CAACqM,GAAG,EAAEC,KAAK,EAAE/a,QAAQ,CAAC;YAClC,CAAC,EAAE,EAAE,CAAC;UACR;QACF;QACA,OAAO,KAAK;MACd;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;MACEgH,GAAGA,CAAChH,QAAQ,EAAE;QACZ,IAAI,CAAC,IAAI,CAACwH,OAAO,IAAI,CAAC,IAAI,CAACC,KAAK,EAAE;UAChC,IAAI,IAAI,CAACgT,aAAa,KAAK,IAAI,CAAC/O,SAAS,EAAE;YACzCnM,EAAE,CAAC2V,KAAK,CAAC,IAAI,CAACsF,EAAE,EAAE,MAAM;cACtB1a,KAAK,CAAC,MAAM;gBACV,OAAOwa,OAAO,CAAC,IAAI,CAAClT,IAAI,CAAC;gBACzB,IAAI,CAACK,KAAK,GAAG,IAAI;gBACjBzH,QAAQ,IAAIA,QAAQ,CAAC,KAAK,CAAC,EAAE,IAAI,CAAC;cACpC,CAAC,CAAC;YACJ,CAAC,CAAC;YACF,OAAO,IAAI;UACb;UAEAT,EAAE,CAACuQ,IAAI,CAAC,IAAI,CAAC1I,IAAI,EAAE,CAAC1B,KAAK,EAAEoK,IAAI,KAAK;YAClChQ,KAAK,CAAC,MAAM;cACV,IAAI,CAAC4F,KAAK,IAAIoK,IAAI,EAAE;gBAClB,IAAI,CAAC2K,aAAa,GAAG5W,IAAI,CAACoX,IAAI,CAACnL,IAAI,CAAC/K,IAAI,GAAG,IAAI,CAACwC,IAAI,CAACtF,SAAS,CAAC;cACjE;cAEA,OAAOrD,MAAM,CAACoN,UAAU,CAAC,MAAM;gBAC7B,IAAI,CAAChF,GAAG,CAAChH,QAAQ,CAAC;cACpB,CAAC,EAAE,EAAE,CAAC;YACR,CAAC,CAAC;UACJ,CAAC,CAAC;QACJ,CAAC,MAAM;UACLA,QAAQ,IAAIA,QAAQ,CAAC,KAAK,CAAC,EAAE,IAAI,CAACyH,KAAK,CAAC;QAC1C;QACA,OAAO,KAAK;MACd;;MAEA;AACF;AACA;AACA;AACA;AACA;AACA;MACEP,KAAKA,CAAClH,QAAQ,EAAE;QACd,IAAI,CAACwH,OAAO,GAAG,IAAI;QACnB,OAAO8S,OAAO,CAAC,IAAI,CAAClT,IAAI,CAAC;QACzB7H,EAAE,CAAC6N,MAAM,CAAC,IAAI,CAAChG,IAAI,EAAGpH,QAAQ,IAAIC,IAAK,CAAC;QACxC,OAAO,IAAI;MACb;;MAEA;AACF;AACA;AACA;AACA;AACA;MACE8G,IAAIA,CAAA,EAAG;QACL,IAAI,CAACS,OAAO,GAAG,IAAI;QACnB,OAAO8S,OAAO,CAAC,IAAI,CAAClT,IAAI,CAAC;QACzB,OAAO,IAAI;MACb;IACF;IAACmO,sBAAA;EAAA,SAAAC,WAAA;IAAA,OAAAD,sBAAA,CAAAC,WAAA;EAAA;EAAAD,sBAAA;AAAA;EAAA5R,IAAA;EAAA8R,KAAA;AAAA,G","file":"/packages/ostrio_files.js","sourcesContent":["import { Mongo } from 'meteor/mongo';\nimport { fetch } from 'meteor/fetch';\nimport { WebApp } from 'meteor/webapp';\nimport { Meteor } from 'meteor/meteor';\nimport { Random } from 'meteor/random';\nimport { Cookies } from 'meteor/ostrio:cookies';\nimport { check, Match } from 'meteor/check';\n\nimport WriteStream from './write-stream.js';\nimport FilesCollectionCore from './core.js';\nimport { fixJSONParse, fixJSONStringify, helpers } from './lib.js';\n\nimport AbortController from 'abort-controller';\nimport fs from 'fs';\nimport nodeQs from 'querystring';\nimport nodePath from 'path';\n// in Node.js 14, there is no promises version of stream\nimport { pipeline as pipelineCallback } from 'stream';\nimport { promisify } from 'util';\n// change to this in \"loadAsync\" when Meteor supports Node.js 15 upwards\n//import nodeStream from 'stream/promises';\n\nconst pipeline = promisify(pipelineCallback);\n\n/**\n * @const {Object} bound  - Meteor.bindEnvironment (Fiber wrapper)\n * @const {Function} noop - No Operation function, placeholder for required callbacks\n */\nconst bound = Meteor.bindEnvironment(callback => callback());\nconst noop = function noop () {};\n\n\n/**\n * Create (ensure) index on MongoDB collection, catch and log exception if thrown\n * @function createIndex\n * @param {Mongo.Collection} collection - Mongo.Collection instance\n * @param {object} keys - Field and value pairs where the field is the index key and the value describes the type of index for that field\n * @param {object} opts - Set of options that controls the creation of the index\n * @returns {void 0}\n */\nconst createIndex = async (_collection, keys, opts) => {\n  const collection = _collection.rawCollection();\n\n  try {\n    await collection.createIndex(keys, opts);\n  } catch (e) {\n    if (e.code === 85) {\n      let indexName;\n      const indexes = await collection.indexes();\n      for (const index of indexes) {\n        let allMatch = true;\n        for (const indexKey of Object.keys(keys)) {\n          if (typeof index.key[indexKey] === 'undefined') {\n            allMatch = false;\n            break;\n          }\n        }\n\n        for (const indexKey of Object.keys(index.key)) {\n          if (typeof keys[indexKey] === 'undefined') {\n            allMatch = false;\n            break;\n          }\n        }\n\n        if (allMatch) {\n          indexName = index.name;\n          break;\n        }\n      }\n\n      if (indexName) {\n        await collection.dropIndex(indexName);\n        await collection.createIndex(keys, opts);\n      }\n    } else {\n      Meteor._debug(`Can not set ${Object.keys(keys).join(' + ')} index on \"${_collection._name}\" collection`, { keys, opts, details: e });\n    }\n  }\n};\n\n/**\n * @locus Anywhere\n * @class FilesCollection\n * @param config           {Object}   - [Both]   Configuration object with next properties:\n * @param config.debug     {Boolean}  - [Both]   Turn on/of debugging and extra logging\n * @param config.schema    {Object}   - [Both]   Collection Schema\n * @param config.public    {Boolean}  - [Both]   Store files in folder accessible for proxy servers, for limits, and more - read docs\n * @param config.strict    {Boolean}  - [Server] Strict mode for partial content, if is `true` server will return `416` response code, when `range` is not specified, otherwise server return `206`\n * @param config.protected {Function} - [Server] If `true` - files will be served only to authorized users, if `function()` - you're able to check visitor's permissions in your own way function's context has:\n *  - `request`\n *  - `response`\n *  - `user()`\n *  - `userId`\n * @param config.chunkSize      {Number}  - [Both] Upload chunk size, default: 524288 bytes (0,5 Mb)\n * @param config.permissions    {Number}  - [Server] Permissions which will be set to uploaded files (octal), like: `511` or `0o755`. Default: 0644\n * @param config.parentDirPermissions {Number}  - [Server] Permissions which will be set to parent directory of uploaded files (octal), like: `611` or `0o777`. Default: 0755\n * @param config.storagePath    {String|Function}  - [Server] Storage path on file system\n * @param config.cacheControl   {String}  - [Server] Default `Cache-Control` header\n * @param config.responseHeaders {Object|Function} - [Server] Custom response headers, if function is passed, must return Object\n * @param config.throttle       {Number}  - [Server] DEPRECATED bps throttle threshold\n * @param config.downloadRoute  {String}  - [Both]   Server Route used to retrieve files\n * @param config.collection     {Mongo.Collection} - [Both] Mongo Collection Instance\n * @param config.collectionName {String}  - [Both]   Collection name\n * @param config.namingFunction {Function}- [Both]   Function which returns `String`\n * @param config.integrityCheck {Boolean} - [Server] Check file's integrity before serving to users\n * @param config.onAfterUpload  {Function}- [Server] Called right after file is ready on FS. Use to transfer file somewhere else, or do other thing with file directly\n * @param config.onAfterRemove  {Function} - [Server] Called right after file is removed. Removed objects is passed to callback\n * @param config.continueUploadTTL {Number} - [Server] Time in seconds, during upload may be continued, default 3 hours (10800 seconds)\n * @param config.onBeforeUpload {Function}- [Both]   Function which executes on server after receiving each chunk and on client right before beginning upload. Function context is `File` - so you are able to check for extension, mime-type, size and etc.:\n *  - return or resolve `true` to continue\n *  - return or resolve `false` or `String` to abort upload\n * @param config.getUser        {Function} - [Server] Replace default way of recognizing user, usefull when you want to auth user based on custom cookie (or other way). arguments {http: {request: {...}, response: {...}}}, need to return {userId: String, user: Function}\n * @param config.onInitiateUpload {Function} - [Server] Function which executes on server right before upload is begin and right after `onBeforeUpload` hook. This hook is fully asynchronous.\n * @param config.onBeforeRemove {Function} - [Server] Executes before removing file on server, so you can check permissions. Return `true` to allow action and `false` to deny.\n * @param config.allowClientCode  {Boolean}  - [Both]   Allow to run `remove` from client\n * @param config.downloadCallback {Function} - [Server] Callback triggered each time file is requested, return truthy value to continue download, or falsy to abort\n * @param config.interceptRequest {Function} - [Server] Intercept incoming HTTP request, so you can whatever you want, no checks or preprocessing, arguments {http: {request: {...}, response: {...}}, params: {...}}\n * @param config.interceptDownload {Function} - [Server] Intercept download request, so you can serve file from third-party resource, arguments {http: {request: {...}, response: {...}}, fileRef: {...}}\n * @param config.disableUpload {Boolean} - Disable file upload, useful for server only solutions\n * @param config.disableDownload {Boolean} - Disable file download (serving), useful for file management only solutions\n * @param config.allowedOrigins  {Regex|Boolean}  - [Server]   Regex of Origins that are allowed CORS access or `false` to disable completely. Defaults to `/^http:\\/\\/localhost:12[0-9]{3}$/` for allowing Meteor-Cordova builds access\n * @param config.allowQueryStringCookies {Boolean} - Allow passing Cookies in a query string (in URL). Primary should be used only in Cordova environment. Note: this option will be used only on Cordova. Default: `false`\n * @param config.sanitize {Function} - Override default sanitize function\n * @param config._preCollection  {Mongo.Collection} - [Server] Mongo preCollection Instance\n * @param config._preCollectionName {String}  - [Server]  preCollection name\n * @summary Create new instance of FilesCollection\n */\nclass FilesCollection extends FilesCollectionCore {\n  constructor(config) {\n    super();\n    let storagePath;\n    if (config) {\n      ({\n        _preCollection: this._preCollection,\n        _preCollectionName: this._preCollectionName,\n        allowClientCode: this.allowClientCode,\n        allowedOrigins: this.allowedOrigins,\n        allowQueryStringCookies: this.allowQueryStringCookies,\n        cacheControl: this.cacheControl,\n        chunkSize: this.chunkSize,\n        collection: this.collection,\n        collectionName: this.collectionName,\n        continueUploadTTL: this.continueUploadTTL,\n        debug: this.debug,\n        disableDownload: this.disableDownload,\n        disableUpload: this.disableUpload,\n        downloadCallback: this.downloadCallback,\n        downloadRoute: this.downloadRoute,\n        getUser: this.getUser,\n        integrityCheck: this.integrityCheck,\n        interceptDownload: this.interceptDownload,\n        interceptRequest: this.interceptRequest,\n        namingFunction: this.namingFunction,\n        onAfterRemove: this.onAfterRemove,\n        onAfterUpload: this.onAfterUpload,\n        onBeforeRemove: this.onBeforeRemove,\n        onBeforeUpload: this.onBeforeUpload,\n        onInitiateUpload: this.onInitiateUpload,\n        parentDirPermissions: this.parentDirPermissions,\n        permissions: this.permissions,\n        protected: this.protected,\n        public: this.public,\n        responseHeaders: this.responseHeaders,\n        sanitize: this.sanitize,\n        schema: this.schema,\n        storagePath,\n        strict: this.strict,\n      } = config);\n    }\n\n    const self = this;\n\n    if (!helpers.isBoolean(this.debug)) {\n      this.debug = false;\n    }\n\n    if (!helpers.isBoolean(this.public)) {\n      this.public = false;\n    }\n\n    if (!this.protected) {\n      this.protected = false;\n    }\n\n    if (!this.chunkSize) {\n      this.chunkSize = 1024 * 512;\n    }\n\n    this.chunkSize = Math.floor(this.chunkSize / 8) * 8;\n\n    if (!helpers.isString(this.collectionName) && !this.collection) {\n      this.collectionName = 'MeteorUploadFiles';\n    }\n\n    if (!this.collection) {\n      this.collection = new Mongo.Collection(this.collectionName);\n    } else {\n      this.collectionName = this.collection._name;\n    }\n\n    this.collection.filesCollection = this;\n    check(this.collectionName, String);\n\n    if (this.public && !this.downloadRoute) {\n      throw new Meteor.Error(500, `[FilesCollection.${this.collectionName}]: \"downloadRoute\" must be precisely provided on \"public\" collections! Note: \"downloadRoute\" must be equal or be inside of your web/proxy-server (relative) root.`);\n    }\n\n    if (!helpers.isString(this.downloadRoute)) {\n      this.downloadRoute = '/cdn/storage';\n    }\n\n    this.downloadRoute = this.downloadRoute.replace(/\\/$/, '');\n\n    if (!helpers.isFunction(this.namingFunction)) {\n      this.namingFunction = false;\n    }\n\n    if (!helpers.isFunction(this.onBeforeUpload)) {\n      this.onBeforeUpload = false;\n    }\n\n    if (!helpers.isFunction(this.getUser)) {\n      this.getUser = false;\n    }\n\n    if (!helpers.isBoolean(this.allowClientCode)) {\n      this.allowClientCode = true;\n    }\n\n    if (!helpers.isFunction(this.onInitiateUpload)) {\n      this.onInitiateUpload = false;\n    }\n\n    if (!helpers.isFunction(this.interceptRequest)) {\n      this.interceptRequest = false;\n    }\n\n    if (!helpers.isFunction(this.interceptDownload)) {\n      this.interceptDownload = false;\n    }\n\n    if (!helpers.isBoolean(this.strict)) {\n      this.strict = true;\n    }\n\n    if (!helpers.isBoolean(this.allowQueryStringCookies)) {\n      this.allowQueryStringCookies = false;\n    }\n\n    if (!helpers.isNumber(this.permissions)) {\n      this.permissions = parseInt('644', 8);\n    }\n\n    if (!helpers.isNumber(this.parentDirPermissions)) {\n      this.parentDirPermissions = parseInt('755', 8);\n    }\n\n    if (!helpers.isString(this.cacheControl)) {\n      this.cacheControl = 'public, max-age=31536000, s-maxage=31536000';\n    }\n\n    if (!helpers.isFunction(this.onAfterUpload)) {\n      this.onAfterUpload = false;\n    }\n\n    if (!helpers.isBoolean(this.disableUpload)) {\n      this.disableUpload = false;\n    }\n\n    if (!helpers.isFunction(this.onAfterRemove)) {\n      this.onAfterRemove = false;\n    }\n\n    if (!helpers.isFunction(this.onBeforeRemove)) {\n      this.onBeforeRemove = false;\n    }\n\n    if (!helpers.isBoolean(this.integrityCheck)) {\n      this.integrityCheck = true;\n    }\n\n    if (!helpers.isBoolean(this.disableDownload)) {\n      this.disableDownload = false;\n    }\n\n    if (this.allowedOrigins === true || this.allowedOrigins === void 0) {\n      this.allowedOrigins = /^http:\\/\\/localhost:12[0-9]{3}$/;\n    }\n\n    if (!helpers.isObject(this._currentUploads)) {\n      this._currentUploads = {};\n    }\n\n    if (!helpers.isFunction(this.downloadCallback)) {\n      this.downloadCallback = false;\n    }\n\n    if (!helpers.isNumber(this.continueUploadTTL)) {\n      this.continueUploadTTL = 10800;\n    }\n\n    if (!helpers.isFunction(this.sanitize)) {\n      this.sanitize = helpers.sanitize;\n    }\n\n    if (!helpers.isFunction(this.responseHeaders)) {\n      this.responseHeaders = (responseCode, fileRef, versionRef) => {\n        const headers = {};\n        switch (responseCode) {\n        case '206':\n          headers.Pragma = 'private';\n          headers['Transfer-Encoding'] = 'chunked';\n          break;\n        case '400':\n          headers['Cache-Control'] = 'no-cache';\n          break;\n        case '416':\n          headers['Content-Range'] = `bytes */${versionRef.size}`;\n          break;\n        default:\n          break;\n        }\n\n        headers.Connection = 'keep-alive';\n        headers['Content-Type'] = versionRef.type || 'application/octet-stream';\n        headers['Accept-Ranges'] = 'bytes';\n        return headers;\n      };\n    }\n\n    if (this.public && !storagePath) {\n      throw new Meteor.Error(500, `[FilesCollection.${this.collectionName}] \"storagePath\" must be set on \"public\" collections! Note: \"storagePath\" must be equal on be inside of your web/proxy-server (absolute) root.`);\n    }\n\n    if (!storagePath) {\n      storagePath = function () {\n        return `assets${nodePath.sep}app${nodePath.sep}uploads${nodePath.sep}${self.collectionName}`;\n      };\n    }\n\n    if (helpers.isString(storagePath)) {\n      this.storagePath = () => storagePath;\n    } else {\n      this.storagePath = function () {\n        let sp = storagePath.apply(self, arguments);\n        if (!helpers.isString(sp)) {\n          throw new Meteor.Error(400, `[FilesCollection.${self.collectionName}] \"storagePath\" function must return a String!`);\n        }\n        sp = sp.replace(/\\/$/, '');\n        return nodePath.normalize(sp);\n      };\n    }\n\n    this._debug('[FilesCollection.storagePath] Set to:', this.storagePath({}));\n\n    try {\n      fs.mkdirSync(this.storagePath({}), {\n        mode: this.parentDirPermissions,\n        recursive: true\n      });\n    } catch (error) {\n      if (error) {\n        throw new Meteor.Error(401, `[FilesCollection.${self.collectionName}] Path \"${this.storagePath({})}\" is not writable!`, error);\n      }\n    }\n\n    check(this.strict, Boolean);\n    check(this.permissions, Number);\n    check(this.storagePath, Function);\n    check(this.cacheControl, String);\n    check(this.onAfterRemove, Match.OneOf(false, Function));\n    check(this.onAfterUpload, Match.OneOf(false, Function));\n    check(this.disableUpload, Boolean);\n    check(this.integrityCheck, Boolean);\n    check(this.onBeforeRemove, Match.OneOf(false, Function));\n    check(this.disableDownload, Boolean);\n    check(this.downloadCallback, Match.OneOf(false, Function));\n    check(this.interceptRequest, Match.OneOf(false, Function));\n    check(this.interceptDownload, Match.OneOf(false, Function));\n    check(this.continueUploadTTL, Number);\n    check(this.responseHeaders, Match.OneOf(Object, Function));\n    check(this.allowedOrigins, Match.OneOf(Boolean, RegExp));\n    check(this.allowQueryStringCookies, Boolean);\n\n    this._cookies = new Cookies({\n      allowQueryStringCookies: this.allowQueryStringCookies,\n      allowedCordovaOrigins: this.allowedOrigins\n    });\n\n    if (!this.disableUpload) {\n      if (!helpers.isString(this._preCollectionName) && !this._preCollection) {\n        this._preCollectionName = `__pre_${this.collectionName}`;\n      }\n\n      if (!this._preCollection) {\n        this._preCollection = new Mongo.Collection(this._preCollectionName);\n      } else {\n        this._preCollectionName = this._preCollection._name;\n      }\n      check(this._preCollectionName, String);\n\n      createIndex(this._preCollection, { createdAt: 1 }, { expireAfterSeconds: this.continueUploadTTL, background: true });\n      const _preCollectionCursor = this._preCollection.find({}, {\n        fields: {\n          _id: 1,\n          isFinished: 1\n        }\n      });\n\n      _preCollectionCursor.observe({\n        async changed(doc) {\n          if (doc.isFinished) {\n            self._debug(`[FilesCollection] [_preCollectionCursor.observe] [changed]: ${doc._id}`);\n            await self._preCollection.removeAsync({_id: doc._id});\n          }\n        },\n        async removed(doc) {\n          // Free memory after upload is done\n          // Or if upload is unfinished\n          self._debug(`[FilesCollection] [_preCollectionCursor.observe] [removed]: ${doc._id}`);\n          if (helpers.isObject(self._currentUploads[doc._id])) {\n            self._currentUploads[doc._id].stop();\n            self._currentUploads[doc._id].end();\n\n            // We can be unlucky to run into a race condition where another server removed this document before the change of `isFinished` is registered on this server.\n            // Therefore it's better to double-check with the main collection if the file is referenced there. Issue: https://github.com/veliovgroup/Meteor-Files/issues/672\n            if (!doc.isFinished && (await self.collection.find({ _id: doc._id }).countAsync()) === 0) {\n              self._debug(`[FilesCollection] [_preCollectionCursor.observe] [removeUnfinishedUpload]: ${doc._id}`);\n              self._currentUploads[doc._id].abort();\n            }\n\n            delete self._currentUploads[doc._id];\n          }\n        }\n      });\n\n      this._createStream = (_id, path, opts) => {\n        this._currentUploads[_id] = new WriteStream(path, opts.fileLength, opts, this.permissions);\n      };\n\n      // This little function allows to continue upload\n      // even after server is restarted (*not on dev-stage*)\n      this._continueUpload = async (_id) => {\n        if (this._currentUploads[_id] && this._currentUploads[_id].file) {\n          if (!this._currentUploads[_id].aborted && !this._currentUploads[_id].ended) {\n            return this._currentUploads[_id].file;\n          }\n          this._createStream(_id, this._currentUploads[_id].file.file.path, this._currentUploads[_id].file);\n          return this._currentUploads[_id].file;\n        }\n        const contUpld = await this._preCollection.findOneAsync({_id});\n        if (contUpld) {\n          this._createStream(_id, contUpld.file.path, contUpld);\n          return this._currentUploads[_id].file;\n        }\n        return false;\n      };\n    }\n\n    if (!this.schema) {\n      this.schema = FilesCollectionCore.schema;\n    }\n\n    check(this.debug, Boolean);\n    check(this.schema, Object);\n    check(this.public, Boolean);\n    check(this.getUser, Match.OneOf(false, Function));\n    check(this.protected, Match.OneOf(Boolean, Function));\n    check(this.chunkSize, Number);\n    check(this.downloadRoute, String);\n    check(this.namingFunction, Match.OneOf(false, Function));\n    check(this.onBeforeUpload, Match.OneOf(false, Function));\n    check(this.onInitiateUpload, Match.OneOf(false, Function));\n    check(this.allowClientCode, Boolean);\n\n    if (this.public && this.protected) {\n      throw new Meteor.Error(500, `[FilesCollection.${this.collectionName}]: Files can not be public and protected at the same time!`);\n    }\n\n    this._checkAccess = async (http) => {\n      if (this.protected) {\n        let result;\n        const {userAsync, userId} = this._getUser(http);\n\n        if (helpers.isFunction(this.protected)) {\n          let fileRef;\n          if (helpers.isObject(http.params) &&  http.params._id) {\n            fileRef = await this.collection.findOneAsync(http.params._id);\n          }\n\n          result = http ? await this.protected.call(Object.assign(http, {userAsync, userId}), (fileRef || null)) : await this.protected.call({userAsync, userId}, (fileRef || null));\n        } else {\n          result = !!userId;\n        }\n\n        if ((http && (result === true)) || !http) {\n          return true;\n        }\n\n        const rc = helpers.isNumber(result) ? result : 401;\n        this._debug('[FilesCollection._checkAccess] WARN: Access denied!');\n        if (http) {\n          const text = 'Access denied!';\n          if (!http.response.headersSent) {\n            http.response.writeHead(rc, {\n              'Content-Type': 'text/plain',\n              'Content-Length': text.length\n            });\n          }\n\n          if (!http.response.finished) {\n            http.response.end(text);\n          }\n        }\n\n        return false;\n      }\n      return true;\n    };\n\n    this._methodNames = {\n      _Abort: `_FilesCollectionAbort_${this.collectionName}`,\n      _Write: `_FilesCollectionWrite_${this.collectionName}`,\n      _Start: `_FilesCollectionStart_${this.collectionName}`,\n      _Remove: `_FilesCollectionRemove_${this.collectionName}`\n    };\n\n    this.on('_handleUpload', this._handleUpload);\n    this.on('_finishUpload', this._finishUpload);\n    this._handleUploadSync = Meteor.wrapAsync(this._handleUpload.bind(this));\n\n    if (this.disableUpload && this.disableDownload) {\n      return;\n    }\n    WebApp.connectHandlers.use(async (httpReq, httpResp, next) => {\n      if (this.allowedOrigins && httpReq._parsedUrl.path.includes(`${this.downloadRoute}/`) && !httpResp.headersSent) {\n        if (this.allowedOrigins.test(httpReq.headers.origin)) {\n          httpResp.setHeader('Access-Control-Allow-Credentials', 'true');\n          httpResp.setHeader('Access-Control-Allow-Origin', httpReq.headers.origin);\n        }\n\n        if (httpReq.method === 'OPTIONS') {\n          httpResp.setHeader('Access-Control-Allow-Methods', 'GET, POST, OPTIONS');\n          httpResp.setHeader('Access-Control-Allow-Headers', 'Range, Content-Type, x-mtok, x-start, x-chunkid, x-fileid, x-eof');\n          httpResp.setHeader('Access-Control-Expose-Headers', 'Accept-Ranges, Content-Encoding, Content-Length, Content-Range');\n          httpResp.setHeader('Allow', 'GET, POST, OPTIONS');\n          httpResp.writeHead(200);\n          httpResp.end();\n          return;\n        }\n      }\n\n      if (!this.disableUpload && httpReq._parsedUrl.path.includes(`${this.downloadRoute}/${this.collectionName}/__upload`)) {\n        if (httpReq.method !== 'POST') {\n          next();\n          return;\n        }\n\n        const handleError = (_error) => {\n          let error = _error;\n          Meteor._debug('[FilesCollection] [Upload] [HTTP] Exception:', error);\n\n          if (!httpResp.headersSent) {\n            httpResp.writeHead(500);\n          }\n\n          if (!httpResp.finished) {\n            if (helpers.isObject(error) && helpers.isFunction(error.toString)) {\n              error = error.toString();\n            }\n\n            if (!helpers.isString(error)) {\n              error = 'Unexpected error!';\n            }\n\n            httpResp.end(JSON.stringify({ error }));\n          }\n        };\n\n        let body = '';\n        const handleData = async () => {\n          try {\n            let opts;\n            let result;\n            let user = this._getUser({request: httpReq, response: httpResp});\n\n            if (httpReq.headers['x-start'] !== '1') {\n              // CHUNK UPLOAD SCENARIO:\n              opts = {\n                fileId: this.sanitize(httpReq.headers['x-fileid'], 20, 'a')\n              };\n\n              if (httpReq.headers['x-eof'] === '1') {\n                opts.eof = true;\n              } else {\n                opts.binData = Buffer.from(body, 'base64');\n                opts.chunkId = parseInt(httpReq.headers['x-chunkid']);\n              }\n\n              const _continueUpload = await this._continueUpload(opts.fileId);\n              if (!_continueUpload) {\n                throw new Meteor.Error(408, 'Can\\'t continue upload, session expired. Start upload again.');\n              }\n\n              ({result, opts} = await this._prepareUpload(Object.assign(opts, _continueUpload), user.userId, 'HTTP'));\n\n              if (opts.eof) {\n                // FINISH UPLOAD SCENARIO:\n                this._handleUpload(result, opts, (_error) => {\n                  let error = _error;\n                  if (error) {\n                    if (!httpResp.headersSent) {\n                      httpResp.writeHead(500);\n                    }\n\n                    if (!httpResp.finished) {\n                      if (helpers.isObject(error) && helpers.isFunction(error.toString)) {\n                        error = error.toString();\n                      }\n\n                      if (!helpers.isString(error)) {\n                        error = 'Unexpected error!';\n                      }\n\n                      httpResp.end(JSON.stringify({ error }));\n                    }\n                  }\n\n                  if (!httpResp.headersSent) {\n                    httpResp.writeHead(200);\n                  }\n\n                  if (helpers.isObject(result.file) && result.file.meta) {\n                    result.file.meta = fixJSONStringify(result.file.meta);\n                  }\n\n                  if (!httpResp.finished) {\n                    httpResp.end(JSON.stringify(result));\n                  }\n                });\n                return;\n              }\n\n              this.emit('_handleUpload', result, opts, noop);\n\n              if (!httpResp.headersSent) {\n                httpResp.writeHead(204);\n              }\n              if (!httpResp.finished) {\n                httpResp.end();\n              }\n            } else {\n              // START SCENARIO:\n              try {\n                opts = JSON.parse(body);\n              } catch (jsonErr) {\n                Meteor._debug('Can\\'t parse incoming JSON from Client on [.insert() | upload], something went wrong!', jsonErr);\n                opts = {file: {}};\n              }\n\n              if (!helpers.isObject(opts.file)) {\n                opts.file = {};\n              }\n\n              if (opts.fileId) {\n                opts.fileId = this.sanitize(opts.fileId, 20, 'a');\n              }\n\n              this._debug(`[FilesCollection] [File Start HTTP] ${opts.file.name || '[no-name]'} - ${opts.fileId}`);\n              if (helpers.isObject(opts.file) && opts.file.meta) {\n                opts.file.meta = fixJSONParse(opts.file.meta);\n              }\n\n              opts.___s = true;\n              ({result} = await this._prepareUpload(helpers.clone(opts), user.userId, 'HTTP Start Method'));\n\n              let res;\n              res = await this.collection.findOneAsync(result._id);\n\n              if (res) {\n                throw new Meteor.Error(400, 'Can\\'t start upload, data substitution detected!');\n              }\n\n              opts._id = opts.fileId;\n              opts.createdAt = new Date();\n              opts.maxLength = opts.fileLength;\n\n              await this._preCollection.insertAsync(helpers.omit(opts, '___s'));\n              this._createStream(result._id, result.path, helpers.omit(opts, '___s'));\n\n              if (opts.returnMeta) {\n                if (!httpResp.headersSent) {\n                  httpResp.writeHead(200);\n                }\n\n                if (!httpResp.finished) {\n                  httpResp.end(JSON.stringify({\n                    uploadRoute: `${this.downloadRoute}/${this.collectionName}/__upload`,\n                    file: result\n                  }));\n                }\n              } else {\n                if (!httpResp.headersSent) {\n                  httpResp.writeHead(204);\n                }\n\n                if (!httpResp.finished) {\n                  httpResp.end();\n                }\n              }\n            }\n          } catch (httpRespErr) {\n            handleError(httpRespErr);\n          }\n        };\n\n        httpReq.setTimeout(20000, handleError);\n        if (typeof httpReq.body === 'object' && Object.keys(httpReq.body).length !== 0) {\n          body = JSON.stringify(httpReq.body);\n          handleData();\n        } else {\n          httpReq.on('data', (data) => bound(() => {\n            body += data;\n          }));\n\n          httpReq.on('end', () => bound(() => {\n            handleData();\n          }));\n        }\n        return;\n      }\n\n      if (!this.disableDownload) {\n        let uri;\n\n        if (!this.public) {\n          if (httpReq._parsedUrl.path.includes(`${this.downloadRoute}/${this.collectionName}`)) {\n            uri = httpReq._parsedUrl.path.replace(`${this.downloadRoute}/${this.collectionName}`, '');\n            if (uri.indexOf('/') === 0) {\n              uri = uri.substring(1);\n            }\n\n            const uris = uri.split('/');\n            if (uris.length === 3) {\n              const params = {\n                _id: uris[0],\n                query: httpReq._parsedUrl.query ? nodeQs.parse(httpReq._parsedUrl.query) : {},\n                name: uris[2].split('?')[0],\n                version: uris[1]\n              };\n\n              const http = {request: httpReq, response: httpResp, params};\n\n              if (this.interceptRequest && helpers.isFunction(this.interceptRequest) && (await this.interceptRequest(http)) === true) {\n                return;\n              }\n\n              if (await this._checkAccess(http)) {\n                await this.download(http, uris[1], await this.collection.findOneAsync(uris[0]));\n              }\n            } else {\n              next();\n            }\n          } else {\n            next();\n          }\n        } else {\n          if (httpReq._parsedUrl.path.includes(`${this.downloadRoute}`)) {\n            uri = httpReq._parsedUrl.path.replace(`${this.downloadRoute}`, '');\n            if (uri.indexOf('/') === 0) {\n              uri = uri.substring(1);\n            }\n\n            const uris = uri.split('/');\n            let _file = uris[uris.length - 1];\n            if (_file) {\n              let version;\n              if (_file.includes('-')) {\n                version = _file.split('-')[0];\n                _file = _file.split('-')[1].split('?')[0];\n              } else {\n                version = 'original';\n                _file = _file.split('?')[0];\n              }\n\n              const params = {\n                query: httpReq._parsedUrl.query ? nodeQs.parse(httpReq._parsedUrl.query) : {},\n                file: _file,\n                _id: _file.split('.')[0],\n                version,\n                name: _file\n              };\n              const http = {request: httpReq, response: httpResp, params};\n              if (this.interceptRequest && helpers.isFunction(this.interceptRequest) && (await this.interceptRequest(http)) === true) {\n                return;\n              }\n              await this.download(http, version, await this.collection.findOneAsync(params._id));\n            } else {\n              next();\n            }\n          } else {\n            next();\n          }\n        }\n        return;\n      }\n      next();\n    });\n\n    if (!this.disableUpload) {\n      const _methods = {};\n\n      // Method used to remove file\n      // from Client side\n      _methods[this._methodNames._Remove] = async function (selector) {\n        check(selector, Match.OneOf(String, Object));\n        self._debug(`[FilesCollection] [Unlink Method] [.remove(${selector})]`);\n\n        if (self.allowClientCode) {\n          if (self.onBeforeRemove && helpers.isFunction(self.onBeforeRemove)) {\n            const userId = this.userId;\n            const userFuncs = {\n              userId: this.userId,\n              userAsync(){\n                if (Meteor.users) {\n                  return Meteor.users.findOneAsync(userId);\n                }\n                return null;\n              }\n            };\n\n            if (!(await self.onBeforeRemove.call(userFuncs, (self.find(selector) || null)))) {\n              throw new Meteor.Error(403, '[FilesCollection] [remove] Not permitted!');\n            }\n          }\n\n          const cursor = self.find(selector);\n          if ((await cursor.countAsync()) > 0) {\n            self.removeAsync(selector);\n            return true;\n          }\n          throw new Meteor.Error(404, 'Cursor is empty, no files is removed');\n        } else {\n          throw new Meteor.Error(405, '[FilesCollection] [remove] Running code on a client is not allowed!');\n        }\n      };\n\n\n      // Method used to receive \"first byte\" of upload\n      // and all file's meta-data, so\n      // it won't be transferred with every chunk\n      // Basically it prepares everything\n      // So user can pause/disconnect and\n      // continue upload later, during `continueUploadTTL`\n      _methods[this._methodNames._Start] = async function (opts, returnMeta) {\n        check(opts, {\n          file: Object,\n          fileId: String,\n          FSName: Match.Optional(String),\n          chunkSize: Number,\n          fileLength: Number\n        });\n\n        check(returnMeta, Match.Optional(Boolean));\n\n        opts.fileId = self.sanitize(opts.fileId, 20, 'a');\n\n        self._debug(`[FilesCollection] [File Start Method] ${opts.file.name} - ${opts.fileId}`);\n        opts.___s = true;\n        const { result } = await self._prepareUpload(helpers.clone(opts), this.userId, 'DDP Start Method');\n\n        if (await self.collection.findOneAsync(result._id)) {\n          throw new Meteor.Error(400, 'Can\\'t start upload, data substitution detected!');\n        }\n\n        opts._id = opts.fileId;\n        opts.createdAt = new Date();\n        opts.maxLength = opts.fileLength;\n        try {\n          await self._preCollection.insertAsync(helpers.omit(opts, '___s'));\n          self._createStream(result._id, result.path, helpers.omit(opts, '___s'));\n        } catch (e) {\n          self._debug(`[FilesCollection] [File Start Method] [EXCEPTION:] ${opts.file.name} - ${opts.fileId}`, e);\n          throw new Meteor.Error(500, 'Can\\'t start');\n        }\n\n        if (returnMeta) {\n          return {\n            uploadRoute: `${self.downloadRoute}/${self.collectionName}/__upload`,\n            file: result\n          };\n        }\n        return true;\n      };\n\n\n      // Method used to write file chunks\n      // it receives very limited amount of meta-data\n      // This method also responsible for EOF\n      _methods[this._methodNames._Write] = async function (_opts) {\n        let opts = _opts;\n        let result;\n        check(opts, {\n          eof: Match.Optional(Boolean),\n          fileId: String,\n          binData: Match.Optional(String),\n          chunkId: Match.Optional(Number)\n        });\n\n        opts.fileId = self.sanitize(opts.fileId, 20, 'a');\n\n        if (opts.binData) {\n          opts.binData = Buffer.from(opts.binData, 'base64');\n        }\n\n        const _continueUpload = await self._continueUpload(opts.fileId);\n        if (!_continueUpload) {\n          throw new Meteor.Error(408, 'Can\\'t continue upload, session expired. Start upload again.');\n        }\n\n        ({result, opts} = await self._prepareUpload(Object.assign(opts, _continueUpload), this.userId, 'DDP'));\n\n        if (opts.eof) {\n          try {\n            return self._handleUploadSync(result, opts);\n          } catch (handleUploadErr) {\n            self._debug('[FilesCollection] [Write Method] [DDP] Exception:', handleUploadErr);\n            throw handleUploadErr;\n          }\n        } else {\n          self.emit('_handleUpload', result, opts, noop);\n        }\n        return true;\n      };\n\n      // Method used to Abort upload\n      // - Freeing memory by ending writableStreams\n      // - Removing temporary record from @_preCollection\n      // - Removing record from @collection\n      // - .unlink()ing chunks from FS\n      _methods[this._methodNames._Abort] = async function (_id) {\n        check(_id, String);\n\n        const _continueUpload = await self._continueUpload(_id);\n        self._debug(`[FilesCollection] [Abort Method]: ${_id} - ${(helpers.isObject(_continueUpload.file) ? _continueUpload.file.path : '')}`);\n\n        if (self._currentUploads && self._currentUploads[_id]) {\n          self._currentUploads[_id].stop();\n          self._currentUploads[_id].abort();\n        }\n\n        if (_continueUpload) {\n          await self._preCollection.removeAsync({_id});\n          await self.removeAsync({_id});\n\n\n          if (helpers.isObject(_continueUpload.file) && _continueUpload.file.path) {\n            await self.unlink({_id, path: _continueUpload.file.path});\n          }\n        }\n        return true;\n      };\n\n      Meteor.methods(_methods);\n    }\n  }\n\n  /**\n   * @locus Server\n   * @memberOf FilesCollection\n   * @name _prepareUpload\n   * @summary Internal method. Used to optimize received data and check upload permission\n   * @returns {Promise<Object>}\n   */\n  async _prepareUpload(opts = {}, userId, transport) {\n    let ctx;\n    if (!helpers.isBoolean(opts.eof)) {\n      opts.eof = false;\n    }\n\n    if (!opts.binData) {\n      opts.binData = 'EOF';\n    }\n\n    if (!helpers.isNumber(opts.chunkId)) {\n      opts.chunkId = -1;\n    }\n\n    if (!helpers.isString(opts.FSName)) {\n      opts.FSName = opts.fileId;\n    }\n\n    this._debug(`[FilesCollection] [Upload] [${transport}] Got #${opts.chunkId}/${opts.fileLength} chunks, dst: ${opts.file.name || opts.file.fileName}`);\n\n    const fileName = this._getFileName(opts.file);\n    const {extension, extensionWithDot} = this._getExt(fileName);\n\n    if (!helpers.isObject(opts.file.meta)) {\n      opts.file.meta = {};\n    }\n\n    let result = opts.file;\n    result.name = fileName;\n    result.meta = opts.file.meta;\n    result.extension = extension;\n    result.ext = extension;\n    result._id = opts.fileId;\n    result.userId = userId || null;\n    opts.FSName = this.sanitize(opts.FSName);\n\n    if (this.namingFunction) {\n      opts.FSName = this.namingFunction(opts);\n    }\n\n    result.path = `${this.storagePath(result)}${nodePath.sep}${opts.FSName}${extensionWithDot}`;\n    result = Object.assign(result, this._dataToSchema(result));\n\n    if (this.onBeforeUpload && helpers.isFunction(this.onBeforeUpload)) {\n      ctx = Object.assign({\n        file: opts.file\n      }, {\n        chunkId: opts.chunkId,\n        userId: result.userId,\n        async userAsync() {\n          if (Meteor.users && result.userId) {\n            return Meteor.users.findOneAsync(result.userId);\n          }\n          return null;\n        },\n        eof: opts.eof\n      });\n      const isUploadAllowed = await this.onBeforeUpload.call(ctx, result);\n\n      if (isUploadAllowed !== true) {\n        throw new Meteor.Error(403, helpers.isString(isUploadAllowed) ? isUploadAllowed : '@onBeforeUpload() returned false');\n      } else {\n        if ((opts.___s === true) && this.onInitiateUpload && helpers.isFunction(this.onInitiateUpload)) {\n          await this.onInitiateUpload.call(ctx, result);\n        }\n      }\n    } else if ((opts.___s === true) && this.onInitiateUpload && helpers.isFunction(this.onInitiateUpload)) {\n      ctx = Object.assign({\n        file: opts.file\n      }, {\n        chunkId: opts.chunkId,\n        userId: result.userId,\n        async userAsync() {\n          if (Meteor.users && result.userId) {\n            return Meteor.users.findOneAsync(result.userId);\n          }\n          return null;\n        },\n        eof: opts.eof\n      });\n      await this.onInitiateUpload.call(ctx, result);\n    }\n\n    return {result, opts};\n  }\n\n  /**\n   * @locus Server\n   * @memberOf FilesCollection\n   * @name _finishUpload\n   * @summary Internal method. Finish upload, close Writable stream, add record to MongoDB and flush used memory\n   * @returns {Promise<undefined>}\n   */\n  async _finishUpload(result, opts, cb) {\n    this._debug(`[FilesCollection] [Upload] [finish(ing)Upload] -> ${result.path}`);\n    fs.chmod(result.path, this.permissions, noop);\n    result.type = this._getMimeType(opts.file);\n    result.public = this.public;\n    this._updateFileTypes(result);\n\n    let _id;\n    try {\n      _id = await this.collection.insertAsync(helpers.clone(result));\n      try {\n        await this._preCollection.updateAsync({_id: opts.fileId}, {$set: {isFinished: true}});\n        if (_id) result._id = _id;\n        this._debug(`[FilesCollection] [Upload] [finish(ed)Upload] -> ${result.path}`);\n        if (this.onAfterUpload && helpers.isFunction(this.onAfterUpload)) {\n          await this.onAfterUpload.call(this, result);\n        }\n        this.emit('afterUpload', result);\n        cb(null, result);\n      } catch (prrUpdateError) {\n        cb(prrUpdateError);\n        this._debug('[FilesCollection] [Upload] [_finishUpload] [update] Error:', prrUpdateError);\n      }\n    } catch (colInsert){\n      cb(colInsert);\n      this._debug('[FilesCollection] [Upload] [_finishUpload] [insert] Error:', colInsert);\n    }\n  }\n\n  /**\n   * @locus Server\n   * @memberOf FilesCollection\n   * @name _handleUpload\n   * @summary Internal method to handle upload process, pipe incoming data to Writable stream\n   * @returns {undefined}\n   */\n  _handleUpload(result, opts, cb) {\n    try {\n      if (opts.eof) {\n        this._currentUploads[result._id].end(() => {\n          this.emit('_finishUpload', result, opts, cb);\n        });\n      } else {\n        this._currentUploads[result._id].write(opts.chunkId, opts.binData, cb);\n      }\n    } catch (e) {\n      this._debug('[_handleUpload] [EXCEPTION:]', e);\n      cb && cb(e);\n    }\n  }\n\n  /**\n   * @locus Anywhere\n   * @memberOf FilesCollection\n   * @name _getMimeType\n   * @param {Object} fileData - File Object\n   * @summary Returns file's mime-type\n   * @returns {String}\n   */\n  _getMimeType(fileData) {\n    let mime;\n    check(fileData, Object);\n    if (helpers.isObject(fileData) && fileData.type) {\n      mime = fileData.type;\n    }\n\n    if (!mime || !helpers.isString(mime)) {\n      mime = 'application/octet-stream';\n    }\n    return mime;\n  }\n\n  /**\n   * @locus Anywhere\n   * @memberOf FilesCollection\n   * @name _getUserId\n   * @summary Returns `userId` matching the xmtok token derived from Meteor.server.sessions\n   * @returns {String}\n   */\n  _getUserId(xmtok) {\n    if (!xmtok) return null;\n\n    // throw an error upon an unexpected type of Meteor.server.sessions in order to identify breaking changes\n    if (!Meteor.server.sessions instanceof Map || !helpers.isObject(Meteor.server.sessions)) {\n      throw new Error('Received incompatible type of Meteor.server.sessions');\n    }\n\n    if (Meteor.server.sessions instanceof Map && Meteor.server.sessions.has(xmtok) && helpers.isObject(Meteor.server.sessions.get(xmtok))) {\n      // to be used with >= Meteor 1.8.1 where Meteor.server.sessions is a Map\n      return Meteor.server.sessions.get(xmtok).userId;\n    } else if (helpers.isObject(Meteor.server.sessions) && xmtok in Meteor.server.sessions && helpers.isObject(Meteor.server.sessions[xmtok])) {\n      // to be used with < Meteor 1.8.1 where Meteor.server.sessions is an Object\n      return Meteor.server.sessions[xmtok].userId;\n    }\n\n    return null;\n  }\n\n  /**\n   * @locus Anywhere\n   * @memberOf FilesCollection\n   * @name _getUser\n   * @summary Returns object with `userId` and `user()` method which return user's object\n   * @returns {Object}\n   */\n  _getUser() {\n    return this.getUser ?\n      this.getUser(...arguments) : this._getUserDefault(...arguments);\n  }\n\n  /**\n   * @locus Anywhere\n   * @memberOf FilesCollection\n   * @name _getUserDefault\n   * @summary Default way of recognising user based on 'x_mtok' cookie, can be replaced by 'config.getUser' if defnied. Returns object with `userId` and `user()` method which return user's object\n   * @returns {Object}\n   */\n  _getUserDefault(http) {\n    const result = {\n      async userAsync() { return null; },\n      user() { return null; },\n      userId: null\n    };\n\n    if (http) {\n      let mtok = null;\n      if (http.request.headers['x-mtok']) {\n        mtok = http.request.headers['x-mtok'];\n      } else {\n        const cookie = http.request.Cookies;\n        if (cookie.has('x_mtok')) {\n          mtok = cookie.get('x_mtok');\n        }\n      }\n\n      if (mtok) {\n        const userId = this._getUserId(mtok);\n\n        if (userId) {\n          result.userAsync = () => Meteor.users.findOneAsync(userId);\n          result.userId = userId;\n        }\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * @locus Server\n   * @memberOf FilesCollection\n   * @name write\n   * @param {Buffer} buffer - Binary File's Buffer\n   * @param {Object} opts - Object with file-data\n   * @param {String} opts.name - File name, alias: `fileName`\n   * @param {String} opts.type - File mime-type\n   * @param {Object} opts.meta - File additional meta-data\n   * @param {String} opts.userId - UserId, default *null*\n   * @param {String} opts.fileId - _id, sanitized, max-length: 20; default *null*\n   * @param {Boolean} proceedAfterUpload - Proceed onAfterUpload hook\n   * @summary Write buffer to FS and add to FilesCollection Collection\n   * @throws {Meteor.Error} If there is an error writing the file or inserting the document\n   * @returns {Promise<FileRef>} Instance\n   */\n  async write(buffer, _opts = {}, _proceedAfterUpload) {\n    this._debug('[FilesCollection] [writeAsync()]');\n    let opts = _opts;\n    let proceedAfterUpload = _proceedAfterUpload;\n\n    if (helpers.isBoolean(opts)) {\n      proceedAfterUpload = opts;\n      opts = {};\n    }\n\n    check(opts, Match.Optional(Object));\n    check(proceedAfterUpload, Match.Optional(Boolean));\n\n    opts.fileId = opts.fileId && this.sanitize(opts.fileId, 20, 'a');\n    const fileId = opts.fileId || Random.id();\n    const fsName = this.namingFunction ? this.namingFunction(opts) : fileId;\n    const fileName = (opts.name || opts.fileName) ? (opts.name || opts.fileName) : fsName;\n\n    const {extension, extensionWithDot} = this._getExt(fileName);\n\n    opts.path = `${this.storagePath(opts)}${nodePath.sep}${fsName}${extensionWithDot}`;\n    opts.type = this._getMimeType(opts);\n    if (!helpers.isObject(opts.meta)) {\n      opts.meta = {};\n    }\n\n    if (!helpers.isNumber(opts.size)) {\n      opts.size = buffer.length;\n    }\n\n    const result = this._dataToSchema({\n      name: fileName,\n      path: opts.path,\n      meta: opts.meta,\n      type: opts.type,\n      size: opts.size,\n      userId: opts.userId,\n      extension\n    });\n\n    result._id = fileId;\n\n    let fileRef;\n\n    let mustCreateFileFirst = false;\n    try {\n      const stats = await fs.promises.stat(opts.path);\n      if (!stats.isFile()) {\n        mustCreateFileFirst = true;\n      }\n    } catch (statError) {\n      mustCreateFileFirst = true;\n    }\n    if (mustCreateFileFirst) {\n      const paths = opts.path.split('/');\n      paths.pop();\n      await fs.promises.mkdir(paths.join('/'), { recursive: true });\n      await fs.promises.writeFile(opts.path, '');\n    }\n\n    const stream = fs.createWriteStream(opts.path, {flags: 'w', mode: this.permissions});\n\n    await new Promise((resolve, reject) => {\n      stream.end(buffer, (streamErr) => {\n        if (streamErr) {\n          reject(streamErr);\n        } else {\n          resolve();\n        }\n      });\n    });\n\n    try {\n      const _id = await this.collection.insertAsync(result);\n      fileRef = await this.collection.findOneAsync(_id);\n\n      if (proceedAfterUpload === true) {\n        if (this.onAfterUpload){\n          await this.onAfterUpload.call(this, fileRef);\n        }\n        this.emit('afterUploadAsync', fileRef);\n      }\n      this._debug(`[FilesCollection] [write]: ${fileName} -> ${this.collectionName}`);\n    } catch (insertErr) {\n      this._debug(`[FilesCollection] [write] [insert] Error: ${fileName} -> ${this.collectionName}`, insertErr);\n      throw new Meteor.Error('writeAsync', insertErr);\n    }\n\n    return fileRef;\n  }\n\n  /**\n   * @locus Server\n   * @memberOf FilesCollection\n   * @name load\n   * @param {String} url - URL to file\n   * @param {Object} [opts] - Object with file-data\n   * @param {Object} opts.headers - HTTP headers to use when requesting the file\n   * @param {String} opts.name - File name, alias: `fileName`\n   * @param {String} opts.type - File mime-type\n   * @param {Object} opts.meta - File additional meta-data\n   * @param {String} opts.userId - UserId, default *null*\n   * @param {String} opts.fileId - _id, sanitized, max-length: 20; default *null*\n   * @param {Number} opts.timeout - Timeout in milliseconds, default: 360000 (6 mins)\n   * @param {Function} callback - function(error, fileObj){...}\n   * @param {Boolean} [proceedAfterUpload] - Proceed onAfterUpload hook\n   * @summary Download file over HTTP, write stream to FS, and add to FilesCollection Collection\n   * @returns {Promise<fileObj>} File Object\n   */\n  async load(url, _opts = {}, _proceedAfterUpload = false) {\n    this._debug(`[FilesCollection] [loadAsync(${url}, ${JSON.stringify(_opts)}, callback)]`);\n    let opts = _opts;\n    let proceedAfterUpload = _proceedAfterUpload;\n\n    if (helpers.isBoolean(_opts)) {\n      proceedAfterUpload = _opts;\n      opts = {};\n    }\n\n    check(url, String);\n    check(opts, Match.Optional(Object));\n    check(proceedAfterUpload, Match.Optional(Boolean));\n\n    if (!helpers.isObject(opts)) {\n      opts = {\n        timeout: 360000\n      };\n    }\n\n    if (!opts.timeout) {\n      opts.timeout = 360000;\n    }\n\n    const fileId = (opts.fileId && this.sanitize(opts.fileId, 20, 'a')) || Random.id();\n    const fsName = this.namingFunction ? this.namingFunction(opts) : fileId;\n    const pathParts = url.split('/');\n    const fileName = (opts.name || opts.fileName) ? (opts.name || opts.fileName) : pathParts[pathParts.length - 1].split('?')[0] || fsName;\n\n    const {extension, extensionWithDot} = this._getExt(fileName);\n    opts.path = `${this.storagePath(opts)}${nodePath.sep}${fsName}${extensionWithDot}`;\n\n    // this will be the resolved fileRef\n    let fileRef;\n\n    // storeResult is a function that will be called after the file is downloaded and stored in the database\n    // this might throw an error from collection.insertAsync or collection.findOneAsync\n    const storeResult = async (result) => {\n      result._id = fileId;\n      const _id  = await this.collection.insertAsync(result);\n\n      fileRef = await this.collection.findOneAsync(_id);\n      if (proceedAfterUpload === true) {\n        if (this.onAfterUpload){\n          await this.onAfterUpload.call(this, fileRef);\n        }\n        this.emit('afterUploadAsync', fileRef);\n      }\n      this._debug(`[FilesCollection] [load] [insert] ${fileName} -> ${this.collectionName}`);\n    };\n\n    // check if the file already exists, otherwise create it\n    let mustCreateFileFirst = false;\n    try {\n      const stats = await fs.promises.stat(opts.path);\n      if (!stats.isFile()) {\n        mustCreateFileFirst = true;\n      }\n    } catch (statError) {\n      mustCreateFileFirst = true;\n    }\n    if(mustCreateFileFirst) {\n      const paths = opts.path.split('/');\n      paths.pop();\n      fs.mkdirSync(paths.join('/'), { recursive: true });\n      fs.writeFileSync(opts.path, '');\n    }\n\n    const wStream = fs.createWriteStream(opts.path, {flags: 'w', mode: this.permissions, autoClose: true, emitClose: false });\n    const controller = new AbortController();\n\n    try {\n      let timer;\n\n      if (opts.timeout > 0) {\n        timer = Meteor.setTimeout(() => {\n          controller.abort();\n          throw new Meteor.Error(408, `Request timeout after ${opts.timeout}ms`);\n        }, opts.timeout);\n      }\n\n      const res = await fetch(url, {\n        headers: opts.headers || {},\n        signal: controller.signal\n      });\n\n      if (timer) {\n        Meteor.clearTimeout(timer);\n        timer = null;\n      }\n\n      if (!res.ok) {\n        throw new Error(`Unexpected response ${res.statusText}`);\n      }\n\n      await pipeline(res.body, wStream);\n\n      const result = this._dataToSchema({\n        name: fileName,\n        path: opts.path,\n        meta: opts.meta,\n        type: opts.type || res.headers.get('content-type') || this._getMimeType({path: opts.path}),\n        size: opts.size || parseInt(res.headers.get('content-length') || 0),\n        userId: opts.userId,\n        extension\n      });\n\n      if (!result.size) {\n        const newStats = await fs.promises.stat(opts.path);\n        result.versions.original.size = (result.size = newStats.size);\n        await storeResult(result);\n      } else {\n        await storeResult(result);\n      }\n      res.body.pipe(wStream);\n    } catch(error){\n      this._debug(`[FilesCollection] [loadAsync] [fetch(${url})] Error:`, error);\n\n      if (fs.existsSync(opts.path)) {\n        await fs.promises.unlink(opts.path);\n      }\n\n      throw error;\n    }\n\n\n    return fileRef;\n  }\n\n  /**\n   * @locus Server\n   * @memberOf FilesCollection\n   * @name addFile\n   * @param {String} path          - Path to file\n   * @param {String} opts          - [Optional] Object with file-data\n   * @param {String} opts.type     - [Optional] File mime-type\n   * @param {Object} opts.meta     - [Optional] File additional meta-data\n   * @param {String} opts.fileId   - _id, sanitized, max-length: 20 symbols default *null*\n   * @param {Object} opts.fileName - [Optional] File name, if not specified file name and extension will be taken from path\n   * @param {String} opts.userId   - [Optional] UserId, default *null*\n   * @param {Boolean} proceedAfterUpload - Proceed onAfterUpload hook\n   * @summary Add file from FS to FilesCollection\n   * @throws {Meteor.Error} If file does not exist (400) or collection is public (403)\n   * @returns {Promise<FilesCollection>} Instance\n   */\n  async addFile(path, _opts = {}, _proceedAfterUpload) {\n    this._debug(`[FilesCollection] [addFile(${path})]`);\n    let opts = _opts;\n    let proceedAfterUpload = _proceedAfterUpload;\n\n    if (this.public) {\n      throw new Meteor.Error(\n        403,\n        'Can not run [addFile] on public collection! Just Move file to root of your server, then add record to Collection'\n      );\n    }\n\n    check(path, String);\n    check(opts, Match.Optional(Object));\n    check(proceedAfterUpload, Match.Optional(Boolean));\n\n    let stats;\n    try {\n      stats = await fs.promises.stat(path);\n    } catch (statErr) {\n      if (statErr.code === 'ENOENT') {\n        throw new Meteor.Error(\n          400,\n          `[FilesCollection] [addFile(${path})]: File does not exist`\n        );\n      }\n      throw new Meteor.Error(statErr.code, statErr.message);\n    }\n    if (stats.isFile()) {\n      if (!helpers.isObject(opts)) {\n        opts = {};\n      }\n      opts.path = path;\n\n      if (!opts.fileName) {\n        const pathParts = path.split(nodePath.sep);\n        opts.fileName = path.split(nodePath.sep)[pathParts.length - 1];\n      }\n\n      const { extension } = this._getExt(opts.fileName);\n\n      if (!helpers.isString(opts.type)) {\n        opts.type = this._getMimeType(opts);\n      }\n\n      if (!helpers.isObject(opts.meta)) {\n        opts.meta = {};\n      }\n\n      if (!helpers.isNumber(opts.size)) {\n        opts.size = stats.size;\n      }\n\n      const result = this._dataToSchema({\n        name: opts.fileName,\n        path,\n        meta: opts.meta,\n        type: opts.type,\n        size: opts.size,\n        userId: opts.userId,\n        extension,\n        _storagePath: path.replace(`${nodePath.sep}${opts.fileName}`, ''),\n        fileId: (opts.fileId && this.sanitize(opts.fileId, 20, 'a')) || null,\n      });\n\n      let _id;\n      try {\n        _id = await this.collection.insertAsync(result);\n      } catch (insertErr) {\n        this._debug(\n          `[FilesCollection] [addFileAsync] [insertAsync] Error: ${result.name} -> ${this.collectionName}`,\n          insertErr\n        );\n        throw new Meteor.Error(insertErr.code, insertErr.message);\n      }\n\n      const fileRef = await this.collection.findOneAsync(_id);\n\n      if (proceedAfterUpload === true) {\n        this.onAfterUpload && this.onAfterUpload.call(this, fileRef);\n        this.emit('afterUpload', fileRef);\n      }\n      this._debug(\n        `[FilesCollection] [addFileAsync]: ${result.name} -> ${this.collectionName}`\n      );\n      return fileRef;\n    }\n    throw new Meteor.Error(\n      400,\n      `[FilesCollection] [addFile(${path})]: File does not exist`\n    );\n  }\n\n  /**\n   * @locus Anywhere\n   * @memberOf FilesCollection\n   * @name removeAsync\n   * @param {String|Object} selector - Mongo-Style selector (http://docs.meteor.com/api/collections.html#selectors)\n   * @throws {Meteor.Error} If cursor is empty\n   * @summary Remove documents from the collection\n   * @returns {Promise<FilesCollection>} Instance\n   */\n  async removeAsync(selector) {\n    this._debug(`[FilesCollection] [removeAsync(${JSON.stringify(selector)})]`);\n    if (selector === void 0) {\n      return 0;\n    }\n\n    const files = this.collection.find(selector);\n    if (await files.countAsync() > 0) {\n      await files.forEachAsync((file) => {\n        this.unlink(file);\n      });\n    } else {\n      throw new Meteor.Error(404, 'Cursor is empty, no files is removed');\n    }\n\n    if (this.onAfterRemove) {\n      const docs = await files.fetchAsync();\n      await this.collection.removeAsync(selector);\n      await this.onAfterRemove(docs);\n    } else {\n      await this.collection.removeAsync(selector);\n    }\n    return this;\n  }\n\n  /**\n   * @locus Server\n   * @memberOf FilesCollection\n   * @name deny\n   * @param {Object} rules\n   * @see  https://docs.meteor.com/api/collections.html#Mongo-Collection-deny\n   * @summary link Mongo.Collection deny methods\n   * @returns {Mongo.Collection} Instance\n   */\n  deny(rules) {\n    this.collection.deny(rules);\n    return this.collection;\n  }\n\n  /**\n   * @locus Server\n   * @memberOf FilesCollection\n   * @name allow\n   * @param {Object} rules\n   * @see https://docs.meteor.com/api/collections.html#Mongo-Collection-allow\n   * @summary link Mongo.Collection allow methods\n   * @returns {Mongo.Collection} Instance\n   */\n  allow(rules) {\n    this.collection.allow(rules);\n    return this.collection;\n  }\n\n  /**\n   * @locus Server\n   * @memberOf FilesCollection\n   * @name denyClient\n   * @see https://docs.meteor.com/api/collections.html#Mongo-Collection-deny\n   * @summary Shorthands for Mongo.Collection deny method\n   * @returns {Mongo.Collection} Instance\n   */\n  denyClient() {\n    this.collection.deny({\n      insert() { return true; },\n      update() { return true; },\n      remove() { return true; }\n    });\n    return this.collection;\n  }\n\n  /**\n   * @locus Server\n   * @memberOf FilesCollection\n   * @name allowClient\n   * @see https://docs.meteor.com/api/collections.html#Mongo-Collection-allow\n   * @summary Shorthands for Mongo.Collection allow method\n   * @returns {Mongo.Collection} Instance\n   */\n  allowClient() {\n    this.collection.allow({\n      insert() { return true; },\n      update() { return true; },\n      remove() { return true; }\n    });\n    return this.collection;\n  }\n\n\n  /**\n   * @locus Server\n   * @memberOf FilesCollection\n   * @name unlink\n   * @param {Object} fileRef - fileObj\n   * @param {String} version - [Optional] file's version\n   * @param {Function} callback - [Optional] callback function\n   * @summary Unlink files and it's versions from FS\n   * @returns {FilesCollection} Instance\n   */\n  unlink(fileRef, version, callback) {\n    this._debug(`[FilesCollection] [unlink(${fileRef._id}, ${version})]`);\n    if (version) {\n      if (helpers.isObject(fileRef.versions) && helpers.isObject(fileRef.versions[version]) && fileRef.versions[version].path) {\n        fs.unlink(fileRef.versions[version].path, (callback || noop));\n      }\n    } else {\n      if (helpers.isObject(fileRef.versions)) {\n        for(let vKey in fileRef.versions) {\n          if (fileRef.versions[vKey] && fileRef.versions[vKey].path) {\n            fs.unlink(fileRef.versions[vKey].path, (callback || noop));\n          }\n        }\n      } else {\n        fs.unlink(fileRef.path, (callback || noop));\n      }\n    }\n    return this;\n  }\n\n  /**\n   * @locus Server\n   * @memberOf FilesCollection\n   * @name _404\n   * @summary Internal method, used to return 404 error\n   * @returns {undefined}\n   */\n  _404(http) {\n    this._debug(`[FilesCollection] [download(${http.request.originalUrl})] [_404] File not found`);\n    const text = 'File Not Found :(';\n\n    if (!http.response.headersSent) {\n      http.response.writeHead(404, {\n        'Content-Type': 'text/plain',\n        'Content-Length': text.length\n      });\n    }\n\n    if (!http.response.finished) {\n      http.response.end(text);\n    }\n  }\n\n  /**\n   * @locus Server\n   * @memberOf FilesCollection\n   * @name download\n   * @param {Object} http    - Server HTTP object\n   * @param {String} version - Requested file version\n   * @param {Object} fileRef - Requested file Object\n   * @summary Initiates the HTTP response\n   * @returns {Promise<undefined>}\n   */\n  async download(http, version = 'original', fileRef) {\n    let vRef;\n    this._debug(\n      `[FilesCollection] [download(${http.request.originalUrl}, ${version})]`\n    );\n\n    if (fileRef) {\n      if (\n        helpers.has(fileRef, 'versions') &&\n        helpers.has(fileRef.versions, version)\n      ) {\n        vRef = fileRef.versions[version];\n        vRef._id = fileRef._id;\n      } else {\n        vRef = fileRef;\n      }\n    } else {\n      vRef = false;\n    }\n\n    if (!vRef || !helpers.isObject(vRef)) {\n      return this._404(http);\n    } else if (fileRef) {\n      if (\n        helpers.isFunction(this.downloadCallback) &&\n        !(await this.downloadCallback(\n          Object.assign(http, this._getUser(http)),\n          fileRef\n        ))\n      ) {\n        return this._404(http);\n      }\n\n      if (\n        this.interceptDownload &&\n        helpers.isFunction(this.interceptDownload) &&\n        (await this.interceptDownload(http, fileRef, version)) === true\n      ) {\n        return void 0;\n      }\n\n      let stats;\n\n      try {\n        stats = await fs.promises.stat(vRef.path);\n      } catch (statErr){\n        if (statErr) {\n          return this._404(http);\n        }\n      }\n      if (!stats.isFile()) {\n        return this._404(http);\n      }\n      let responseType;\n\n      if (stats.size !== vRef.size && !this.integrityCheck) {\n        vRef.size = stats.size;\n      }\n\n      if (stats.size !== vRef.size && this.integrityCheck) {\n        responseType = '400';\n      }\n\n      this.serve(\n        http,\n        fileRef,\n        vRef,\n        version,\n        null,\n        responseType || '200'\n      );\n\n      return void 0;\n    }\n    return this._404(http);\n  }\n\n  /**\n   * @locus Server\n   * @memberOf FilesCollection\n   * @name serve\n   * @param {Object} http    - Server HTTP object\n   * @param {Object} fileRef - Requested file Object\n   * @param {Object} vRef    - Requested file version Object\n   * @param {String} version - Requested file version\n   * @param {stream.Readable|null} readableStream - Readable stream, which serves binary file data\n   * @param {String} responseType - Response code\n   * @param {Boolean} force200 - Force 200 response code over 206\n   * @summary Handle and reply to incoming request\n   * @returns {undefined}\n   */\n  serve(http, fileRef, vRef, version = 'original', readableStream = null, _responseType = '200', force200 = false) {\n    let partiral = false;\n    let reqRange = false;\n    let dispositionType = '';\n    let start;\n    let end;\n    let take;\n    let responseType = _responseType;\n\n    if (http.params?.query?.download && (http.params.query.download === 'true')) {\n      dispositionType = 'attachment; ';\n    } else {\n      dispositionType = 'inline; ';\n    }\n\n    const dispositionName = `filename=\\\"${encodeURI(vRef.name || fileRef.name).replace(/\\,/g, '%2C')}\\\"; filename*=UTF-8''${encodeURIComponent(vRef.name || fileRef.name)}; `;\n    const dispositionEncoding = 'charset=UTF-8';\n\n    if (!http.response.headersSent) {\n      http.response.setHeader('Content-Disposition', dispositionType + dispositionName + dispositionEncoding);\n    }\n\n    if (http.request.headers.range && !force200) {\n      partiral = true;\n      const array = http.request.headers.range.split(/bytes=([0-9]*)-([0-9]*)/);\n      start = parseInt(array[1]);\n      end = parseInt(array[2]);\n      if (isNaN(end)) {\n        end = vRef.size - 1;\n      }\n      take = end - start;\n    } else {\n      start = 0;\n      end = vRef.size - 1;\n      take = vRef.size;\n    }\n\n    if (partiral || (http.params?.query?.play && (http.params.query.play === 'true'))) {\n      reqRange = {start, end};\n      if (isNaN(start) && !isNaN(end)) {\n        reqRange.start = end - take;\n        reqRange.end = end;\n      }\n      if (!isNaN(start) && isNaN(end)) {\n        reqRange.start = start;\n        reqRange.end = start + take;\n      }\n\n      if ((start + take) >= vRef.size) {\n        reqRange.end = vRef.size - 1;\n      }\n\n      if (this.strict && ((reqRange.start >= (vRef.size - 1)) || (reqRange.end > (vRef.size - 1)))) {\n        responseType = '416';\n      } else {\n        responseType = '206';\n      }\n    } else {\n      responseType = '200';\n    }\n\n    const streamErrorHandler = (error) => {\n      this._debug(`[FilesCollection] [serve(${vRef.path}, ${version})] [500]`, error);\n      if (!http.response.finished) {\n        http.response.end(error.toString());\n      }\n    };\n\n    const headers = helpers.isFunction(this.responseHeaders) ? this.responseHeaders(responseType, fileRef, vRef, version, http) : this.responseHeaders;\n\n    if (!headers['Cache-Control']) {\n      if (!http.response.headersSent) {\n        http.response.setHeader('Cache-Control', this.cacheControl);\n      }\n    }\n\n    for (let key in headers) {\n      if (!http.response.headersSent) {\n        http.response.setHeader(key, headers[key]);\n      }\n    }\n\n    const respond = (stream, code) => {\n      stream._isEnded = false;\n      const closeStreamCb = (closeError) => {\n        if (!closeError) {\n          stream._isEnded = true;\n        } else {\n          this._debug(`[FilesCollection] [serve(${vRef.path}, ${version})] [respond] [closeStreamCb] (this is error on the stream we wish to forcefully close after it isn't needed anymore. It's okay that it throws errors. Consider this as purely informational message)`, closeError);\n        }\n      };\n\n      const closeStream = () => {\n        if (!stream._isEnded && !stream.destroyed) {\n          try {\n            if (typeof stream.close === 'function') {\n              stream.close(closeStreamCb);\n            } else if (typeof stream.end === 'function') {\n              stream.end(closeStreamCb);\n            } else if (typeof stream.destroy === 'function') {\n              stream.destroy('Got to close this stream', closeStreamCb);\n            }\n          } catch (closeStreamError) {\n            // Perhaps one of the method has thrown an error\n            // or stream has been already ended/closed/exhausted\n          }\n        }\n      };\n\n      if (!http.response.headersSent && readableStream) {\n        http.response.writeHead(code);\n      }\n\n      http.request.on('aborted', () => {\n        http.request.aborted = true;\n      });\n\n      stream.on('open', () => {\n        if (!http.response.headersSent) {\n          http.response.writeHead(code);\n        }\n      }).on('abort', () => {\n        closeStream();\n        if (!http.response.finished) {\n          http.response.end();\n        }\n        if (!http.request.aborted) {\n          http.request.destroy();\n        }\n      }).on('error', (err) => {\n        closeStream();\n        streamErrorHandler(err);\n      }).on('end', () => {\n        if (!http.response.finished) {\n          http.response.end();\n        }\n      }).pipe(http.response);\n    };\n\n    switch (responseType) {\n    case '400':\n      this._debug(`[FilesCollection] [serve(${vRef.path}, ${version})] [400] Content-Length mismatch!`);\n      var text = 'Content-Length mismatch!';\n\n      if (!http.response.headersSent) {\n        http.response.writeHead(400, {\n          'Content-Type': 'text/plain',\n          'Content-Length': text.length\n        });\n      }\n\n      if (!http.response.finished) {\n        http.response.end(text);\n      }\n      break;\n    case '404':\n      this._404(http);\n      break;\n    case '416':\n      this._debug(`[FilesCollection] [serve(${vRef.path}, ${version})] [416] Content-Range is not specified!`);\n      if (!http.response.headersSent) {\n        http.response.writeHead(416);\n      }\n      if (!http.response.finished) {\n        http.response.end();\n      }\n      break;\n    case '206':\n      this._debug(`[FilesCollection] [serve(${vRef.path}, ${version})] [206]`);\n      if (!http.response.headersSent) {\n        http.response.setHeader('Content-Range', `bytes ${reqRange.start}-${reqRange.end}/${vRef.size}`);\n      }\n      respond(readableStream || fs.createReadStream(vRef.path, {start: reqRange.start, end: reqRange.end}), 206);\n      break;\n    default:\n      if (!http.response.headersSent) {\n        http.response.setHeader('Content-Length', `${vRef.size}`);\n      }\n      this._debug(`[FilesCollection] [serve(${vRef.path}, ${version})] [200]`);\n      respond(readableStream || fs.createReadStream(vRef.path), 200);\n      break;\n    }\n  }\n}\n\nexport { FilesCollection, helpers };\n","import { EventEmitter } from 'eventemitter3';\nimport { check, Match } from 'meteor/check';\nimport { formatFleURL, helpers } from './lib.js';\nimport { FilesCursor, FileCursor } from './cursor.js';\n\nexport default class FilesCollectionCore extends EventEmitter {\n  constructor() {\n    super();\n  }\n\n  static __helpers = helpers;\n\n  static schema = {\n    _id: {\n      type: String\n    },\n    size: {\n      type: Number\n    },\n    name: {\n      type: String\n    },\n    type: {\n      type: String\n    },\n    path: {\n      type: String\n    },\n    isVideo: {\n      type: Boolean\n    },\n    isAudio: {\n      type: Boolean\n    },\n    isImage: {\n      type: Boolean\n    },\n    isText: {\n      type: Boolean\n    },\n    isJSON: {\n      type: Boolean\n    },\n    isPDF: {\n      type: Boolean\n    },\n    extension: {\n      type: String,\n      optional: true\n    },\n    ext: {\n      type: String,\n      optional: true\n    },\n    extensionWithDot: {\n      type: String,\n      optional: true\n    },\n    mime: {\n      type: String,\n      optional: true\n    },\n    'mime-type': {\n      type: String,\n      optional: true\n    },\n    _storagePath: {\n      type: String\n    },\n    _downloadRoute: {\n      type: String\n    },\n    _collectionName: {\n      type: String\n    },\n    public: {\n      type: Boolean,\n      optional: true\n    },\n    meta: {\n      type: Object,\n      blackbox: true,\n      optional: true\n    },\n    userId: {\n      type: String,\n      optional: true\n    },\n    updatedAt: {\n      type: Date,\n      optional: true\n    },\n    versions: {\n      type: Object,\n      blackbox: true\n    }\n  };\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _debug\n   * @summary Print logs in debug mode\n   * @returns {void}\n   */\n  _debug() {\n    if (this.debug) {\n      // eslint-disable-next-line no-console\n      (console.info || console.log || function () {}).apply(void 0, arguments);\n    }\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _getFileName\n   * @param {Object} fileData - File Object\n   * @summary Returns file's name\n   * @returns {String}\n   */\n  _getFileName(fileData) {\n    const fileName = fileData.name || fileData.fileName;\n    if (helpers.isString(fileName) && (fileName.length > 0)) {\n      return (fileData.name || fileData.fileName).replace(/^\\.\\.+/, '').replace(/\\.{2,}/g, '.').replace(/\\//g, '');\n    }\n    return '';\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _getExt\n   * @param {String} FileName - File name\n   * @summary Get extension from FileName\n   * @returns {Object}\n   */\n  _getExt(fileName) {\n    if (fileName.includes('.')) {\n      const extension = (fileName.split('.').pop().split('?')[0] || '').toLowerCase().replace(/([^a-z0-9\\-\\_\\.]+)/gi, '').substring(0, 20);\n      return { ext: extension, extension, extensionWithDot: `.${extension}` };\n    }\n    return { ext: '', extension: '', extensionWithDot: '' };\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _updateFileTypes\n   * @param {Object} data - File data\n   * @summary Internal method. Classify file based on 'type' field\n   */\n  _updateFileTypes(data) {\n    data.isVideo = /^video\\//i.test(data.type);\n    data.isAudio = /^audio\\//i.test(data.type);\n    data.isImage = /^image\\//i.test(data.type);\n    data.isText = /^text\\//i.test(data.type);\n    data.isJSON = /^application\\/json$/i.test(data.type);\n    data.isPDF = /^application\\/(x-)?pdf$/i.test(data.type);\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _dataToSchema\n   * @param {Object} data - File data\n   * @summary Internal method. Build object in accordance with default schema from File data\n   * @returns {Object}\n   */\n  _dataToSchema(data) {\n    const ds = {\n      name: data.name,\n      extension: data.extension,\n      ext: data.extension,\n      extensionWithDot: `.${data.extension}`,\n      path: data.path,\n      meta: data.meta,\n      type: data.type,\n      mime: data.type,\n      'mime-type': data.type,\n      size: data.size,\n      userId: data.userId || null,\n      versions: {\n        original: {\n          path: data.path,\n          size: data.size,\n          type: data.type,\n          extension: data.extension\n        }\n      },\n      _downloadRoute: data._downloadRoute || this.downloadRoute,\n      _collectionName: data._collectionName || this.collectionName\n    };\n\n    //Optional fileId\n    if (data.fileId) {\n      ds._id = data.fileId;\n    }\n\n    this._updateFileTypes(ds);\n    ds._storagePath = data._storagePath || this.storagePath(Object.assign({}, data, ds));\n    return ds;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name findOneAsync\n   * @param {String|Object} selector - Mongo-Style selector (http://docs.meteor.com/api/collections.html#selectors)\n   * @param {Object} options - Mongo-Style selector Options (http://docs.meteor.com/api/collections.html#sortspecifiers)\n   * @summary Find and return Cursor for matching document Object\n   * @returns {Promise<FileCursor>} Instance\n   */\n  async findOneAsync(selector = {}, options) {\n    this._debug(`[FilesCollection] [findOneAsync(${JSON.stringify(selector)}, ${JSON.stringify(options)})]`);\n    check(selector, Match.Optional(Match.OneOf(Object, String, Boolean, Number, null)));\n    check(options, Match.Optional(Object));\n\n    const doc = await this.collection.findOneAsync(selector, options);\n    if (doc) {\n      return new FileCursor(doc, this);\n    }\n    return doc;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name find\n   * @param {String|Object} selector - Mongo-Style selector (http://docs.meteor.com/api/collections.html#selectors)\n   * @param {Object}        options  - Mongo-Style selector Options (http://docs.meteor.com/api/collections.html#sortspecifiers)\n   * @summary Find and return Cursor for matching documents\n   * @returns {FilesCursor} Instance\n   */\n  find(selector = {}, options) {\n    this._debug(`[FilesCollection] [find(${JSON.stringify(selector)}, ${JSON.stringify(options)})]`);\n    check(selector, Match.Optional(Match.OneOf(Object, String, Boolean, Number, null)));\n    check(options, Match.Optional(Object));\n\n    return new FilesCursor(selector, options, this);\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name updateAsync\n   * @see http://docs.meteor.com/#/full/update\n   * @summary link Mongo.Collection update method\n   * @returns {Promise<Mongo.Collection>} Instance\n   */\n  async updateAsync() {\n    await this.collection.updateAsync.apply(this.collection, arguments);\n    return this.collection;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name link\n   * @param {Object} fileRef - File reference object\n   * @param {String} version - Version of file you would like to request\n   * @param {String} uriBase - [Optional] URI base, see - https://github.com/veliovgroup/Meteor-Files/issues/626\n   * @summary Returns downloadable URL\n   * @returns {String} Empty string returned in case if file not found in DB\n   */\n  link(fileRef, version = 'original', uriBase) {\n    this._debug(`[FilesCollection] [link(${(helpers.isObject(fileRef) ? fileRef._id : void 0)}, ${version})]`);\n    check(fileRef, Object);\n\n    if (!fileRef) {\n      return '';\n    }\n    return formatFleURL(fileRef, version, uriBase);\n  }\n}\n","import { Meteor } from 'meteor/meteor';\n\n/*\n * @private\n * @locus Anywhere\n * @class FileCursor\n * @param _fileRef    {Object} - Mongo-Style selector (http://docs.meteor.com/api/collections.html#selectors)\n * @param _collection {FilesCollection} - FilesCollection Instance\n * @summary Internal class, represents each record in `FilesCursor.each()` or document returned from `.findOne()` method\n */\nexport class FileCursor {\n  constructor(_fileRef, _collection) {\n    this._fileRef = _fileRef;\n    this._collection = _collection;\n    Object.assign(this, _fileRef);\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FileCursor\n   * @name removeAsync\n   * @throws {Meteor.Error} - If no file reference is provided\n   * @summary Remove document\n   * @returns {Promise<FileCursor>}\n   */\n  async removeAsync() {\n    this._collection._debug('[FilesCollection] [FileCursor] [removeAsync()]');\n    if (this._fileRef) {\n      await this._collection.removeAsync(this._fileRef._id);\n    } else {\n      throw new Meteor.Error(404, 'No such file');\n    }\n    return this;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FileCursor\n   * @name link\n   * @param version {String} - Name of file's subversion\n   * @param uriBase {String} - [Optional] URI base, see - https://github.com/veliovgroup/Meteor-Files/issues/626\n   * @summary Returns downloadable URL to File\n   * @returns {String}\n   */\n  link(version = 'original', uriBase) {\n    this._collection._debug(`[FilesCollection] [FileCursor] [link(${version})]`);\n    if (this._fileRef) {\n      return this._collection.link(this._fileRef, version, uriBase);\n    }\n    return '';\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FileCursor\n   * @name get\n   * @param property {String} - Name of sub-object property\n   * @summary Returns current document as a plain Object, if `property` is specified - returns value of sub-object property\n   * @returns {Object|mix}\n   */\n  get(property) {\n    this._collection._debug(`[FilesCollection] [FileCursor] [get(${property})]`);\n    if (property) {\n      return this._fileRef[property];\n    }\n    return this._fileRef;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FileCursor\n   * @name fetch\n   * @summary Returns document as plain Object in Array\n   * @returns {[Object]}\n   */\n  fetch() {\n    this._collection._debug('[FilesCollection] [FileCursor] [fetch()]');\n    return [this._fileRef];\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FileCursor\n   * @name with\n   * @summary Returns reactive version of current FileCursor, useful to use with `{{#with}}...{{/with}}` block template helper\n   * @returns {[Object]}\n   */\n  with() {\n    this._collection._debug('[FilesCollection] [FileCursor] [with()]');\n    return Object.assign(this, this._collection.collection.findOne(this._fileRef._id));\n  }\n}\n\n/*\n * @private\n * @locus Anywhere\n * @class FilesCursor\n * @param _selector   {String|Object}   - Mongo-Style selector (http://docs.meteor.com/api/collections.html#selectors)\n * @param options     {Object}          - Mongo-Style selector Options (http://docs.meteor.com/api/collections.html#selectors)\n * @param _collection {FilesCollection} - FilesCollection Instance\n * @summary Implementation of Cursor for FilesCollection\n */\nexport class FilesCursor {\n  constructor(_selector = {}, options, _collection) {\n    this._collection = _collection;\n    this._selector = _selector;\n    this._current = -1;\n    this.cursor = this._collection.collection.find(this._selector, options);\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name get\n   * @summary Returns all matching document(s) as an Array. Alias of `.fetch()`\n   * @returns {Promise<[Object]>}\n   */\n  async get() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [getAsync()]');\n    return this.cursor.fetchAsync();\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name hasNext\n   * @summary Returns `true` if there is next item available on Cursor\n   * @returns {Boolean}\n   */\n  async hasNext() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [hasNextAsync()]');\n    return this._current < (await this.cursor.countAsync()) - 1;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name next\n   * @summary Returns next item on Cursor, if available\n   * @returns {Promise<Object|undefined>}\n   */\n  async next() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [nextAsync()]');\n    return (await this.cursor.fetchAsync())[++this._current];\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name hasPrevious\n   * @summary Returns `true` if there is previous item available on Cursor\n   * @returns {Boolean}\n   */\n  hasPrevious() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [hasPrevious()]');\n    return this._current !== -1;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name previous\n   * @summary Returns previous item on Cursor, if available\n   * @returns {Promise<Object|undefined>}\n   */\n  async previous() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [previousAsync()]');\n    return (this.cursor.fetchAsync())[--this._current];\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name fetchAsync\n   * @summary Returns all matching document(s) as an Array.\n   * @returns {Promise<[Object]>}\n   */\n  async fetchAsync() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [fetchAsync()]');\n    return (await this.cursor.fetchAsync()) || [];\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name first\n   * @summary Returns first item on Cursor, if available\n   * @returns {Promise<Object|undefined>}\n   */\n  async first() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [firstAsync()]');\n    this._current = 0;\n    return (await this.fetchAsync())[this._current];\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name last\n   * @summary Returns last item on Cursor, if available\n   * @returns {Promise<Object|undefined>}\n   */\n  async last() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [last()]');\n    this._current = (await this.countAsync()) - 1;\n    return (await this.fetchAsync())[this._current];\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name countAsync\n   * @summary Returns the number of documents that match a query\n   * @returns {Promise<Number>}\n   */\n  async countAsync() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [countAsync()]');\n    return this.cursor.countAsync();\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name removeAsync\n   * @summary Removes all documents that match a query\n   * @returns {Promise<FilesCursor>}\n   */\n  async removeAsync() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [removeAsync()]');\n    await this._collection.removeAsync(this._selector);\n    return this;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name forEachAsync\n   * @param callback {Function} - Function to call. It will be called with three arguments: the `file`, a 0-based index, and cursor itself\n   * @param context {Object} - An object which will be the value of `this` inside `callback`\n   * @summary Call `callback` once for each matching document, sequentially and synchronously.\n   * @returns {Promise<undefined>}\n   */\n  async forEachAsync(callback, context = {}) {\n    this._collection._debug('[FilesCollection] [FilesCursor] [forEachAsync()]');\n    await this.cursor.forEachAsync(callback, context);\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name each\n   * @summary Returns an Array of FileCursor made for each document on current cursor\n   *          Useful when using in {{#each FilesCursor#each}}...{{/each}} block template helper\n   * @returns {Promise<[FileCursor]>}\n   */\n  async each() {\n    return this.mapAsync((file) => {\n      return new FileCursor(file, this._collection);\n    });\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name mapAsync\n   * @param callback {Function} - Function to call. It will be called with three arguments: the `file`, a 0-based index, and cursor itself\n   * @param context {Object} - An object which will be the value of `this` inside `callback`\n   * @summary Map `callback` over all matching documents. Returns an Array.\n   * @returns {Promise<Array>}\n   */\n  async mapAsync(callback, context = {}) {\n    this._collection._debug('[FilesCollection] [FilesCursor] [mapAsync()]');\n    return this.cursor.mapAsync(callback, context);\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name current\n   * @summary Returns current item on Cursor, if available\n   * @returns {Promise<Object|undefined>}\n   */\n  async current() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [currentAsync()]');\n    if (this._current < 0) {\n      this._current = 0;\n    }\n    return (await this.fetchAsync())[this._current];\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name observe\n   * @param callbacks {Object} - Functions to call to deliver the result set as it changes\n   * @summary Watch a query. Receive callbacks as the result set changes.\n   * @url http://docs.meteor.com/api/collections.html#Mongo-Cursor-observe\n   * @returns {Promise<Object>} - live query handle\n   */\n  async observe(callbacks) {\n    this._collection._debug('[FilesCollection] [FilesCursor] [observe()]');\n    return this.cursor.observe(callbacks);\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name observeChanges\n   * @param callbacks {Object} - Functions to call to deliver the result set as it changes\n   * @summary Watch a query. Receive callbacks as the result set changes. Only the differences between the old and new documents are passed to the callbacks.\n   * @url http://docs.meteor.com/api/collections.html#Mongo-Cursor-observeChanges\n   * @returns {Object} - live query handle\n   */\n  observeChanges(callbacks) {\n    this._collection._debug('[FilesCollection] [FilesCursor] [observeChanges()]');\n    return this.cursor.observeChanges(callbacks);\n  }\n}\n","import { check } from 'meteor/check';\n\nconst helpers = {\n  sanitize(str = '', max = 28, replacement = '-') {\n    return str.replace(/([^a-z0-9\\-\\_]+)/gi, replacement).substring(0, max);\n  },\n  isUndefined(obj) {\n    return obj === void 0;\n  },\n  isObject(obj) {\n    if (this.isArray(obj) || this.isFunction(obj)) {\n      return false;\n    }\n    return obj === Object(obj);\n  },\n  isArray(obj) {\n    return Array.isArray(obj);\n  },\n  isBoolean(obj) {\n    return obj === true || obj === false || Object.prototype.toString.call(obj) === '[object Boolean]';\n  },\n  isFunction(obj) {\n    return typeof obj === 'function' || false;\n  },\n  isDate(date) {\n    return !Number.isNaN(new Date(date).getDate());\n  },\n  isEmpty(obj) {\n    if (this.isDate(obj)) {\n      return false;\n    }\n    if (this.isObject(obj)) {\n      return !Object.keys(obj).length;\n    }\n    if (this.isArray(obj) || this.isString(obj)) {\n      return !obj.length;\n    }\n    return false;\n  },\n  clone(obj) {\n    if (!this.isObject(obj)) return obj;\n    return this.isArray(obj) ? obj.slice() : Object.assign({}, obj);\n  },\n  has(_obj, path) {\n    let obj = _obj;\n    if (!this.isObject(obj)) {\n      return false;\n    }\n    if (!this.isArray(path)) {\n      return this.isObject(obj) && Object.prototype.hasOwnProperty.call(obj, path);\n    }\n\n    const length = path.length;\n    for (let i = 0; i < length; i++) {\n      if (!Object.prototype.hasOwnProperty.call(obj, path[i])) {\n        return false;\n      }\n      obj = obj[path[i]];\n    }\n    return !!length;\n  },\n  omit(obj, ...keys) {\n    const clear = Object.assign({}, obj);\n    for (let i = keys.length - 1; i >= 0; i--) {\n      delete clear[keys[i]];\n    }\n\n    return clear;\n  },\n  now: Date.now,\n  throttle(func, wait, options = {}) {\n    let previous = 0;\n    let timeout = null;\n    let result;\n    const that = this;\n    let self;\n    let args;\n\n    const later = () => {\n      previous = options.leading === false ? 0 : that.now();\n      timeout = null;\n      result = func.apply(self, args);\n      if (!timeout) {\n        self = args = null;\n      }\n    };\n\n    const throttled = function () {\n      const now = that.now();\n      if (!previous && options.leading === false) previous = now;\n      const remaining = wait - (now - previous);\n      self = this;\n      args = arguments;\n      if (remaining <= 0 || remaining > wait) {\n        if (timeout) {\n          clearTimeout(timeout);\n          timeout = null;\n        }\n        previous = now;\n        result = func.apply(self, args);\n        if (!timeout) {\n          self = args = null;\n        }\n      } else if (!timeout && options.trailing !== false) {\n        timeout = setTimeout(later, remaining);\n      }\n      return result;\n    };\n\n    throttled.cancel = () => {\n      clearTimeout(timeout);\n      previous = 0;\n      timeout = self = args = null;\n    };\n\n    return throttled;\n  }\n};\n\nconst _helpers = ['String', 'Number', 'Date'];\nfor (let i = 0; i < _helpers.length; i++) {\n  helpers['is' + _helpers[i]] = function (obj) {\n    return Object.prototype.toString.call(obj) === `[object ${_helpers[i]}]`;\n  };\n}\n\n/*\n * @const {Function} fixJSONParse - Fix issue with Date parse\n */\nconst fixJSONParse = function(obj) {\n  for (let key in obj) {\n    if (helpers.isString(obj[key]) && obj[key].includes('=--JSON-DATE--=')) {\n      obj[key] = obj[key].replace('=--JSON-DATE--=', '');\n      obj[key] = new Date(parseInt(obj[key]));\n    } else if (helpers.isObject(obj[key])) {\n      obj[key] = fixJSONParse(obj[key]);\n    } else if (helpers.isArray(obj[key])) {\n      let v;\n      for (let i = 0; i < obj[key].length; i++) {\n        v = obj[key][i];\n        if (helpers.isObject(v)) {\n          obj[key][i] = fixJSONParse(v);\n        } else if (helpers.isString(v) && v.includes('=--JSON-DATE--=')) {\n          v = v.replace('=--JSON-DATE--=', '');\n          obj[key][i] = new Date(parseInt(v));\n        }\n      }\n    }\n  }\n  return obj;\n};\n\n/*\n * @const {Function} fixJSONStringify - Fix issue with Date stringify\n */\nconst fixJSONStringify = function(obj) {\n  for (let key in obj) {\n    if (helpers.isDate(obj[key])) {\n      obj[key] = `=--JSON-DATE--=${+obj[key]}`;\n    } else if (helpers.isObject(obj[key])) {\n      obj[key] = fixJSONStringify(obj[key]);\n    } else if (helpers.isArray(obj[key])) {\n      let v;\n      for (let i = 0; i < obj[key].length; i++) {\n        v = obj[key][i];\n        if (helpers.isObject(v)) {\n          obj[key][i] = fixJSONStringify(v);\n        } else if (helpers.isDate(v)) {\n          obj[key][i] = `=--JSON-DATE--=${+v}`;\n        }\n      }\n    }\n  }\n  return obj;\n};\n\n/*\n * @locus Anywhere\n * @private\n * @name formatFleURL\n * @param {Object} fileRef - File reference object\n * @param {String} version - [Optional] Version of file you would like build URL for\n * @param {String} uriBase - [Optional] URI base, see - https://github.com/veliovgroup/Meteor-Files/issues/626\n * @summary Returns formatted URL for file\n * @returns {String} Downloadable link\n */\n// eslint-disable-next-line camelcase, no-undef\nconst formatFleURL = (fileRef, version = 'original', _uriBase = (__meteor_runtime_config__ || {}).ROOT_URL) => {\n  check(fileRef, Object);\n  check(version, String);\n  let uriBase = _uriBase;\n\n  if (!helpers.isString(uriBase)) {\n    // eslint-disable-next-line camelcase, no-undef\n    uriBase = (__meteor_runtime_config__ || {}).ROOT_URL || '/';\n  }\n\n  const _root = uriBase.replace(/\\/+$/, '');\n  const vRef = (fileRef.versions && fileRef.versions[version]) || fileRef || {};\n\n  let ext;\n  if (helpers.isString(vRef.extension)) {\n    ext = `.${vRef.extension.replace(/^\\./, '')}`;\n  } else {\n    ext = '';\n  }\n\n  if (fileRef.public === true) {\n    return _root + (version === 'original' ? `${fileRef._downloadRoute}/${fileRef._id}${ext}` : `${fileRef._downloadRoute}/${version}-${fileRef._id}${ext}`);\n  }\n  return `${_root}${fileRef._downloadRoute}/${fileRef._collectionName}/${fileRef._id}/${version}/${fileRef._id}${ext}`;\n};\n\nexport { fixJSONParse, fixJSONStringify, formatFleURL, helpers };\n","import fs from 'fs-extra';\nimport nodePath from 'path';\nimport { Meteor } from 'meteor/meteor';\nimport { helpers } from './lib.js';\nconst noop = () => {};\n\n/**\n * @const {Object} bound   - Meteor.bindEnvironment (Fiber wrapper)\n * @const {Object} fdCache - File Descriptors Cache\n */\nconst bound = Meteor.bindEnvironment(callback => callback());\nconst fdCache = {};\n\n/**\n * @private\n * @locus Server\n * @class WriteStream\n * @param path        {String} - Path to file on FS\n * @param maxLength   {Number} - Max amount of chunks in stream\n * @param file        {Object} - fileRef Object\n * @param permissions {String} - Permissions which will be set to open descriptor (octal), like: `611` or `0o777`. Default: 0755\n * @summary writableStream wrapper class, makes sure chunks is written in given order. Implementation of queue stream.\n */\nexport default class WriteStream {\n  constructor(path, maxLength, file, permissions) {\n    this.path = path.trim();\n    this.maxLength = maxLength;\n    this.file = file;\n    this.permissions = permissions;\n    if (!this.path || !helpers.isString(this.path)) {\n      return;\n    }\n\n    this.fd = null;\n    this.ended = false;\n    this.aborted = false;\n    this.writtenChunks = 0;\n\n    if (fdCache[this.path] && !fdCache[this.path].ended && !fdCache[this.path].aborted) {\n      this.fd = fdCache[this.path].fd;\n      this.writtenChunks = fdCache[this.path].writtenChunks;\n    } else {\n      fs.stat(this.path, (statError, stats) => {\n        bound(() => {\n          if (statError || !stats.isFile()) {\n            const paths = this.path.split(nodePath.sep);\n            paths.pop();\n            try {\n              fs.mkdirSync(paths.join(nodePath.sep), { recursive: true });\n            } catch (mkdirError) {\n              throw new Meteor.Error(500, `[FilesCollection] [writeStream] [constructor] [mkdirSync] ERROR: can not make/ensure directory \"${paths.join(nodePath.sep)}\"`, mkdirError);\n            }\n\n            try {\n              fs.writeFileSync(this.path, '');\n            } catch (writeFileError) {\n              throw new Meteor.Error(500, `[FilesCollection] [writeStream] [constructor] [writeFileSync] ERROR: can not write file \"${this.path}\"`, writeFileError);\n            }\n          }\n\n          fs.open(this.path, 'r+', this.permissions, (oError, fd) => {\n            bound(() => {\n              if (oError) {\n                this.abort();\n                throw new Meteor.Error(500, '[FilesCollection] [writeStream] [constructor] [open] [Error:]', oError);\n              } else {\n                this.fd = fd;\n                fdCache[this.path] = this;\n              }\n            });\n          });\n        });\n      });\n    }\n  }\n\n  /**\n   * @memberOf writeStream\n   * @name write\n   * @param {Number} num - Chunk position in a stream\n   * @param {Buffer} chunk - Buffer (chunk binary data)\n   * @param {Function} callback - Callback\n   * @summary Write chunk in given order\n   * @returns {Boolean} - True if chunk is sent to stream, false if chunk is set into queue\n   */\n  write(num, chunk, callback) {\n    if (!this.aborted && !this.ended) {\n      if (this.fd) {\n        fs.write(this.fd, chunk, 0, chunk.length, (num - 1) * this.file.chunkSize, (error, written, buffer) => {\n          bound(() => {\n            callback && callback(error, written, buffer);\n            if (error) {\n              Meteor._debug('[FilesCollection] [writeStream] [write] [Error:]', error);\n              this.abort();\n            } else {\n              ++this.writtenChunks;\n            }\n          });\n        });\n      } else {\n        Meteor.setTimeout(() => {\n          this.write(num, chunk, callback);\n        }, 25);\n      }\n    }\n    return false;\n  }\n\n  /**\n   * @memberOf writeStream\n   * @name end\n   * @param {Function} callback - Callback\n   * @summary Finishes writing to writableStream, only after all chunks in queue is written\n   * @returns {Boolean} - True if stream is fulfilled, false if queue is in progress\n   */\n  end(callback) {\n    if (!this.aborted && !this.ended) {\n      if (this.writtenChunks === this.maxLength) {\n        fs.close(this.fd, () => {\n          bound(() => {\n            delete fdCache[this.path];\n            this.ended = true;\n            callback && callback(void 0, true);\n          });\n        });\n        return true;\n      }\n\n      fs.stat(this.path, (error, stat) => {\n        bound(() => {\n          if (!error && stat) {\n            this.writtenChunks = Math.ceil(stat.size / this.file.chunkSize);\n          }\n\n          return Meteor.setTimeout(() => {\n            this.end(callback);\n          }, 25);\n        });\n      });\n    } else {\n      callback && callback(void 0, this.ended);\n    }\n    return false;\n  }\n\n  /**\n   * @memberOf writeStream\n   * @name abort\n   * @param {Function} callback - Callback\n   * @summary Aborts writing to writableStream, removes created file\n   * @returns {Boolean} - True\n   */\n  abort(callback) {\n    this.aborted = true;\n    delete fdCache[this.path];\n    fs.unlink(this.path, (callback || noop));\n    return true;\n  }\n\n  /**\n   * @memberOf writeStream\n   * @name stop\n   * @summary Stop writing to writableStream\n   * @returns {Boolean} - True\n   */\n  stop() {\n    this.aborted = true;\n    delete fdCache[this.path];\n    return true;\n  }\n}\n"]}